%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% csbook Package
%% Version: 1.0
%% Date: 2024/05/19
%% Description: Tools for creating academic books in computer science
%% Author: Agni Datta
%% Email: agnidatta.org@gmail.com
%% Maintainer: Agni Datta
%% License: MIT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% csbook package: Streamlines academic book creation for computer science

% Usage:
% 1. Load with \RequirePackage{csbook}.
% 2. Use the provided environments and tools.

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Declaration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\csbook@filename}{csbook} % Package filename
\newcommand{\csbook@fileversion}{v1} % Version
\newcommand{\csbook@filedate}{2024/04/17} % Release date
\newcommand{\csbook@fileauthor}{Agni Datta} % Author
\newcommand{\csbook@version}{1.0} % Internal version

\NeedsTeXFormat{LaTeX2e} % Requires LaTeX2e
\AtEndOfPackage{%
	\ProvidesPackage{\csbook@filename}[\csbook@filedate\space\csbook@fileversion\space(\csbook@fileauthor)]
	\typeout{Package `\csbook@filename', \csbook@fileversion, <\csbook@filedate>}
}
\ProvidesPackage{\csbook@filename}[\csbook@version\space A LaTeX package for typesetting computer science books]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Engine Check
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{iftex} % Package to detect the TeX engine

% Verify if the engine is XeLaTeX or LuaLaTeX
\ifXeTeX
	\typeout{Running with XeLaTeX. The package is compatible.}
\else
	\ifLuaTeX
		\typeout{Running with LuaLaTeX. The package is compatible.}
	\else
		\PackageError{\csbook@filename}{This package is only compatible with XeLaTeX or LuaLaTeX.}{An unsupported engine has been detected. The package cannot function.}
	\fi
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Programming Tools
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{calc} % LaTeX calculations
\RequirePackage{etoolbox} % Advanced conditionals
\RequirePackage{xpatch} % Flexible command patching

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Macro Definition Tools
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{xparse} % Complex macro definitions
\RequirePackage{xkeyval} % Key-value arguments
\RequirePackage{kvoptions} % Manage key-value options

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Class Option Definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newbool{forebook}          % Ebook-specific settings
\newbool{forprint}          % Print-specific settings
\newbool{usebiblatex}       % Enable BibLaTeX
\newbool{usecodelists}      % Enable code lists
\newbool{useebgaramond}     % Enable EB Garamond font
\newbool{usefancythm}       % Fancy theorem formatting
\newbool{usefiramono}       % Enable Fira Mono font
\newbool{usefirasans}       % Enable Fira Sans font
\newbool{useinconsolata}    % Enable Inconsolata font
\newbool{usekepler}         % Enable KP font
\newbool{uselibsans}        % Enable Libertinus Sans font
\newbool{uselmodern}        % Enable Latin Modern font
\newbool{uselmsans}         % Enable Latin Modern Sans font
\newbool{usenormalthm}      % Standard theorem formatting
\newbool{useoldlmodern}     % Old Latin Modern font
\newbool{usesourcecode}     % Source Code Pro font
\newbool{usesourcesans}     % Source Sans font
\newbool{usesrtbiblatex}    % Sorted BibLaTeX
\newbool{usetikz}           % Enable TikZ

% Boolean Initialization (defaults off)
\setbool{forebook}{false}
\setbool{forprint}{false}
\setbool{usebiblatex}{false}
\setbool{usecodelists}{false}
\setbool{useebgaramond}{false}
\setbool{usefancythm}{false}
\setbool{usefiramono}{false}
\setbool{usefirasans}{false}
\setbool{useinconsolata}{false}
\setbool{usekepler}{false}
\setbool{uselibsans}{false}
\setbool{uselmodern}{false}
\setbool{uselmsans}{false}
\setbool{usenormalthm}{false}
\setbool{useoldlmodern}{false}
\setbool{usesourcecode}{false}
\setbool{usesourcesans}{false}
\setbool{usesrtbiblatex}{false}
\setbool{usetikz}{false}

% Option Definitions
\DeclareOption{forebook}{\setbool{forebook}{true}}
\DeclareOption{forprint}{\setbool{forprint}{true}}
\DeclareOption{usebiblatex}{\setbool{usebiblatex}{true}}
\DeclareOption{usecodelists}{\setbool{usecodelists}{true}}
\DeclareOption{useebgaramond}{\setbool{useebgaramond}{true}}
\DeclareOption{usefancythm}{\setbool{usefancythm}{true}}
\DeclareOption{usefiramono}{\setbool{usefiramono}{true}}
\DeclareOption{usefirasans}{\setbool{usefirasans}{true}}
\DeclareOption{useinconsolata}{\setbool{useinconsolata}{true}}
\DeclareOption{usekepler}{\setbool{usekepler}{true}}
\DeclareOption{uselibsans}{\setbool{uselibsans}{true}}
\DeclareOption{uselmodern}{\setbool{uselmodern}{true}}
\DeclareOption{uselmsans}{\setbool{uselmsans}{true}}
\DeclareOption{usenormalthm}{\setbool{usenormalthm}{true}}
\DeclareOption{useoldlmodern}{\setbool{useoldlmodern}{true}}
\DeclareOption{usesourcecode}{\setbool{usesourcecode}{true}}
\DeclareOption{usesourcesans}{\setbool{usesourcesans}{true}}
\DeclareOption{usesrtbiblatex}{\setbool{usesrtbiblatex}{true}}
\DeclareOption{usetikz}{\setbool{usetikz}{true}}

% Handle Unrecognized Options
\DeclareOption*{\PackageWarning{csbook}{Unrecognised option '\CurrentOption'}}

% Process Options
\ProcessOptions\relax

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PDF Management and External File Handling
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[2.0, objcompress, compress]{bxpdfver} % PDF version and compression settings
\RequirePackage{comment} % List environments with conditional comments
\RequirePackage{pdfpages} % Include external PDF pages
\RequirePackage{pdflscape} % Enable landscape pages
\RequirePackage{ragged2e} % Enhanced justification options

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package for Color Support
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[x11names, dvipsnames, svgnames]{xcolor} % Extended color schemes

% Variable initialization for accent color
\newcommand{\declvar}[2]{\def#1{#2}} % Declare variables
\declvar{\accentcolor}{RoyalBlue4} % Default accent color

% Command to set accent color
\newcommand{\setaccentcolor}[1]{%
	\ifx\relax#1\relax
		\declvar{\accentcolor}{RoyalBlue4} % Reset to default if empty
	\else
		\declvar{\accentcolor}{#1} % Set user color
	\fi
	\colorlet{accentcolor}{\accentcolor} % Update color
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language and Typographic Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[english]{babel}  % English language support
\RequirePackage[autostyle=true, csdisplay=true]{csquotes} % Enhanced quotations
\RequirePackage[babel=true]{microtype} % Microtypography for XeTeX and LuaLaTeX

% Conditional options for XeTeX and LuaLaTeX
\ifxetex\PassOptionsToPackage{protrusion=true}{microtype}\fi
\ifluatex\PassOptionsToPackage{protrusion=true,expansion=true}{microtype}\fi

% Line spacing and text symbols configuration
\RequirePackage[onehalfspacing]{setspace}  % 1.5 line spacing
\RequirePackage[full]{textcomp}  % Extra symbols
\RequirePackage[normalem]{ulem}  % Underlining and strikethrough

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Layout Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\forebook}{%
	% Mobile eBook layout (optimized for small screens)
	\RequirePackage[%
		paperwidth=6in,         % Mobile screen width
		paperheight=9in,        % Mobile screen height (portrait mode)
		left=0.5in,             % Narrow left margin
		right=0.5in,            % Narrow right margin
		top=0.5in,              % Top margin
		bottom=0.5in,           % Bottom margin
		headheight=10pt,        % Minimal header
		headsep=10pt,           % Space between header and text
		footskip=15pt,          % Footer space
		textheight=6.5in,       % Text block height
		textwidth=4.4in,        % Text block width
		centering,              % Center content
		includeheadfoot         % Include minimal headers/footers
	]{geometry}                 % Mobile eBook layout
}

\newcommand{\forprint}{%
	% A4 layout for print
	\RequirePackage[%
		a4paper,                % A4 paper size
		left=1.5in,             % Left margin for binding
		right=1in,              % Right margin
		top=1in,                % Top margin
		bottom=1in,             % Bottom margin
		bindingoffset=0.5in,    % Binding offset
		headheight=15pt,        % Header height
		headsep=20pt,           % Space between header and text
		footskip=25pt,          % Footer space
		textheight=9.5in,       % Text block height
		textwidth=6in,          % Text block width
		centering,              % Center text block
		includeheadfoot         % Include headers/footers
	]{geometry}                 % Page layout management
}

\ifbool{forprint}{\forprint}{%
	\ifbool{forebook}{\forebook}{%
		% Default for general eBook layout
		\RequirePackage[%
			a4paper,               % A4 paper size
			tmargin=3.00cm,        % Top margin
			bmargin=3.00cm,        % Bottom margin
			lmargin=3.00cm,        % Left margin
			rmargin=3.00cm,        % Right margin
			footskip=1.00cm        % Footer distance
		]{geometry}                % Page layout management
	}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customization of Headers and Footers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{fancyhdr} % Package for custom header and footer formatting

\fancyhf{} % Clear the default header and footer settings

% Header configuration
\fancyhead[LE, RO]{\normalfont\small\sffamily\thepage} % Position page number on the left (even) and right (odd) pages
\fancyhead[LO, RE]{\normalfont\small\sffamily\@title}  % Position document title on the left (odd) and right (even) pages

\renewcommand{\headrulewidth}{0.25pt} % Set header rule thickness to 0.25pt

\pagestyle{fancy} % Activate the custom header/footer style

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Font and Mathematics Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[T1]{fontenc}            % Enable T1 font encoding for enhanced font support
\RequirePackage{amsfonts}               % Load AMS fonts for mathematical symbols
\RequirePackage{amsmath}                % Provide advanced mathematical formatting
\RequirePackage{amssymb}                % Additional symbols for mathematical typesetting
\RequirePackage{bm}                     % Boldface math symbols
\RequirePackage{mathrsfs}               % Script-style fonts for mathematical notation
\RequirePackage{mathtools}              % Extend mathematical functionality with additional features
\RequirePackage{nicefrac}               % Provide diagonal fractions
\RequirePackage{sansmath}               % Enable sans-serif font for mathematical expressions
\RequirePackage{siunitx}                % Handle units and numerical data consistently

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theorem and Environments Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{amsthm}                 % Support for theorem environments
\RequirePackage{thmtools}               % Enhance theorem environments with additional features

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fontspec and Unicode Math (XeLaTeX/LuaLaTeX)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{fontspec}               % Support for custom fonts (XeLaTeX/LuaLaTeX only)
\RequirePackage{unicode-math}           % Enable Unicode math fonts for consistent typesetting

% Old Latin Modern font configuration for text and math
\newcommand{\useoldlmodern}{%
	\setmainfont[%
		ItalicFont = lmroman10-italic.otf, % Italic font
		SmallCapsFont = lmromancaps10-regular.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = lmroman10-bold.otf, % Bold font
		BoldItalicFont = lmroman10-bolditalic.otf, % Bold italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{lmroman10-regular.otf} % Regular text font
	\setmathfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{latinmodern-math.otf} % Math font
	\setsansfont[%
		ItalicFont = lmsans10-oblique.otf, % Italic sans font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = lmsans10-bold.otf, % Bold sans font
		BoldItalicFont = lmsans10-boldoblique.otf, % Bold-italic sans font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{lmsans10-regular.otf} % Sans-serif font
}

% Latin Modern font configuration for text and math
\newcommand{\uselmodern}{%
	\setmainfont[%
		ItalicFont = NewCM10-BookItalic.otf, % Italic font
		SmallCapsFont = NewCM10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCM10-Bold.otf, % Bold font
		BoldItalicFont = NewCM10-BoldItalic.otf, % Bold italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCM10-Book.otf} % Regular text font
	\setmathfont{NewCMMath-Book.otf} % Math font
	\setsansfont[%
		ItalicFont = NewCMSans10-Oblique.otf, % Italic sans font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCMSans10-Bold.otf, % Bold sans font
		BoldItalicFont = NewCMSans10-BoldOblique.otf, % Bold-italic sans font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCMSans10-Book.otf} % Sans-serif font
}

% EB Garamond font configuration for text and math
\newcommand{\useebgaramond}{%
	\setmainfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {3,5} % Stylistic sets
	]{EB Garamond} % Main text font
	\setmathfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {2,6,7,9} % Stylistic sets
	]{Garamond-Math.otf} % Math font
}

% Kepler font configuration
\newcommand{\usekepler}{%
	\RequirePackage{kpfonts-otf} % Load Kepler package
	\let\D\relax % Reset definition of \D
}

% Libertinus Sans font configuration
\newcommand{\uselibsans}{%
	\setsansfont[%
		UprightFont = LibertinusSans-Regular, % Regular font
		BoldFont = LibertinusSans-Bold.otf, % Bold font
		ItalicFont = LibertinusSans-Italic.otf, % Italic font
		SmallCapsFont = LibertinusSans-Regular, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {1,3} % Stylistic sets
	]{LibertinusSans-Regular.otf} % Set as default sans font
}

% Latin Modern Sans font configuration
\newcommand{\uselmsans}{%
	\setsansfont[%
		ItalicFont = NewCMSans10-Oblique.otf, % Italic font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCMSans10-Bold.otf, % Bold font
		BoldItalicFont = NewCMSans10-BoldOblique.otf, % Bold-italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCMSans10-Book.otf} % Set as default sans-serif font
}

% Source Sans Pro font configuration
\newcommand{\usesourcesans}{%
	\RequirePackage[otf, lining, proportional, scale=0.975]{sourcesanspro} % Load package with options
	\setsansfont[%
		Scale = 0.950, % Font scale
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{Source Sans Pro} % Set Source Sans font
}

% Source Code Pro font configuration
\newcommand{\usesourcecode}{%
	\RequirePackage[otf, lining, scale=0.865]{sourcecodepro} % Load package with options
	\setmonofont[%
		Scale = 0.865, % Font scale
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{Source Code Pro} % Set monospaced font
}

% Fira Sans font configuration
\newcommand{\usefirasans}{%
	\setsansfont[%
		Scale = 0.925, % Font scale
		BoldFont = {FiraSans-Bold.otf}, % Bold font
		ItalicFont = {FiraSans-BookItalic.otf}, % Italic font
		BoldItalicFont = {FiraSans-BoldItalic.otf}, % Bold-italic font
		SmallCapsFont = {FiraSans-Book.otf}, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{FiraSans-Book.otf} % Set Fira Sans font
}

% Fira Mono font configuration
\newcommand{\usefiramono}{%
	\setmonofont[%
		Scale = 0.865, % Font scale
		BoldFont = {FiraMono-Bold.otf}, % Bold font
		ItalicFont = {FiraMono-Oblique.otf}, % Italic font
		BoldItalicFont = {FiraMono-BoldOblique.otf}, % Bold-italic font
		SmallCapsFont = {FiraMono-Regular.otf}, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{FiraMono-Regular.otf}
}

% Inconsolata font configuration
\newcommand{\useinconsolata}{%
	\setmonofont[%
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{inconsolata}
}

% Apply fonts based on flags
\ifbool{useebgaramond}{\useebgaramond}{\typeout{EB Garamond fonts not applied.}}
\ifbool{usekepler}{\usekepler}{\typeout{Kepler fonts not applied.}}
\ifbool{uselmodern}{\uselmodern}{\typeout{Latin Modern fonts not applied.}}
\ifbool{useoldlmodern}{\useoldlmodern}{\typeout{Old Latin Modern fonts not applied.}}

\ifbool{useinconsolata}{\useinconsolata}{\typeout{Inconsolata fonts not applied.}}
\ifbool{usefiramono}{\usefiramono}{\typeout{Fira Mono fonts not applied.}}
\ifbool{usesourcecode}{\usesourcecode}{\typeout{Source Code fonts not applied.}}

\ifbool{usefirasans}{\usefirasans}{\typeout{Fira Sans fonts not applied.}}
\ifbool{uselibsans}{\uselibsans}{\typeout{Libertinus Sans fonts not applied.}}
\ifbool{uselmsans}{\uselmsans}{\typeout{Libertinus Sans fonts not applied.}}
\ifbool{usesourcesans}{\usesourcesans}{\typeout{Source Sans fonts not applied.}}

% Resolve math font conflicts
\AtEndPreamble{%
	\let\mathbfcal\relax
	\RequirePackage[%
		bb=bboldx,  % Blackboard bold
		cal=cm      % Calligraphic font
	]{mathalpha}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom Sectioning Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[explicit, compact]{titlesec}

% Font styles
\newcommand{\headerfont}{\sffamily}
\newcommand{\partfont}{\normalfont\headerfont}
\newcommand{\sectionfont}{\Large\headerfont}
\newcommand{\subsectionfont}{\large\headerfont}
\newcommand{\subsubsectionfont}{\normalsize\headerfont}

\AtEndPreamble{%
	% Part title formatting
	\titleformat{\part}[display]
	{\partfont\RaggedRight}
	{\color{accentcolor}\LARGE\partname~\thepart}
	{0pt}
	{\titlerule\bigskip\Huge#1\vfill}
	\titlespacing*{\part}{0pt}{\fill}{\fill}
	
	% Chapter title formatting
	\titleformat{\chapter}[display]
	{\LARGE\headerfont}
	{\RaggedLeft{\rmfamily\scshape\large\chaptertitlename}~\Huge\color{accentcolor}\thechapter}
	{1ex}
	{\titlerule\vspace{1ex}#1}[\vspace{1ex}\titlerule]
	\titlespacing*{\chapter}{0pt}{25pt}{25pt}
	
	% Section title formatting
	\titleformat{\section}[block]
	{\sectionfont}
	{\color{accentcolor}\huge\thesection}
	{10pt}
	{#1}[\vspace{5pt}\titlerule]
	\titlespacing*{\section}{0pt}{15pt}{10pt}
	
	% Subsection title formatting
	\titleformat{\subsection}[block]
	{\subsectionfont}
	{\color{accentcolor}\Large\thesubsection}
	{7.5pt}
	{#1}
	
	% Subsubsection title formatting
	\titleformat{\subsubsection}[runin]
	{\subsubsectionfont}
	{\color{accentcolor}\thesubsubsection}
	{5pt}
	{#1.}
	
	% Paragraph and subparagraph formatting
	\renewcommand*{\paragraph}[1]{\noindent\normalfont{\textbf{#1.}}}
	\renewcommand*{\subparagraph}[1]{\noindent\normalfont{\textsc{#1.}}}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Local Table of Contents
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{etoc} % Load etoc package for local TOC

\etockeeporiginaltableofcontents % Preserve original TOC settings

% Generates a local TOC with custom formatting
\newcommand{\localtoc}{%
	\begingroup
	\etocsettocstyle{}{} % Clear default TOC headings
	\etocsetnexttocdepth{section} % Set TOC depth (up to section level)
	\etocsetstyle{section}
	{}{}{ % Formatting for each TOC entry
		\sffamily\scshape\etocnumber\hspace*{10pt}\etocname\nobreak
		\hskip5pt\dotfill\hskip5pt\nobreak
		\etocpage\par
	}{}
	{\color{accentcolor}\rule{\textwidth}{0.5pt}\medskip} % Horizontal rule with accent color
	\localtableofcontents % Generate local TOC
	{\medskip\noindent\color{accentcolor}\rule{\textwidth}{0.5pt}} % Horizontal rule after TOC
	\endgroup
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of Contents Customization
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[titles]{tocloft} % Enhance TOC customization

% Adjust spacing after section numbers
\renewcommand{\cftpartafterpnum}{\vskip1pt}         % Part number spacing
\renewcommand{\cftchapafterpnum}{\vskip1pt}         % Chapter number spacing
\renewcommand{\cftsecafterpnum}{\vskip1pt}          % Section number spacing
\renewcommand{\cftsubsecafterpnum}{\vskip1pt}       % Subsection number spacing
\renewcommand{\cftsubsubsecafterpnum}{\vskip1pt}    % Subsubsection number spacing

% Adjust number alignment widths
\addtolength{\cftpartnumwidth}{2.5pt}      % Part number width
\addtolength{\cftchapnumwidth}{5.0pt}      % Chapter number width
\addtolength{\cftsecnumwidth}{3.5pt}       % Section number width
\addtolength{\cftsubsecnumwidth}{3.5pt}    % Subsection number width
\addtolength{\cftsubsubsecnumwidth}{3.5pt} % Subsubsection number width

% Set indentation for TOC entries
\addtolength{\cftsecindent}{5pt}           % Section indentation
\addtolength{\cftsubsecindent}{8.5pt}      % Subsection indentation
\addtolength{\cftsubsubsecindent}{12pt}    % Subsubsection indentation

% Customize font styles for TOC entries
\renewcommand{\cftpartfont}{\Large\sffamily}           % Part font style
\renewcommand{\cftchapfont}{\large\scshape}            % Chapter font style
\renewcommand{\cftsecfont}{\normalsize\scshape}        % Section font style
\renewcommand{\cftsubsecfont}{\normalsize}             % Subsection font style
\renewcommand{\cftsubsubsecfont}{\normalsize}          % Subsubsection font style

% Set numbering and TOC depth
\setcounter{secnumdepth}{4} % Numbering depth (part, chapter, section, subsection)
\setcounter{tocdepth}{2}    % TOC entries depth (part, chapter, section)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Support for Creating Indexes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[makeindex]{imakeidx} % Package for managing and generating indexes

% Define a custom index style in the file
\begin{filecontents}{csindex.ist}
quote '+'
letter_group
symhead_positive "Symbols"
numhead_positive "Numbers"
headings_flag 1
heading_prefix "\\textcolor{\\accentcolor}{\\large\\textbf{" heading_suffix "}}\n"
delim_0 "\\dotfill"
delim_1 "\\dotfill"
delim_2 "\\dotfill"
delim_r "\\dotfill"
preamble "\\begin{theindex}\n\\small\n"
postamble "\n\\end{theindex}\n"
\end{filecontents}

% Create the index with cs style, title, and 2-column layout
\makeindex[intoc, title=Index, columns=2, options=-s csindex] % Create index with custom style and 2-column layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyperlinks and Metadata Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[pdfusetitle]{hyperref}  % Enable hyperlinks and PDF metadata
\RequirePackage{bookmark}               % Handle PDF bookmarks
\RequirePackage{xurl}                   % Handle line breaks for long URLs

% Configure Hyperref settings
\hypersetup{%
	pdfsubject={Computer Science},    % Document subject
	pdfkeywords={computer science},   % Keywords for searchability
	colorlinks=true,                  % Enable colored links
	citecolor=accentcolor!75!black,   % Citation link color
	linkcolor=accentcolor!75!black,   % Internal link color
	urlcolor=accentcolor!75!black,    % URL link color
	frenchlinks=true,                 % Small caps for links
	unicode=true,                     % Enable Unicode in links
	bookmarksnumbered=true,           % Numbered bookmarks
	breaklinks=true                   % Line breaks for long URLs
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Style Customizations for Document Structure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Front matter
\let\oldfrontmatter\frontmatter % Preserve the original \frontmatter command
\renewcommand{\frontmatter}{%
	\oldfrontmatter % Execute the original \frontmatter command
	\pagestyle{plain} % Set page style to plain for front matter
}

% Main matter
\let\oldmainmatter\mainmatter % Preserve the original \mainmatter command
\renewcommand{\mainmatter}{%
	\oldmainmatter % Execute the original \mainmatter command
	\@openrighttrue % Ensure chapters begin on right-hand pages
	\pagestyle{fancy} % Apply the fancy page style to the main matter
}

% Back matter
\let\oldbackmatter\backmatter % Preserve the original \backmatter command
\renewcommand{\backmatter}{%
	\oldbackmatter % Execute the original \backmatter command
	\@openrighttrue % Ensure sections begin on right-hand pages
	\bookmarksetup{startatroot} % Configure bookmarks to start at the root level
	\pagestyle{plain} % Apply the plain page style to the back matter
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package for Customizing Lists
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{enumitem} % List customization package

% Global List Settings
\setlist{nosep, noitemsep} % Remove extra spacing in lists

% Customize Enumerate Labels
\setlist[enumerate, 1]{label=(\arabic*)}    % First level (1, 2, 3, ...)
\setlist[enumerate, 2]{label=(\alph*)}      % Second level (a, b, c, ...)

% Redefine Bullet Symbols for Itemize
\renewcommand{\labelitemi}{\ensuremath{\color{accentcolor}\bullet}} % First level bullet
\renewcommand{\labelitemii}{\ensuremath{\color{accentcolor}\circ}}   % Second level circle
\renewcommand{\labelitemiii}{\ensuremath{\color{accentcolor}\ast}}  % Third level asterisk
\renewcommand{\labelitemiv}{\ensuremath{\color{accentcolor}\star}}  % Fourth level asterisk

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages for Captions and Graphics
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{float}       % Precise control over figure/table placement
\RequirePackage{graphics}    % Basic graphics inclusion
\RequirePackage{graphicx}    % Advanced graphic formats (PDF, EPS, etc.)
\RequirePackage{subcaption}  % Handle subfigures/subcaptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages for Typesetting Algorithms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[algonl, boxed, longend, vlined]{algorithm2e} % Algorithm formatting
\SetAlFnt{\small}                               % Small font for algorithms
\SetAlCapNameFnt{\normalfont\sffamily}          % Caption font style
\SetAlCapFnt{\normalfont\sffamily\color{accentcolor}} % Caption color
\SetAlgoSkip{medskip}                           % Space between steps
\SetAlgoInsideSkip{medskip}                     % Space inside algorithm
\SetAlCapSkip{1em}                              % Caption spacing
\SetAlgoNlRelativeSize{-2}                      % Smaller line numbers
\SetNlSty{texttt}{[}{]}                         % Line number styling
\SetAlgoCaptionSeparator{.}                     % Caption separator

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages for Creating Framed Environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Load mdframed package for framed environments
\RequirePackage[%
	skipabove=10pt,            % Vertical space above the frame
	skipbelow=10pt,            % Vertical space below the frame
	ntheorem,                  % Enable theorem-style environments
	framemethod=Tikz          % Use TikZ for framing
]{mdframed}

% Custom framed environment "tboxed"
\newmdenv[%
	font=\normalfont\small,           % Set font size
	frametitlefont=\bfseries,         % Set title font
	tikzsetting={draw=black},         % Set frame colour
	backgroundcolor=none,            % No background colour
	skipabove=10pt, skipbelow=10pt,  % Vertical spacing
	innerleftmargin=7.5pt,           % Left margin
	innerrightmargin=7.5pt,          % Right margin
	innertopmargin=10pt,             % Top margin
	innerbottommargin=10pt,          % Bottom margin
	roundcorner=1pt                  % Rounded corners
]{tboxed}

% Custom framed environment "colbox"
\newmdenv[%
	font=\normalfont\small,           % Set font size
	frametitlefont=\bfseries,         % Set title font
	hidealllines=true,                % Hide all lines
	backgroundcolor={accentcolor!10!white},  % Set background colour
	skipabove=10pt, skipbelow=10pt,  % Vertical spacing
	innerleftmargin=7.5pt,           % Left margin
	innerrightmargin=7.5pt,          % Right margin
	innertopmargin=10pt,             % Top margin
	innerbottommargin=10pt,          % Bottom margin
	roundcorner=1pt                  % Rounded corners
]{colbox}

% Load tcolorbox package
\RequirePackage[most]{tcolorbox}  % Enable extended features

% Define the command for creating two environments: numbered and unnumbered
\NewDocumentCommand{\newcolorboxes}{mmm}{%
	\newcounter{#1ctr} % Define counter for numbered version
	
	% Numbered version
	\newtcolorbox{#1}[1][]{%
		enhanced, % Enable advanced features
		colback=#3!5, % Light background
		colframe=#3!80!black, % Dark frame
		arc=1pt, % Rounded corners
		boxrule=0.5pt, % Border thickness
		fonttitle=\color{black}\sffamily, % Title font
		before upper={\parindent0pt}, % No indent before content
		before lower={\parindent0pt}, % No indent after content
		fontupper=\color{black}\normalfont, % Content font
		fontlower=\color{black}\normalfont, % Content font
		right=15pt, top=15pt, bottom=15pt, % Padding
		attach boxed title to top left={yshift=-5pt,xshift=10pt}, % Title position
		boxed title style={%
			colback=#3!5, % Title background
			colframe=#3!50!black, % Title frame
			arc=1pt, % Rounded corners
			boxrule=0.5pt % Border thickness
		},
		title={\refstepcounter{#1ctr}#2~\thesection.\arabic{#1ctr}%
			\if\relax\detokenize{##1}\relax\else: ##1\fi} % Title with counter
	}%
	
	% Unumbered version
	\newtcolorbox{#1*}[1][]{%
		enhanced, % Enable advanced features
		colback=#3!5, % Light background
		colframe=#3!80!black, % Dark frame
		arc=1pt, % Rounded corners
		boxrule=0.5pt, % Border thickness
		fonttitle=\color{black}\sffamily, % Title font
		before upper={\parindent0pt}, % No indent before content
		before lower={\parindent0pt}, % No indent after content
		fontupper=\color{black}\normalfont, % Content font
		fontlower=\color{black}\normalfont, % Content font
		right=15pt, top=15pt, bottom=15pt, % Padding
		attach boxed title to top left={yshift=-5pt,xshift=10pt}, % Title position
		boxed title style={%
			colback=#3!5, % Title background
			colframe=#3!50!black, % Title frame
			arc=1pt, % Rounded corners
			boxrule=0.5pt % Border thickness
		},
		title={#2%
			\if\relax\detokenize{##1}\relax\else: ##1\fi} % Title with optional text
	}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Glossaries and Acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Load glossaries-extra with options
\RequirePackage[
	automake,                % Auto-generate glossary
	acronym,                 % Enable acronyms
	symbols,                 % Include symbols
	nonumberlist,            % No numbering for entries
	nogroupskip,             % Disable group skipping
	indexonlyfirst,          % Index only first occurrence
	stylemods=longextra,     % Use longextra style
	nopostdot,               % No period after entries
	toc                      % Add to Table of Contents
]{glossaries-extra}

% Initialise glossary system
\makeglossaries

\setabbreviationstyle[acronym]{long-short}  % Acronym style
\renewcommand{\glsnamefont}[1]{{\normalfont\sffamily\color{accentcolor}#1.}} % Glossary name font
\renewcommand{\glossarypreamble}{\begin{normalsize}} % Glossary preamble
\renewcommand{\glossarypostamble}{\end{normalsize}} % Glossary postamble

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Abstract Environment Definition
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{abstract}{%
	\quotation\small % Quotation environment for abstract
	\textsf{\color{accentcolor}\abstractname}.\
}{%
	\endquotation % End quotation in single-column mode
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendix Handling Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Advanced appendix package options
\RequirePackage[%
	toc,        % Include appendices in TOC
	page,       % Start each appendix on a new page
	title,      % Prefix "Appendix" to titles
	header,     % Add "Appendix" to headers
	titletoc    % Add "Appendix" in TOC
]{appendix}

% Save and redefine \appendix command for customization
\let\oldappendices\appendix
\renewcommand{\appendix}{%
	\part*{Appendix} % Display "Appendix" title without numbering
	\oldappendices    % Keep original appendix functionality
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customizations for verbatim environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{verbatim}  % Raw text/code inclusion
\RequirePackage{lettrine}  % First letter stylization
\RequirePackage{fancyvrb}  % Enhanced verbatim environments

% Redefine verbatim line processing
\newcommand{\savedverbatim@processline}{} % Save original command
\let\savedverbatim@processline=\verbatim@processline

\renewcommand{\verbatim@processline}{%
	\let\verbatim@processline=\savedverbatim@processline
	\if\relax\the\verbatim@line\relax
	\else
		\the\verbatim@line\par
	\fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Imports for Enhanced Table, Figure, and Layout Control
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[bottom, multiple, hang]{footmisc} % Custom footnote formatting
\RequirePackage{adjustbox}           % For advanced content adjustments
\RequirePackage{array}               % Enhancements for array/tabular environments
\RequirePackage{booktabs}            % Professional-quality table lines and rules
\RequirePackage{footnote}            % Enables footnotes within the document
\RequirePackage{longtable}           % Tables that span multiple pages
\RequirePackage{multicol}            % Supports multi-column formatting
\RequirePackage{multirow}            % Allows multi-row spanning in tables
\RequirePackage{tabularx}            % Flexible tables with adjustable column width
\RequirePackage{wrapfig}             % Enables text wrapping around figures

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Drawings and Diagrams
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\usetikz}{%
	\RequirePackage{tikz}         % Load TikZ for creating graphics and diagrams
	\RequirePackage{tikz-cd}      % Load TikZ-cd for commutative diagrams
	\RequirePackage{tikzscale}    % Load tikzscale to automatically scale TikZ figures
	\RequirePackage{pgfplots}     % Load pgfplots for advanced plotting
	\pgfplotsset{compat=1.18}     % Set compatibility with version 1.18
}

\ifbool{usetikz}{\usetikz}{\typeout{TikZ and related packages are not included.}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Captions Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\AtBeginDocument{%
	\RequirePackage[%
		font={rm},                        % Sets caption text to serif font
		labelfont={color=accentcolor,sf}, % Configures label font and color
		labelsep=period,                  % Separates label and content with a period
		skip=1em,                         % Adds vertical spacing before captions
		position=below                    % Forces captions to appear below the figure or table
	]{caption}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Epigraphs and Dedications
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{epigraph} % Load epigraph package for quotes and attributions

% Epigraph Formatting
\setlength{\epigraphrule}{0.65pt} % Thickness of the rule below epigraphs
\setlength{\epigraphwidth}{0.6\textwidth} % Width of the epigraph text block
\renewcommand{\textflush}{flushright} % Align epigraph text to the right
\renewcommand{\epigraphsize}{\small} % Set epigraph text size

% Modify epigraph to customise author font and size
\let\oldepigraph\epigraph
\renewcommand{\epigraph}[2]{%
	\oldepigraph{#1}{\medskip\normalfont\sffamily#2}
}

% Dedication Command: Formats a single dedication
\newcommand{\dedication}[2]{%
	\epigraph{#1}{#2}
}

% Generate Dedications: Produces a page of dedications
\newcommand{\generateDedications}[1]{%
	\thispagestyle{empty} % Remove header/footer and page numbers
	\begin{center}
		\vspace*{\fill} % Add vertical space to centre the content
		\large #1 % Display dedications in a larger font
		\vspace*{\fill} % Add vertical space after content
	\end{center}
	\clearpage % Ensure proper page break
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of New Environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\commonfont}{\color{accentcolor}\sffamily} % Common font with accent color and sans-serif
\newcommand{\commonsymb}{\ensuremath{\color{accentcolor}\lrcorner}} % Common symbol with accent color
\renewcommand{\qedsymbol}{$\scriptstyle\color{\accentcolor}\blacksquare$} % Custom QED symbol in accent color

\newcommand{\basicenv}{%
	% Theorem-like Environments
	\declaretheorem[style=thmstyle,name=Theorem]{theorem}
	\declaretheorem[style=thmstyle,name=Assertion]{assertion}
	\declaretheorem[style=thmstyle,name=Assumption]{assumption}
	\declaretheorem[style=thmstyle,name=Axiom]{axiom}
	\declaretheorem[style=thmstyle,name=Claim]{claim}
	\declaretheorem[style=thmstyle,name=Conclusion]{conclusion}
	\declaretheorem[style=thmstyle,name=Conjecture]{conjecture}
	\declaretheorem[style=thmstyle,name=Corollary]{corollary}
	\declaretheorem[style=thmstyle,name=Fact]{fact}
	\declaretheorem[style=thmstyle,name=Hypothesis]{hypothesis}
	\declaretheorem[style=thmstyle,name=Lemma]{lemma}
	\declaretheorem[style=thmstyle,name=Postulate]{postulate}
	\declaretheorem[style=thmstyle,name=Property]{property}
	\declaretheorem[style=thmstyle,name=Proposition]{proposition}

	% Unnumbered Theorem-like Environments
	\declaretheorem[style=thmstyle,unnumbered,name=Theorem*]{theorem*}
	\declaretheorem[style=thmstyle,unnumbered,name=Assertion*]{assertion*}
	\declaretheorem[style=thmstyle,unnumbered,name=Assumption*]{assumption*}
	\declaretheorem[style=thmstyle,unnumbered,name=Axiom*]{axiom*}
	\declaretheorem[style=thmstyle,unnumbered,name=Claim*]{claim*}
	\declaretheorem[style=thmstyle,unnumbered,name=Conclusion*]{conclusion*}
	\declaretheorem[style=thmstyle,unnumbered,name=Conjecture*]{conjecture*}
	\declaretheorem[style=thmstyle,unnumbered,name=Corollary*]{corollary*}
	\declaretheorem[style=thmstyle,unnumbered,name=Fact*]{fact*}
	\declaretheorem[style=thmstyle,unnumbered,name=Hypothesis*]{hypothesis*}
	\declaretheorem[style=thmstyle,unnumbered,name=Lemma*]{lemma*}
	\declaretheorem[style=thmstyle,unnumbered,name=Postulate*]{postulate*}
	\declaretheorem[style=thmstyle,unnumbered,name=Property*]{property*}
	\declaretheorem[style=thmstyle,unnumbered,name=Proposition*]{proposition*}

	% Definition-like Environments
	\declaretheorem[style=defstyle,name=Application]{application}
	\declaretheorem[style=defstyle,name=Construction]{construction}
	\declaretheorem[style=defstyle,name=Convention]{convention}
	\declaretheorem[style=defstyle,name=Definition]{definition}
	\declaretheorem[style=defstyle,name=Experiment]{experiment}
	\declaretheorem[style=defstyle,name=Notation]{notation}
	\declaretheorem[style=defstyle,name=Problem]{problem}
	\declaretheorem[style=defstyle,name=Protocol]{protocol}

	% Unnumbered Definition-like Environments
	\declaretheorem[style=defstyle,unnumbered,name=Application*]{application*}
	\declaretheorem[style=defstyle,unnumbered,name=Construction*]{construction*}
	\declaretheorem[style=defstyle,unnumbered,name=Convention*]{convention*}
	\declaretheorem[style=defstyle,unnumbered,name=Definition*]{definition*}
	\declaretheorem[style=defstyle,unnumbered,name=Experiment*]{experiment*}
	\declaretheorem[style=defstyle,unnumbered,name=Notation*]{notation*}
	\declaretheorem[style=defstyle,unnumbered,name=Problem*]{problem*}
	\declaretheorem[style=defstyle,unnumbered,name=Protocol*]{protocol*}

	% Remark-like Environments
	\declaretheorem[style=remarkstyle,name=Commentary]{commentary}
	\declaretheorem[style=remarkstyle,name=Example]{example}
	\declaretheorem[style=remarkstyle,name=Exercise]{exercise}
	\declaretheorem[style=remarkstyle,name=Motivation]{motivation}
	\declaretheorem[style=remarkstyle,name=Note]{note}
	\declaretheorem[style=remarkstyle,name=Observation]{observation}
	\declaretheorem[style=remarkstyle,name=Question]{question}
	\declaretheorem[style=remarkstyle,name=Remark]{remark}

	% Unnumbered Remark-like Environments
	\declaretheorem[style=remarkstyle,unnumbered,name=Commentary*]{commentary*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Example*]{example*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Exercise*]{exercise*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Motivation*]{motivation*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Note*]{note*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Observation*]{observation*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Question*]{question*}
	\declaretheorem[style=remarkstyle,unnumbered,name=Remark*]{remark*}

	% Highlight-like Environments
	\declaretheorem[style=hltstyle,name=Highlight]{highlight}
	\declaretheorem[style=hltstyle,name=Important]{important}
	\declaretheorem[style=hltstyle,name=KeyPoint]{keypoint}
	\declaretheorem[style=hltstyle,name=Recall]{recall}

	\let\proof\relax
	\let\endproof\relax
	\declaretheorem[style=proofstyle]{proof}
}

% Define Fancy Theorem Environments
\newcommand{\usefancythm}{%
	% Define the font style commands for each theorem type
	\newcommand{\thmfont}{\normalfont} % Font for theorems
	\newcommand{\defnfont}{\normalfont} % Font for definitions
	\newcommand{\remarkfont}{\normalfont} % Font for remarks
	\newcommand{\hltfont}{\normalfont\sffamily} % Font for highlighted statements

	% Define the color commands for each type
	\newcommand{\thmcolor}{DeepSkyBlue4} % Color for theorems
	\newcommand{\defncolor}{RoyalBlue4} % Color for definitions
	\newcommand{\remarkcolor}{Aquamarine4} % Color for remarks
	\newcommand{\hltcolor}{DeepPink4} % Color for highlighted statements

	% Declare the theorem style for theorems
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,
		headfont=\sffamily\color{\thmcolor},
		notefont=\sffamily\color{\thmcolor},
		bodyfont=\normalfont,
		postheadspace=5pt,
		numberwithin=section,
		mdframed={%
				linewidth=2pt,
				rightline=false, topline=false, bottomline=false,
				linecolor=\thmcolor, backgroundcolor=\thmcolor!5,
			},
		headpunct={.}
	]{thmstyle}

	% Declare the theorem style for definitions
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,
		headfont=\sffamily\color{\defncolor},
		notefont=\sffamily\color{\defncolor},
		bodyfont=\normalfont,
		postheadspace=5pt,
		numberwithin=section,
		mdframed={%
				linewidth=2pt,
				rightline=false, topline=false, bottomline=false,
				linecolor=\defncolor, backgroundcolor=\defncolor!5,
			},
		headpunct={.}
	]{defstyle}

	% Declare the theorem style for remarks
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,
		headfont=\sffamily\color{\remarkcolor},
		notefont=\sffamily\color{\remarkcolor},
		bodyfont=\normalfont,
		postheadspace=5pt,
		numberwithin=section,
		mdframed={%
				linewidth=2pt,
				rightline=false, topline=false, bottomline=false,
				linecolor=\remarkcolor, backgroundcolor=\remarkcolor!5,
			},
		headpunct={.}
	]{remarkstyle}

	% Declare the theorem style for highlighted text
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,
		headfont=\sffamily\color{\hltcolor},
		notefont=\sffamily\color{\hltcolor},
		bodyfont=\normalfont\sffamily\sansmath,
		postheadspace=5pt,
		numberwithin=section,
		mdframed={%
				linewidth=2pt,
				rightline=false, topline=false, bottomline=false,
				linecolor=\hltcolor, backgroundcolor=\hltcolor!5,
			},
		headpunct={.}
	]{hltstyle}

	% Declare the proof style
	\declaretheoremstyle[%
		headfont=\sffamily\color{\thmcolor},
		notefont=\sffamily\color{\thmcolor},
		bodyfont=\normalfont,
		postheadspace=5pt,
		numbered=no,
		headpunct={.},
		qed=$\scriptstyle\color{\thmcolor}\blacksquare$
	]{proofstyle}

	\basicenv
}

% Define Standard Theorem Environments
\newcommand*{\usenormalthm}{%
	\renewcommand{\commonfont}{\color{\accentcolor}\sffamily} % Set common font
	\renewcommand{\commonsymb}{\ensuremath{\color{\accentcolor}\lrcorner}} % Set common symbol

	% Theorem Style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,
		headfont=\commonfont\ensuremath{\scriptstyle\blacktriangleright}~,
		notefont=\commonfont, bodyfont=\normalfont,
		postheadspace=5pt, numberwithin=section, qed=\commonsymb, headpunct={.}
	]{thmstyle}

	% Definition Style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,
		headfont=\commonfont\ensuremath{\scriptstyle\blacksquare}~,
		notefont=\commonfont, bodyfont=\normalfont,
		postheadspace=5pt, numberwithin=section, qed=\commonsymb, headpunct={.}
	]{defstyle}

	% Remark Style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,
		headfont=\commonfont\ensuremath{\scriptstyle\vartriangleright}~,
		notefont=\commonfont, bodyfont=\normalfont,
		postheadspace=5pt, numberwithin=section, qed=\commonsymb, headpunct={.}
	]{remarkstyle}

	% Highlight Style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,
		headfont=\commonfont\ensuremath{\scriptstyle\square}~,
		notefont=\commonfont, bodyfont=\normalfont\sffamily,
		postheadspace=5pt, numberwithin=section, qed=\commonsymb, headpunct={.}
	]{hltstyle}

	% Proof Style
	\declaretheoremstyle[%
		headfont=\commonfont, notefont=\commonfont, bodyfont=\normalfont,
		postheadspace=5pt, numbered=no, headpunct={.},
		qed=$\color{\accentcolor}\scriptstyle\blacktriangleleft$
	]{proofstyle}

	\basicenv
}

% Cleveref for intelligent cross-referencing (better handling of references)
\AtEndOfPackage{%

	% Load Cleveref for smart cross-referencing
	\RequirePackage[capitalise]{cleveref}

	% Theorem-like Environments
	\crefname{theorem}{theorem}{theorems}
	\crefname{assertion}{assertion}{assertions}
	\crefname{assumption}{assumption}{assumptions}
	\crefname{axiom}{axiom}{axioms}
	\crefname{claim}{claim}{claims}
	\crefname{conclusion}{conclusion}{conclusions}
	\crefname{conjecture}{conjecture}{conjectures}
	\crefname{corollary}{corollary}{corollaries}
	\crefname{fact}{fact}{facts}
	\crefname{hypothesis}{hypothesis}{hypotheses}
	\crefname{lemma}{lemma}{lemmas}
	\crefname{postulate}{postulate}{postulates}
	\crefname{property}{property}{properties}
	\crefname{proposition}{proposition}{propositions}

	% Definition-like Environments
	\crefname{application}{application}{applications}
	\crefname{construction}{construction}{constructions}
	\crefname{convention}{convention}{conventions}
	\crefname{definition}{definition}{definitions}
	\crefname{experiment}{experiment}{experiments}
	\crefname{notation}{notation}{notations}
	\crefname{problem}{problem}{problems}
	\crefname{protocol}{protocol}{protocols}

	% Remark-like Environments
	\crefname{commentary}{commentary}{commentaries}
	\crefname{example}{example}{examples}
	\crefname{exercise}{exercise}{exercises}
	\crefname{motivation}{motivation}{motivations}
	\crefname{note}{note}{notes}
	\crefname{observation}{observation}{observations}
	\crefname{question}{question}{questions}
	\crefname{remark}{remark}{remarks}

	% Highlight-like Environments
	\crefname{highlight}{highlight}{highlights}
	\crefname{important}{important}{importants}
	\crefname{keypoint}{keypoint}{keypoints}
	\crefname{recall}{recall}{recalls}
}

% Conditional Theorem Style
\ifbool{usefancythm}{\usefancythm}{\typeout{Using fancy theorem style.}}  % Use fancy theorem style if 'usefancythm' is true
\ifbool{usenormalthm}{\usenormalthm}{\typeout{Using normal theorem style.}}  % Use standard theorem style if 'usenormalthm' is true

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography Management with BibLaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Configure BibLaTeX package with desired settings
\newcommand{\usebiblatex}{%
	\RequirePackage[%
		hyperref=auto,         % Enable compatibility with hyperref for clickable links
		defernumbers=true,     % Delay reference number assignment until all entries are processed
		style=alphabetic,      % Use alphabetic citation style (e.g., [Doe2025])
		backref=true,          % Enable back-references to the citing pages from bibliography
		sorting=anyt,          % Sort entries by their appearance in the text (not alphabetically)
		maxalphanames=99,      % Allow up to 99 names in alphabetic citations before using et al.
		maxnames=999,          % Display up to 999 authors in citations before truncating
		backend=biber          % Use Biber for bibliography processing (recommended over BibTeX)
	]{biblatex}
	% Set bibliography font size
	\renewcommand*{\bibfont}{\small}
	% Customize back-reference text for singular and plural
	\DefineBibliographyStrings{english}{
		backrefpage={\unskip Cited on page},  % Singular back-reference format
		backrefpages={\unskip Cited on pages} % Plural back-reference format
	}
}

% Command to apply sorted bibliography entries
\newcommand{\usesrtbiblatex}{%
	\usebiblatex % Apply BibLaTeX configuration
	\DeclareBibliographyCategory{cited} % Create a 'cited' category for referenced items
	\AtEveryCitekey{\addtocategory{cited}{\thefield{entrykey}}} % Automatically add cited entries to the 'cited' category
}

% Bibliography Setup Logic (if BibLaTeX is enabled)
\newcommand{\setupbibliography}{%
	\ifthenelse{\boolean{usebiblatex}}{%
		% Use BibLaTeX configuration if enabled
		\usebiblatex
	}{%
		\ifthenelse{\boolean{usesrtbiblatex}}{%
			% Use sorted BibLaTeX configuration if enabled
			\usesrtbiblatex
		}{%
			% Fallback if neither BibLaTeX options are enabled
			\typeout{Default bibliography style will be used.}
		}
	}
}

% Set up bibliography management based on configuration
\setupbibliography

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Environments and Custom Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define the 'learned' environment with an optional title (default: 'What Have We Learned?')
\NewDocumentEnvironment{learned}{o}{%
\IfNoValueTF{#1}{%
	\begin{colbox}[frametitle={\normalfont\sffamily\large What Have We Learned?\medskip\hrule}]
}{%
	\begin{colbox}[frametitle={\normalfont\sffamily\large#1\medskip\hrule}]
		}%
		}{%
	\end{colbox}
}

% Define the 'chapternotes' environment with an optional title (default: 'Chapter Notes and History')
\NewDocumentEnvironment{chapternotes}{o}{%
	\IfNoValueTF{#1}{%
		\section*{Chapter Notes and History} % Default title
		\addcontentsline{toc}{section}{Chapter Notes and History} % Add to Table of Contents
	}{%
		\section*{#1} % Custom title
		\addcontentsline{toc}{section}{#1} % Add to Table of Contents
	}%
	\begin{small}
		}{%
	\end{small}
}

% Define the 'problems' environment with custom enumeration (problem set style)
\NewDocumentEnvironment{problems}{o}{%
	\IfNoValueTF{#1}{%
		\section*{Problem Set} % Default title
		\addcontentsline{toc}{section}{Problem Set} % Add to Table of Contents
	}{%
		\section*{#1} % Custom title
		\addcontentsline{toc}{section}{#1} % Add to Table of Contents
	}%
	\small % Set font size
	\setlist[enumerate, 1]{label={$\boxed{\texttt{\scriptsize\thechapter.\arabic*}}$}, labelsep=1.5em, left=0pt, itemsep=0.5em}
	\setlist[enumerate, 2]{label=(\arabic*), left=1em, labelsep=1em, itemsep=0.5em}
	\begin{enumerate}
		}{%
	\end{enumerate}
}

% 'caseList' enumeration with 'Case n:' label
\newlist{caseList}{enumerate}{1}
\setlist[caseList]{label=\textbf{Case~\arabic*:}, leftmargin=*}

% 'case' environment with optional title
\NewDocumentEnvironment{case}{O{}}{%
	\begin{caseList}[#1]
		}{%
	\end{caseList}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Utility Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\let\oldtablecontents\tableofcontents % Save original TOC command
\renewcommand*{\tableofcontents}{\oldtablecontents\cleardoublepage\pagestyle{fancy}} % Redefine TOC with fancy style

\RequirePackage{xspace} % Provides control over spaces after macros

% Inline Commands
\newcommand*{\code}[1]{{\ttfamily#1}} % Inline code in monospaced font
\newcommand{\cat}[1]{\ensuremath{\mathsf{#1}}} % Sans-serif math mode for category names
\newcommand{\missingcitation}{\code{\small\color{Firebrick1}<Citation Missing!>}} % Mark missing citations
\newcommand{\missing}[1]{{\color{Firebrick1}#1}} % Red for missing content
\newcommand{\strike}{\bgroup\ULdepth=-.55ex\ULset} % Strike-through for deleted text
\newcommand{\stylized}[2]{\lettrine[lines=2, lhang=0.05]{\textcolor{accentcolor}{#1}}{#2}} % Drop-cap with color
\newcommand{\term}[1]{#1\index{#1}} % Mark terms for glossary/index
\newcommand{\textem}[1]{{\bfseries\color{accentcolor}#1}} % Bold and accent-colored emphasis
\newcommand{\urlref}[1]{\href{#1}{#1}} % Hyperlink URL display

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Comments and TODOs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newif\ifComments % Toggle for displaying comments
\Commentsfalse % Set to 'true' to enable comments

% Define a command to enable comments
\newcommand{\usecomments}{%
	\Commentstrue
}

% Generic \newcomment command for adding structured comments
\newcommand{\newcomment}[3]{%
	\ifComments
		% Define a visible comment macro if comments are enabled
		\expandafter\newcommand\csname #3\endcsname[1]{%
			\noindent\textcolor{#2}{\sffamily ##1 -- $\mathsf{#1}$}%
		}%
	\else
		% Define the comment macro as a no-op if comments are disabled
		\expandafter\newcommand\csname #3\endcsname[1]{}%
	\fi
}

% Enable TODO notes
\RequirePackage{todonotes} % Enable TODOs

% Inline TODO notes with custom style
\newcommand{\mynote}[1]{%
	\smallskip
	\todo[inline, size=\small, bordercolor=Firebrick1!20, color=Firebrick1!20]{\sffamily#1}
	\smallskip
}

% Mark sections needing citation
\newcommand{\needcite}{%
	\todo[noline, size=\small, bordercolor=Firebrick1!20, color=Firebrick1!20]{\sffamily~Requires citation.}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customisation of \maketitle Command
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{hep-title}    % Title customisation (hypothetical, assuming this is a custom or special package)
\RequirePackage{pgfornament}  % Decorative ornaments

\newcommand{\fancymaketitle}{%
	% Title Formatting
	\pretitle{\hrule\vspace{15pt}\begin{center}\normalfont\scshape\huge}
			\posttitle{\end{center}\vspace{15pt}\hrule}
	% Subtitle Formatting
	\presubtitle{\vspace{1em}\begin{center}\Large\normalfont\itshape}
			\postsubtitle{\par\end{center}}
	% Author Formatting
	\preauthor{\vspace{15pt}\begin{center}\normalfont\scshape\large\lineskip0.25em\begin{tabular}[t]{c}}
				\postauthor{\end{tabular}\par\end{center}}
	% Date Formatting
	\predate{\begin{center}\par\bigskip\normalfont\normalsize\scshape}
			\postdate{\par\end{center}}
}

% Apply the custom title formatting
\AtEndPreamble{\fancymaketitle}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Command for Generating the Copyright Page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand*{\makecopyrightpage}{%
	\pagestyle{empty} % Suppress headers and footers
	\begingroup % Scope formatting
	\cleardoublepage\null\vfill % Vertically centre content
	\centering % Centre text

	% Title and author information
	\textsc{\large\@title}\par\medskip
	\textcopyright~\@date~by~\@author\par
	All rights reserved.\par

	% Author Draft Licence
	\justify
	This document, issued under the Author Draft Licence, is
	intended solely for private academic use, scholarly critique,
	and peer feedback. Reproduction, distribution, adaptation, or
	derivative works, including modifications or transformations,
	are prohibited without the author's explicit written permission.
	Commercial use, instructional applications, industrial purposes,
	or integration into machine learning or artificial intelligence
	systems are expressly forbidden. Redistribution must preserve
	the original form and comply fully with this licence. This
	preliminary draft has not undergone peer review or rigorous
	verification and may contain errors, incomplete arguments, or
	inaccuracies; it should not be relied upon as authoritative.
	Unauthorised use or distribution violates intellectual property
	laws, and the author reserves the right to enforce legal
	protections. Permissions or inquiries must be directed to the
	contact information provided in this document. Constructive
	feedback is welcome to refine and improve the work.

	% Publication date
	\vspace{15pt}
	\begin{center}
		This version was published on \@date.\par
	\end{center}
	\vspace*{15pt}

	\endgroup % End formatting scope
	\cleardoublepage % Start a fresh page
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code Listings and Snippets Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\usecodelists}{%
	\RequirePackage{listings}  % Load the listings package

	% Define style for C code
	\lstdefinestyle{CStyle}{%
		language=C,                    % Set language to C
		basicstyle=\ttfamily\small,     % Use small monospaced font
		keywordstyle=\color{RoyalBlue3},% Color keywords Royal Blue
		keywordstyle=[2]\color{HotPink4}, % Color specific keywords Medium Purple
		keywordstyle=[3]\color{SpringGreen4}, % Color specific keywords Chartreuse
		keywordstyle=[4]\color{SlateBlue2},   % Color specific keywords Slate Blue
		commentstyle=\color{LightSteelBlue4}, % Color comments Light Steel Blue
		stringstyle=\color{Firebrick2},       % Color strings Firebrick
		numberstyle=\tiny\ttfamily\color{SlateGray4}, % Line number style
		numbers=left,                  % Line numbers on the left
		stepnumber=1,                  % Number every line
		numbersep=10pt,                % Space between numbers and code
		backgroundcolor=\color{white}, % White background
		breaklines=true,               % Break lines automatically
		captionpos=b,                  % Captions at the bottom
		showspaces=false,              % Don't show spaces
		showstringspaces=false,        % Don't show spaces within strings
		showtabs=false,                % Don't show tabs
		tabsize=4,                     % Tab size 4
		escapeinside={\%*}{*)}         % Escape LaTeX inside code
	}

	% Define style for C++ code
	\lstdefinestyle{CPlusPlusStyle}{%
		language=C++,                   % Set language to C++
		basicstyle=\ttfamily\small,      % Use small monospaced font
		keywordstyle=\color{RoyalBlue3}, % Royal Blue for keywords
		keywordstyle=[2]\color{HotPink4}, % Medium Purple for specific keywords
		keywordstyle=[3]\color{SpringGreen4}, % Chartreuse for specific keywords
		keywordstyle=[4]\color{SlateBlue2},   % Slate Blue for specific keywords
		commentstyle=\color{LightSteelBlue4}, % Light Steel Blue for comments
		stringstyle=\color{Firebrick2},       % Firebrick color for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4}, % Line number style
		numbers=left,                   % Line numbers on the left
		stepnumber=1,                   % Number every line
		numbersep=10pt,                 % Space between numbers and code
		backgroundcolor=\color{white},  % White background
		breaklines=true,                % Automatic line breaking
		captionpos=b,                   % Captions at the bottom
		showspaces=false,               % Don't show spaces
		showstringspaces=false,         % Don't show spaces within strings
		showtabs=false,                 % Don't show tabs
		tabsize=4,                      % Tab size 4
		escapeinside={\%*}{*)}          % Escape LaTeX inside code
	}

	% Define style for Java code
	\lstdefinestyle{JavaStyle}{%
		language=Java,                  % Set language to Java
		basicstyle=\ttfamily\small,     % Use small monospaced font
		keywordstyle=\color{RoyalBlue3},% Royal Blue for keywords
		keywordstyle=[2]\color{HotPink4}, % Medium Purple for specific keywords
		keywordstyle=[3]\color{SpringGreen4}, % Chartreuse for specific keywords
		keywordstyle=[4]\color{SlateBlue2},   % Slate Blue for specific keywords
		commentstyle=\color{LightSteelBlue4}, % Light Steel Blue for comments
		stringstyle=\color{Firebrick2},     % Firebrick color for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4}, % Line number style
		numbers=left,                  % Line numbers on the left
		stepnumber=1,                  % Number every line
		numbersep=10pt,                % Space between numbers and code
		backgroundcolor=\color{white}, % White background
		breaklines=true,               % Automatic line breaking
		captionpos=b,                  % Captions at the bottom
		showspaces=false,              % Don't show spaces
		showstringspaces=false,        % Don't show spaces within strings
		showtabs=false,                % Don't show tabs
		tabsize=4,                     % Tab size 4
		escapeinside={\%*}{*)}         % Escape LaTeX inside code
	}

	% Define style for Python code
	\lstdefestyle{PythonStyle}{%
		language=Python,               % Set language to Python
		basicstyle=\ttfamily\small,    % Use small monospaced font
		keywordstyle=\color{RoyalBlue3}, % Royal Blue for keywords
		keywordstyle=[2]\color{HotPink4}, % Medium Purple for specific keywords
		keywordstyle=[3]\color{SpringGreen4}, % Chartreuse for specific keywords
		keywordstyle=[4]\color{SlateBlue2},  % Slate Blue for specific keywords
		commentstyle=\color{LightSteelBlue4}, % Light Steel Blue for comments
		stringstyle=\color{Firebrick2},     % Firebrick color for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4}, % Line number style
		numbers=left,                  % Line numbers on the left
		stepnumber=1,                  % Number every line
		numbersep=10pt,                % Space between numbers and code
		backgroundcolor=\color{white}, % White background
		breaklines=true,               % Automatic line breaking
		captionpos=b,                  % Captions at the bottom
		showspaces=false,              % Don't show spaces
		showstringspaces=false,        % Don't show spaces within strings
		showtabs=false,                % Don't show tabs
		tabsize=4,                     % Tab size 4
		escapeinside={\%*}{*)}         % Escape LaTeX inside code
	}

	% Reset code box counter for each chapter
	\preto\chapter{\setcounter{codeboxcounter}{0}}

	% Define a counter for code boxes, reset at each chapter
	\newcounter{codeboxcounter}[chapter]

	% Define a new "codebox" environment for formatted code snippets
	\newenvironment{codebox}[1][Code Box]
	{
		\stepcounter{codeboxcounter} % Increment the code box counter
		\newmdenv[%
			frametitlebackgroundcolor=none, % No background for the frame title
			frametitlefont=\scshape\sffamily, % Small caps and sans serif for the title
			frametitleaboveskip=5pt, % Space above title
			frametitlerule=true, % Horizontal rule under the title
			frametitlerulecolor=black, % Rule color
			frametitlerulewidth=1pt, % Rule thickness
			frametitlealignment=\raggedright, % Align the title left
			frametitle={\thechapter.\arabic{codeboxcounter}:~##1}, % Title format with chapter and number
			linewidth=1pt, % Frame line width
			linecolor=black, % Frame line color
			innertopmargin=10pt, % Inner top margin
			innerbottommargin=10pt, % Inner bottom margin
			leftline=false, % No left vertical line
			rightline=false, % No right vertical line
		]{codeboxinner}\begin{codeboxinner}
			}{%
		\end{codeboxinner}
	}

	% Define a command for adding code with title in a code box
	\newcommand{\addCode}[4]{%
		\begin{codebox}[##1]\label{code:##2} % Start code box
			\lstinputlisting[style=##3]{##4} % Include code with chosen style
		\end{codebox} % End code box
	}
}

\ifbool{usecodelists}{\usecodelists}{\typeout{Code listings are not used.}}

% Disable the use of '@' in command names
\makeatother

% End of package
\endinput
