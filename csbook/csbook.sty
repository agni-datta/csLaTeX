%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% csbook Package
%% Version: 1.0
%% Date: 2024/05/19
%% Description: Tools for creating academic books in computer science
%% Author: Agni Datta
%% Email: agnidatta.org@gmail.com
%% Maintainer: Agni Datta
%% License: MIT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% csbook: A LaTeX package for academic book creation in computer science.

% Usage:
% 1. Load with \RequirePackage{csbook}.
% 2. Use provided environments and tools.

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Metadata
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\csbook@filename}{csbook} % Package name
\newcommand{\csbook@fileversion}{v1} % Version
\newcommand{\csbook@filedate}{2024/04/17} % Release date
\newcommand{\csbook@fileauthor}{Agni Datta} % Author
\newcommand{\csbook@version}{1.0} % Internal version

\NeedsTeXFormat{LaTeX2e} % Requires LaTeX2e
\AtEndOfPackage{%
	\ProvidesPackage{\csbook@filename}[%
		\csbook@filedate\space\csbook@fileversion\space(\csbook@fileauthor)
	]%
	\typeout{Package \csbook@filename', \csbook@fileversion, <\csbook@filedate>}
}
\ProvidesPackage{\csbook@filename}[\csbook@version\space A LaTeX package for typesetting computer science books]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Dependencies
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{calc} % Perform LaTeX calculations
\RequirePackage{comment} % Comment handling
\RequirePackage{etoolbox} % Advanced conditionals and loops
\RequirePackage{iftex} % Detect TeX engine
\RequirePackage{kvoptions} % Key-value option management
\RequirePackage{lipsum} % Placeholder text generation
\RequirePackage{xkeyval} % Key-value argument parsing
\RequirePackage{xparse} % Complex macro definitions
\RequirePackage{xpatch} % Flexible command patching

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Engine Compatibility Check
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Ensure the engine is XeLaTeX or LuaLaTeX
\ifXeTeX
	\typeout{csbook: Running with XeLaTeX. Compatible.}
\else
	\ifLuaTeX
		\typeout{csbook: Running with LuaLaTeX. Compatible.}
	\else
		\PackageError{\csbook@filename}
		{This package is only compatible with XeLaTeX or LuaLaTeX.}
		{Unsupported engine detected. The package cannot function.}
	\fi
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Option Definitions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Declare internal flags for package options
\newif\ifcsbook@biblatex
\newif\ifcsbook@codelist
\newif\ifcsbook@comments
\newif\ifcsbook@ebook
\newif\ifcsbook@fancythm
\newif\ifcsbook@firacode
\newif\ifcsbook@firasans
\newif\ifcsbook@garamond
\newif\ifcsbook@inconsolata
\newif\ifcsbook@kepler
\newif\ifcsbook@libertinesans
\newif\ifcsbook@lmsans
\newif\ifcsbook@lmserif
\newif\ifcsbook@normalthm
\newif\ifcsbook@oldlmserif
\newif\ifcsbook@oldschoolthm
\newif\ifcsbook@print
\newif\ifcsbook@sortedbib
\newif\ifcsbook@sourcecode
\newif\ifcsbook@sourcesans
\newif\ifcsbook@tikz

% Default all options to 'false'
\csbook@biblatexfalse
\csbook@codelistfalse
\csbook@commentsfalse
\csbook@ebookfalse
\csbook@fancythmfalse
\csbook@firacodefalse
\csbook@firasansfalse
\csbook@garamondfalse
\csbook@inconsolatafalse
\csbook@keplerfalse
\csbook@libertinesansfalse
\csbook@lmsansfalse
\csbook@lmseriffalse
\csbook@normalthmfalse
\csbook@oldlmseriffalse
\csbook@oldschoolthmfalse
\csbook@printfalse
\csbook@sortedbibfalse
\csbook@sourcecodefalse
\csbook@sourcesansfalse
\csbook@tikzfalse

% Define package options and set corresponding flags
\DeclareOption{biblatex}{\csbook@biblatextrue}
\DeclareOption{codelist}{\csbook@codelisttrue}
\DeclareOption{comments}{\csbook@commentstrue}
\DeclareOption{ebook}{\csbook@ebooktrue}
\DeclareOption{fancythm}{\csbook@fancythmtrue}
\DeclareOption{firacode}{\csbook@firacodetrue}
\DeclareOption{firasans}{\csbook@firasanstrue}
\DeclareOption{garamond}{\csbook@garamondtrue}
\DeclareOption{inconsolata}{\csbook@inconsolatatrue}
\DeclareOption{kepler}{\csbook@keplertrue}
\DeclareOption{libertinesans}{\csbook@libertinesanstrue}
\DeclareOption{lmsans}{\csbook@lmsanstrue}
\DeclareOption{lmserif}{\csbook@lmseriftrue}
\DeclareOption{normalthm}{\csbook@normalthmtrue}
\DeclareOption{oldlmserif}{\csbook@oldlmseriftrue}
\DeclareOption{oldschoolthm}{\csbook@oldschoolthmtrue}
\DeclareOption{print}{\csbook@printtrue}
\DeclareOption{sortedbib}{\csbook@sortedbibtrue}
\DeclareOption{sourcecode}{\csbook@sourcecodetrue}
\DeclareOption{sourcesans}{\csbook@sourcesanstrue}
\DeclareOption{tikz}{\csbook@tikztrue}

% Handle unknown options with a warning
\DeclareDefaultOption{\PackageWarning{csbook}{Unknown option '\CurrentOption'}}
\DeclareOption*{\PackageWarning{csbook}{Unknown option \CurrentOption'}}

% Process options
\ProcessOptions\relax

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PDF Management and External File Handling
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[2.0, objcompress, compress]{bxpdfver} % Set PDF version and compression
\RequirePackage{pdfpages} % Include external PDF pages
\RequirePackage{pdflscape} % Enable landscape pages
\RequirePackage{ragged2e} % Enhanced text justification options

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package for Color Support
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[x11names, dvipsnames, svgnames]{xcolor} % Extended color support

% Define and manage accent color
\newcommand{\accentcolor}{gray} % Default accent color
\colorlet{accentcolor}{\accentcolor} % Alias for accent color

% Command to set accent color (default: gray)
\NewDocumentCommand{\setaccentcolor}{o}{%
	\IfNoValueTF{#1}{%
		\renewcommand{\accentcolor}{gray} % Set default color
	}{%
		\renewcommand{\accentcolor}{#1} % Set specified color
	}%
	\colorlet{accentcolor}{\accentcolor} % Apply color change
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Language and Typographic Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{babel} % Language support
\RequirePackage[autostyle=true, csdisplay=true]{csquotes} % Advanced quotations
\RequirePackage[babel=true]{microtype} % Microtypography for XeTeX and LuaLaTeX

% Options for XeTeX and LuaTeX
\ifxetex
	\PassOptionsToPackage{protrusion=true}{microtype} % XeTeX protrusion
\fi
\ifluatex
	\PassOptionsToPackage{protrusion=true,expansion=true}{microtype} % LuaTeX protrusion and expansion
\fi

% Line spacing and extra symbols
\RequirePackage[onehalfspacing]{setspace} % 1.5 line spacing
\RequirePackage[full]{textcomp} % Extra symbols
\RequirePackage[normalem]{ulem} % Underlining and strikethrough

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Layout Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Mobile eBook Layout
\newcommand{\ebook}{%
	\RequirePackage[%
		paperwidth=6in, paperheight=9in, left=0.5in, right=0.5in, top=0.5in, bottom=0.5in, % Page dimensions
		headheight=10pt, headsep=10pt, footskip=15pt, textheight=6.5in, textwidth=4.4in, % Text area
		centering, includeheadfoot % Center content and include minimal headers/footers
	]{geometry} % Mobile eBook layout
}

% A4 Print Layout
\newcommand{\print}{%
	\RequirePackage[%
		a4paper, left=1.5in, right=1in, top=1in, bottom=1in, bindingoffset=0.5in, % A4 page dimensions and binding offset
		headheight=15pt, headsep=20pt, footskip=25pt, textheight=9.5in, textwidth=6in, % Text area
		centering, includeheadfoot % Center content and include headers/footers
	]{geometry} % Print layout
}

% General Layout Configuration
\newcommand{\generallayout}{%
	\RequirePackage[%
		a4paper, tmargin=3.00cm, bmargin=3.00cm, lmargin=3.00cm, rmargin=3.00cm, footskip=1.00cm % General margin settings
	]{geometry} % General page layout
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customization of Headers and Footers
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\loadheaderfooter}{%
	\RequirePackage{fancyhdr} % Custom header and footer formatting
	\fancyhf{} % Clear default header and footer
	\fancyhead[LE, RO]{\normalfont\small\sffamily\thepage} % Page number on left (even) and right (odd) pages
	\fancyhead[LO, RE]{\normalfont\small\sffamily\@title} % Title on left (odd) and right (even) pages
	\renewcommand{\headrulewidth}{0.25pt} % Header rule thickness
	\pagestyle{fancy} % Apply custom header/footer style
}

\ifcsbook@print
	\print
	\loadheaderfooter
	\typeout{csbook: Print layout is enabled.}
\fi
\ifcsbook@ebook
	\ebook
	\loadheaderfooter
	\typeout{csbook: Ebook layout is enabled.}
\else
	\generallayout
	\loadheaderfooter
	\typeout{csbook: General layout is in use.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Font and Mathematics Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[T1]{fontenc}            % Enable T1 font encoding for enhanced font support
\RequirePackage{amsfonts}               % AMS fonts for mathematical symbols
\RequirePackage{amsmath}                % Advanced mathematical formatting
\RequirePackage{amssymb}                % Additional symbols for mathematical typesetting
\RequirePackage{bm}                     % Boldface mathematical symbols
\RequirePackage{mathrsfs}               % Script-style fonts for mathematical notation
\RequirePackage{mathtools}              % Extend mathematical functionality with additional features
\RequirePackage{nicefrac}               % Diagonal fractions
\RequirePackage{sansmath}               % Sans-serif font for mathematical expressions
\RequirePackage{siunitx}                % Handle units and numerical data consistently

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theorem and Environments Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{amsthm}                 % Support for theorem environments
\RequirePackage{thmtools}               % Enhance theorem environments
\RequirePackage{thm-restate}            % Additional features for restating theorems

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fontspec and Unicode Math (XeLaTeX/LuaLaTeX)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{fontspec}               % Support for custom fonts (XeLaTeX/LuaLaTeX only)
\RequirePackage{unicode-math}           % Unicode mathematical fonts for consistent typesetting

% Old Latin Modern font configuration for text and mathematics
\newcommand{\oldlmserif}{%
	\setmainfont[%
		ItalicFont = lmroman10-italic.otf, % Italic font
		SmallCapsFont = lmromancaps10-regular.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = lmroman10-bold.otf, % Bold font
		BoldItalicFont = lmroman10-bolditalic.otf, % Bold italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{lmroman10-regular.otf} % Regular text font
	\setmathfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{latinmodern-math.otf} % Math font
	\setsansfont[%
		ItalicFont = lmsans10-oblique.otf, % Italic sans font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = lmsans10-bold.otf, % Bold sans font
		BoldItalicFont = lmsans10-boldoblique.otf, % Bold-italic sans font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{lmsans10-regular.otf} % Sans-serif font
}

% Latin Modern font configuration for text and mathematics
\newcommand{\lmserif}{%
	\setmainfont[%
		ItalicFont = NewCM10-BookItalic.otf, % Italic font
		SmallCapsFont = NewCM10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCM10-Bold.otf, % Bold font
		BoldItalicFont = NewCM10-BoldItalic.otf, % Bold italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCM10-Book.otf} % Regular text font
	\setmathfont{NewCMMath-Book.otf} % Math font
	\setsansfont[%
		ItalicFont = NewCMSans10-Oblique.otf, % Italic sans font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCMSans10-Bold.otf, % Bold sans font
		BoldItalicFont = NewCMSans10-BoldOblique.otf, % Bold-italic sans font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCMSans10-Book.otf} % Sans-serif font
}

% EB Garamond font configuration for text and mathematics
\newcommand{\garamond}{%
	\setmainfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {3,5} % Stylistic sets
	]{EB Garamond} % Main text font
	\setmathfont[%
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {2,6,7,9} % Stylistic sets
	]{Garamond-Math.otf} % Math font
}

% Kepler font configuration
\newcommand{\kepler}{%
	\RequirePackage{kpfonts-otf} % Load Kepler package
	\let\D\relax % Reset definition of \D
}

% Libertinus Sans font configuration
\newcommand{\libertinesans}{%
	\setsansfont[%
		UprightFont = LibertinusSans-Regular, % Regular font
		BoldFont = LibertinusSans-Bold.otf, % Bold font
		ItalicFont = LibertinusSans-Italic.otf, % Italic font
		SmallCapsFont = LibertinusSans-Regular, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}, % Typographic features
		StylisticSet = {1,3} % Stylistic sets
	]{LibertinusSans-Regular.otf} % Set as default sans font
}

% Latin Modern Sans font configuration
\newcommand{\lmsans}{%
	\setsansfont[%
		ItalicFont = NewCMSans10-Oblique.otf, % Italic font
		SmallCapsFont = NewCMSans10-Book.otf, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		BoldFont = NewCMSans10-Bold.otf, % Bold font
		BoldItalicFont = NewCMSans10-BoldOblique.otf, % Bold-italic font
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{NewCMSans10-Book.otf} % Set as default sans-serif font
}

% Source Sans Pro font configuration
\newcommand{\sourcesans}{%
	\RequirePackage[otf, lining, proportional, scale=0.975]{sourcesanspro} % Load package with options
	\setsansfont[%
		Scale = 0.950, % Font scale
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{Source Sans Pro} % Set Source Sans font
}

% Source Code Pro font configuration
\newcommand{\sourcecode}{%
	\RequirePackage[otf, lining, scale=0.865]{sourcecodepro} % Load package with options
	\setmonofont[%
		Scale = 0.865, % Font scale
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{Source Code Pro} % Set monospaced font
}

% Fira Sans font configuration
\newcommand{\firasans}{%
	\setsansfont[%
		Scale = 0.925, % Font scale
		BoldFont = {FiraSans-Bold.otf}, % Bold font
		ItalicFont = {FiraSans-BookItalic.otf}, % Italic font
		BoldItalicFont = {FiraSans-BoldItalic.otf}, % Bold-italic font
		SmallCapsFont = {FiraSans-Book.otf}, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{FiraSans-Book.otf} % Set Fira Sans font
}

% Fira Mono font configuration
\newcommand{\firacode}{%
	\setmonofont[%
		Scale = 0.865, % Font scale
		BoldFont = {firacode-Bold.otf}, % Bold font
		ItalicFont = {firacode-Oblique.otf}, % Italic font
		BoldItalicFont = {firacode-BoldOblique.otf}, % Bold-italic font
		SmallCapsFont = {firacode-Regular.otf}, % Small caps font
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{firacode-Regular.otf}
}

% Inconsolata font configuration
\newcommand{\inconsolata}{%
	\setmonofont[%
		SmallCapsFeatures = {RawFeature=+smcp}, % Small caps
		RawFeature = {+calt, +case, +dlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum} % Typographic features
	]{inconsolata}
}

% Resolve mathematics font conflicts
\AtEndPreamble{%
	\let\mathbfcal\relax % Reset mathematics font conflict
	\RequirePackage[%
		bb=bboldx,  % Blackboard bold
		cal=cm      % Calligraphic font
	]{mathalpha}
}

% Check for Serif Font
\ifcsbook@garamond
	\garamond
	\typeout{csbook: Garamond fonts are applied.}
\else
	\typeout{csbook: Garamond fonts are not applied.}
\fi
\ifcsbook@kepler
	\kepler
	\typeout{csbook: Kepler fonts are applied.}
\else
	\typeout{csbook: Kepler fonts are not applied.}
\fi
\ifcsbook@lmserif
	\lmserif
	\typeout{csbook: Latin Modern Serif fonts are applied.}
\else
	\typeout{csbook: Latin Modern Serif fonts are not applied.}
\fi
\ifcsbook@oldlmserif
	\oldlmserif
	\typeout{csbook: Old Latin Modern Serif fonts are applied.}
\else
	\typeout{csbook: Old Latin Modern Serif fonts are not applied.}
\fi

% Check for Sans Serif Font
\ifcsbook@firasans
	\firasans
	\typeout{csbook: Fira Sans fonts are applied.}
\else
	\typeout{csbook: Fira Sans fonts are not applied.}
\fi
\ifcsbook@libertinesans
	\libertinesans
	\typeout{csbook: Libertinus Sans fonts are applied.}
\else
	\typeout{csbook: Libertinus Sans fonts are not applied.}
\fi
\ifcsbook@lmsans
	\lmsans
	\typeout{csbook: Latin Modern Sans fonts are applied.}
\else
	\typeout{csbook: Latin Modern Sans fonts are not applied.}
\fi
\ifcsbook@sourcesans
	\sourcesans
	\typeout{csbook: Source Sans fonts are applied.}
\else
	\typeout{csbook: Source Sans fonts are not applied.}
\fi

% Check for Monospace Font
\ifcsbook@firacode
	\firacode
	\typeout{csbook: Fira Mono fonts are applied.}
\else
	\typeout{csbook: Fira Mono fonts are not applied.}
\fi
\ifcsbook@inconsolata
	\inconsolata
	\typeout{csbook: Inconsolata fonts are applied.}
\else
	\typeout{csbook: Inconsolata fonts are not applied.}
\fi
\ifcsbook@sourcecode
	\sourcecode
	\typeout{csbook: Source Code Pro fonts are applied.}
\else
	\typeout{csbook: Source Code Pro fonts are not applied.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Custom Sectioning Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[explicit, compact]{titlesec}  % Sectioning commands customization

% Define heading font commands
\newcommand{\headerfont}{\sffamily}
\newcommand{\partfont}{\normalfont\headerfont}
\newcommand{\chapterfont}{\LARGE\headerfont}
\newcommand{\sectionfont}{\Large\headerfont}
\newcommand{\subsectionfont}{\large\headerfont}
\newcommand{\subsubsectionfont}{\normalsize\headerfont}

\AtEndPreamble{%
	% Part title formatting
	\titleformat{\part}[display]
    	{\partfont\RaggedRight}                    % Font and alignment
    	{\color{accentcolor}\LARGE\partname~\normalfont\thepart} % Title and number format
    	{0pt}                                      % Space between number and title
    	{\titlerule\bigskip\Huge#1\vfill}          % Title appearance
    	\titlespacing*{\part}{0pt}{\fill}{\fill}   % Title spacing

	% Chapter title formatting
	\titleformat{\chapter}[display]
    	{\chapterfont}                             % Font style
    	{\RaggedLeft{\rmfamily\scshape\large\chaptertitlename}~\Huge\normalfont\color{accentcolor}\thechapter} % Title and number format
    	{1ex}                                      % Space between number and title
    	{\titlerule\vspace{1ex}#1}[\vspace{1ex}\titlerule] % Title appearance and rule
    	\titlespacing*{\chapter}{0pt}{25pt}{25pt}  % Title spacing

	% Section title formatting
	\titleformat{\section}[block]
    	{\sectionfont}                             % Font style
    	{\normalfont\color{accentcolor}\huge\sffamily\thesection}  % Title and number format
    	{10pt}                                     % Space between number and title
    	{#1}[\vspace{5pt}\titlerule]               % Title appearance and rule
    	\titlespacing*{\section}{0pt}{15pt}{10pt}  % Title spacing

	% Subsection title formatting
	\titleformat{\subsection}[block]
    	{\subsectionfont}                          % Font style
    	{\color{accentcolor}\normalfont\Large\sffamily\thesubsection}  % Title and number format
    	{7.5pt}                                    % Space between number and title
    	{#1}                                       % Title content

	% Subsubsection title formatting
	\titleformat{\subsubsection}[runin]
    	{\subsubsectionfont}                       % Font style
    	{\normalfont\color{accentcolor}\sffamily\thesubsubsection}  % Title and number format
    	{5pt}                                      % Space between number and title
    	{#1.}                                      % Title content with period

	% Paragraph and subparagraph formatting
	\renewcommand{\paragraph}[1]{\noindent\normalfont{\textbf{#1.}}}  % Paragraph format
	\renewcommand{\subparagraph}[1]{\noindent\normalfont{\textsc{#1.}}}  % Subparagraph format
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of Contents Customization
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[titles]{tocloft}  % TOC customization package

% Adjust spacing, number alignment, and indentation for TOC entries
\renewcommand{\cftpartafterpnum}{}{\vskip1pt}  % Part number spacing
\renewcommand{\cftchapafterpnum}{}{\vskip1pt}  % Chapter number spacing
\renewcommand{\cftsecafterpnum}{}{\vskip1pt}   % Section number spacing
\renewcommand{\cftsubsecafterpnum}{}{\vskip1pt} % Subsection number spacing
\renewcommand{\cftsubsubsecafterpnum}{}{\vskip1pt} % Subsubsection number spacing

% Adjust number alignment widths
\addtolength{\cftpartnumwidth}{2.5pt}    % Part number width
\addtolength{\cftchapnumwidth}{5.0pt}    % Chapter number width
\addtolength{\cftsecnumwidth}{3.5pt}     % Section number width
\addtolength{\cftsubsecnumwidth}{3.5pt}  % Subsection number width
\addtolength{\cftsubsubsecnumwidth}{3.5pt} % Subsubsection number width

% Set indentation for TOC entries
\addtolength{\cftsecindent}{5pt}         % Section indentation
\addtolength{\cftsubsecindent}{8.5pt}    % Subsection indentation
\addtolength{\cftsubsubsecindent}{12pt}  % Subsubsection indentation

% Customize TOC font styles
\renewcommand{\cftpartfont}{}{\Large\sffamily}    % Part font
\renewcommand{\cftchapfont}{}{\large\scshape}     % Chapter font
\renewcommand{\cftsecfont}{}{\normalsize\scshape} % Section font
\renewcommand{\cftsubsecfont}{}{\normalsize}      % Subsection font
\renewcommand{\cftsubsubsecfont}{}{\normalsize}   % Subsubsection font

% Set numbering and TOC depth
\setcounter{secnumdepth}{4}  % Depth of numbering (part, chapter, section, subsection)
\setcounter{tocdepth}{2}     % Depth of TOC entries (part, chapter, section)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Index Support
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[makeindex]{imakeidx}  % Index creation support

% Custom index style
\begin{filecontents}{csindex.ist}
quote '+'
letter_group
symhead_positive "Symbols"
numhead_positive "Numbers"
headings_flag 1
heading_prefix "\\textcolor{\\accentcolor}{\\large\\textbf{" heading_suffix "}}\n"
delim_0 "\\dotfill"
delim_1 "\\dotfill"
delim_2 "\\dotfill"
delim_r "\\dotfill"
preamble "\\begin{theindex}\n\\small\n"
postamble "\n\\end{theindex}\n"
\end{filecontents}

% Create the index with the custom style and layout
\makeindex[intoc, title=Index, columns=2, options=-s csindex]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyperlinks and Metadata Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[pdfusetitle]{hyperref}  % Enable PDF metadata and hyperlinks
\RequirePackage{bookmark}               % Handle PDF bookmarks
\RequirePackage{xurl}                   % Enable URL line breaks

% Configure hyperlink settings
\hypersetup{%
	pdfsubject={Computer Science},           % Set subject
	pdfkeywords={computer science},          % Set keywords
	colorlinks=true,                         % Enable colored links
	citecolor=accentcolor!75!black,          % Citation link color
	linkcolor=accentcolor!75!black,          % Internal link color
	urlcolor=accentcolor!75!black,           % URL link color
	frenchlinks=true,                        % Small caps for links
	unicode=true,                            % Enable Unicode links
	bookmarksnumbered=true,                  % Numbered bookmarks
	breaklinks=true                          % Allow link breaks
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Glossaries and Acronyms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[%
	automake,                % Auto-generate glossary
	acronym,                 % Enable acronyms
	symbols,                 % Include symbols
	nonumberlist,            % No numbering for entries
	nogroupskip,             % Disable group skipping
	indexonlyfirst,          % Index only first occurrence
	stylemods=longextra,     % Use long extra style
	nopostdot,               % No period after entries
	toc                      % Add to Table of Contents
]{glossaries-extra}

% Initialise glossary system
\makeglossaries

\setabbreviationstyle[acronym]{long-short}  % Acronym style
\renewcommand{\glsnamefont}[1]{{\normalfont\sffamily\color{accentcolor}#1.}} % Glossary name font
\renewcommand{\glossarypreamble}{\begin{normalsize}} % Glossary preamble
\renewcommand{\glossarypostamble}{\end{normalsize}} % Glossary postamble

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package for Customizing Lists
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{enumitem} % List customization package

% Global List Settings
\setlist{nosep, noitemsep} % Remove extra spacing in lists

% Customize Enumerate Labels
\setlist[enumerate, 1]{label=(\arabic*)}    % First level (1, 2, 3, ...)
\setlist[enumerate, 2]{label=(\alph*)}      % Second level (a, b, c, ...)
\setlist[enumerate, 3]{label=(\roman*)}     % Third level (i, ii, iii, ...)
\setlist[enumerate, 4]{label=(\Alph*)}      % Fourth level (A, B, C, ...)

% Redefine Bullet Symbols for Itemize
\setlist[itemize, 1]{label=\ensuremath{\color{accentcolor}\bullet}}  % First level bullet
\setlist[itemize, 2]{label=\ensuremath{\color{accentcolor}\circ}}    % Second level circle
\setlist[itemize, 3]{label=\ensuremath{\color{accentcolor}\ast}}     % Third level asterisk
\setlist[itemize, 4]{label=\ensuremath{\color{accentcolor}\star}}    % Fourth level star

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages for Typesetting Algorithms
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[algonl, boxed, longend, vlined]{algorithm2e} % Algorithm formatting
\SetAlFnt{\small}                               % Small font for algorithms
\SetAlCapNameFnt{\normalfont\sffamily}          % Caption font style
\SetAlCapFnt{\normalfont\sffamily\color{accentcolor}} % Caption color
\SetAlgoSkip{medskip}                           % Space between steps
\SetAlgoInsideSkip{medskip}                     % Space inside algorithm
\SetAlCapSkip{1em}                              % Caption spacing
\SetAlgoNlRelativeSize{-2}                      % Smaller line numbers
\SetNlSty{texttt}{[}{]}                         % Line number styling
\SetAlgoCaptionSeparator{.}                     % Caption separator

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages for Creating Framed Environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Load mdframed package for framed environments
\RequirePackage[%
	skipabove=10pt,            % Vertical space above the frame
	skipbelow=10pt,            % Vertical space below the frame
	ntheorem,                  % Enable theorem-style environments
	framemethod=Tikz           % Use TikZ for framing
]{mdframed}

% Custom framed environment "tboxed"
\newmdenv[%
	font=\normalfont\small,          % Set font size
	frametitlefont=\bfseries,        % Set title font
	tikzsetting={draw=black},        % Set frame colour
	backgroundcolor=none,            % No background color
	skipabove=10pt, skipbelow=10pt,  % Vertical spacing
	innerleftmargin=7.5pt,           % Left margin
	innerrightmargin=7.5pt,          % Right margin
	innertopmargin=10pt,             % Top margin
	innerbottommargin=10pt,          % Bottom margin
	roundcorner=1pt                  % Rounded corners
]{tboxed}

% Custom framed environment "colbox"
\newmdenv[%
	font=\normalfont\small,          % Set font size
	frametitlefont=\bfseries,        % Set title font
	hidealllines=true,               % Hide all lines
	backgroundcolor={accentcolor!10!white},  % Set background colour
	skipabove=10pt, skipbelow=10pt,  % Vertical spacing
	innerleftmargin=7.5pt,           % Left margin
	innerrightmargin=7.5pt,          % Right margin
	innertopmargin=10pt,             % Top margin
	innerbottommargin=10pt,          % Bottom margin
	roundcorner=1pt                  % Rounded corners
]{colbox}

% Load tcolorbox package
\RequirePackage[most]{tcolorbox}  % Enable extended features

% Define the command for creating two environments: numbered and unnumbered
\NewDocumentCommand{\newcolorboxes}{mmm}{%
	\newcounter{#1ctr} % Define counter for numbered version

	% Numbered version
	\newtcolorbox{#1}[1][]{%
		enhanced, % Enable advanced features
		colback=#3!5, % Light background
		colframe=#3!80!black, % Dark frame
		arc=1pt, % Rounded corners
		boxrule=0.5pt, % Border thickness
		fonttitle=\color{black}\sffamily, % Title font
		before upper={\parindent0pt}, % No indent before content
		before lower={\parindent0pt}, % No indent after content
		fontupper=\color{black}\normalfont, % Content font
		fontlower=\color{black}\normalfont, % Content font
		right=15pt, top=15pt, bottom=15pt, % Padding
		attach boxed title to top left={yshift=-5pt,xshift=10pt}, % Title position
		boxed title style={%
				colback=#3!5, % Title background
				colframe=#3!50!black, % Title frame
				arc=1pt, % Rounded corners
				boxrule=0.5pt % Border thickness
			},
		title={\refstepcounter{#1ctr}#2~\thesection.\arabic{#1ctr}%
				\if\relax\detokenize{##1}\relax\else: ##1\fi} % Title with counter
	}%

	% Unumbered version
	\newtcolorbox{#1*}[1][]{%
		enhanced, % Enable advanced features
		colback=#3!5, % Light background
		colframe=#3!80!black, % Dark frame
		arc=1pt, % Rounded corners
		boxrule=0.5pt, % Border thickness
		fonttitle=\color{black}\sffamily, % Title font
		before upper={\parindent0pt}, % No indent before content
		before lower={\parindent0pt}, % No indent after content
		fontupper=\color{black}\normalfont, % Content font
		fontlower=\color{black}\normalfont, % Content font
		right=15pt, top=15pt, bottom=15pt, % Padding
		attach boxed title to top left={yshift=-5pt,xshift=10pt}, % Title position
		boxed title style={%
				colback=#3!5, % Title background
				colframe=#3!50!black, % Title frame
				arc=1pt, % Rounded corners
				boxrule=0.5pt % Border thickness
			},
		title={#2%
				\if\relax\detokenize{##1}\relax\else: ##1\fi} % Title with optional text
	}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Abstract Environment Definition
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NewDocumentEnvironment{abstract}{}{% Begin abstract environment
	\quotation\small % Quotation environment for abstract
	\textcolor{accentcolor}{\textbf{\abstractname}}.\ %
}{%
	\endquotation % End quotation in single-column mode
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendix Handling Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[%
	toc,        % Include appendices in TOC
	page,       % Start each appendix on a new page
	title,      % Prefix "Appendix" to titles
	header,     % Add "Appendix" to headers
	titletoc    % Add "Appendix" in TOC
]{appendix}

% Save original \appendix command
\let\oldappendices\appendix
\renewcommand{\appendix}{% New definition of \appendix
	\part*{Appendix} % Display the "Appendix" title without numbering
	\oldappendices    % Invoke the original appendix functionality
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customizations for verbatim environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{verbatim}  % Raw text/code inclusion
\RequirePackage{fancyvrb}  % Enhanced verbatim environments

% Save the original verbatim line processing command
\newcommand{\savedverbatim@processline}{}
\let\savedverbatim@processline=\verbatim@processline

\renewcommand{\verbatim@processline}{% New verbatim line processing
	\let\verbatim@processline=\savedverbatim@processline
	\if\relax\the\verbatim@line\relax
	\else
		\the\verbatim@line\par
	\fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Imports for various functionalities
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage[bottom, multiple, hang]{footmisc} % Custom footnote formatting
\RequirePackage{adjustbox}           % For advanced content adjustments
\RequirePackage{array}               % Enhancements for array/tabular environments
\RequirePackage{booktabs}            % Professional-quality table lines and rules
\RequirePackage{float}               % Precise control over figure/table placement
\RequirePackage{footnote}            % Enables footnotes within the document
\RequirePackage{graphics}            % Basic graphics inclusion
\RequirePackage{graphicx}            % Advanced graphic formats (PDF, EPS, etc.)
\RequirePackage{lettrine}            % First letter stylization
\RequirePackage{longtable}           % Tables that span multiple pages
\RequirePackage{multicol}            % Supports multi-column formatting
\RequirePackage{multirow}            % Allows multi-row spanning in tables
\RequirePackage{subcaption}          % Handle subfigures/subcaptions
\RequirePackage{tabularx}            % Flexible tables with adjustable column width
\RequirePackage{wrapfig}             % Enables text wrapping around figures
\RequirePackage{xspace}              % Manages space after macros

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Drawings and Diagrams
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\loadtikz}{%
	\RequirePackage{tikz}          % Load TikZ for creating graphics and diagrams
	\RequirePackage{tikz-cd}       % Load TikZ-cd for commutative diagrams
	\RequirePackage{tikzscale}     % Load tikzscale to automatically scale TikZ figures
	\RequirePackage{pgfplots}      % Load pgfplots for advanced plotting
	\pgfplotsset{compat=1.18}      % Set compatibility with version 1.18
}

\ifcsbook@tikz
	\loadtikz
	\typeout{csbook: TikZ is enabled.}
\else
	\typeout{csbook: TikZ is not included.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Captions Setup (unchanged)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginDocument{%
	\RequirePackage[%
		font={rm},                        % Sets caption text to the serif font
		labelfont={color=accentcolor,sf}, % Configures label font and color
		labelsep=period,                  % Separates label and content with a period
		skip=1em,                         % Adds vertical spacing before captions
		position=below                    % Forces captions to appear below the figure or table
	]{caption}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Epigraphs and Dedications
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{epigraph} % Load epigraph package for quotes and attributions

% Epigraph Formatting
\setlength{\epigraphrule}{0.65pt}           		% Thickness of the rule below epigraphs
\setlength{\epigraphwidth}{0.6\textwidth}    		% Width of the epigraph text block
\renewcommand{\textflush}{flushright}  	            % Align epigraph text to the right
\renewcommand{\epigraphsize}{\small}     	        % Set epigraph text size

% Modify epigraph to customize author font and size
\let\oldepigraph\epigraph
\renewcommand{\epigraph}[2]{%
	\oldepigraph{#1}{\medskip\normalfont\sffamily#2}%
}

% Dedication Command: Formats a single dedication
\newcommand{\dedication}[2]{%
	\epigraph{#1}{#2}%
}

% Generate Dedications: Produces a page of dedications
\newcommand{\generateDedications}[1]{%
	\thispagestyle{empty} % Remove header/footer and page numbers
	\begin{center}
		\vspace*{\fill}      % Add vertical space to centre the content
		\large #1            % Display dedications in a larger font
		\vspace*{\fill}      % Add vertical space after content
	\end{center}
	\clearpage           % Ensure proper page break
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Style Customizations for Document Structure
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Front matter: Set page style to plain
\let\oldfrontmatter\frontmatter
\renewcommand{\frontmatter}{%
	\oldfrontmatter       % Keep the original front matter behavior
	\pagestyle{plain}     % Set page style to plain for the front matter
}

% Main matter: Use fancy page style and ensure chapters start on right-hand pages
\let\oldmainmatter\mainmatter
\renewcommand{\mainmatter}{%
	\oldmainmatter       % Keep the original main matter behavior
	\@openrighttrue      % Ensure chapters begin on right-hand pages
	\pagestyle{fancy}    % Apply fancy page style to the main matter
}

% Back matter: Use plain page style and ensure sections begin on right-hand pages
\let\oldbackmatter\backmatter
\renewcommand{\backmatter}{%
	\oldbackmatter       % Keep the original backmatter behavior
	\@openrighttrue      % Ensure sections begin on right-hand pages
	\bookmarksetup{startatroot} % Set bookmarks to start from root
	\pagestyle{plain}    % Use plain page style for back matter
}

% Redefine Table of Contents: Add a page break and apply fancy style
\let\oldtablecontents\tableofcontents
\renewcommand{\tableofcontents}{%
	\oldtablecontents    % Retain original table of contents behavior
	\cleardoublepage     % Insert a page break after the contents
	\pagestyle{fancy}    % Set fancy page style for the following content
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of New Environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Common Font and Symbol
\newcommand{\commonthmfont}{\sffamily} % Common theorem font
\newcommand{\commonthmsymb}{\ensuremath{\color{\accentcolor}\lrcorner}} % Common theorem symbol

% Heading Fonts
\newcommand{\thmheadfont}{\sffamily} % Theorem heading font
\newcommand{\defnheadfont}{\sffamily} % Definition heading font
\newcommand{\remarkheadfont}{\sffamily} % Remark heading font
\newcommand{\hltheadfont}{\sffamily} % Highlight heading font

% Body Fonts
\newcommand{\thmfont}{\normalfont} % Theorem body font
\newcommand{\defnfont}{\normalfont} % Definition body font
\newcommand{\remarkfont}{\normalfont} % Remark body font
\newcommand{\hltfont}{\normalfont\sffamily} % Highlight body font

% Environment Symbols
\newcommand{\thmsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\blacktriangleright}} % Theorem symbol
\newcommand{\defnsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\blacksquare}} % Definition symbol
\newcommand{\remarksymb}{\ensuremath{\color{\accentcolor}\scriptstyle\vartriangleright}} % Remark symbol
\newcommand{\hltsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\square}} % Highlight symbol

% Color Definitions
\newcommand{\thmcolor}{DeepSkyBlue4} % Theorem color
\newcommand{\defncolor}{RoyalBlue4} % Definition color
\newcommand{\remarkcolor}{Aquamarine4} % Remark color
\newcommand{\hltcolor}{DeepPink4} % Highlight color

% Case List Definition
\newlist{caseList}{enumerate}{1}% Define a new list type 'caseList'
\setlist[caseList]{label=\textbf{Case~\arabic*:}, leftmargin=*}% Customize 'caseList' labels
\NewDocumentEnvironment{case}{O{}}{% Begin 'case' environment with optional argument
	\begin{caseList}[#1]%
		}{%
	\end{caseList}% End 'case' environment
}

% QED Symbol
\renewcommand{\qedsymbol}{$\scriptstyle\color{\accentcolor}\blacksquare$} % QED symbol

% Definition of New Environments
\newcommand{\basicenv}{%
	% Theorem-like Environments
	\declaretheorem[style=thmstyle,name=Theorem]{theorem}%
	\declaretheorem[style=thmstyle,name=Assertion]{assertion}%
	\declaretheorem[style=thmstyle,name=Assumption]{assumption}%
	\declaretheorem[style=thmstyle,name=Axiom]{axiom}%
	\declaretheorem[style=thmstyle,name=Claim]{claim}%
	\declaretheorem[style=thmstyle,name=Conclusion]{conclusion}%
	\declaretheorem[style=thmstyle,name=Conjecture]{conjecture}%
	\declaretheorem[style=thmstyle,name=Corollary]{corollary}%
	\declaretheorem[style=thmstyle,name=Fact]{fact}%
	\declaretheorem[style=thmstyle,name=Hypothesis]{hypothesis}%
	\declaretheorem[style=thmstyle,name=Lemma]{lemma}%
	\declaretheorem[style=thmstyle,name=Postulate]{postulate}%
	\declaretheorem[style=thmstyle,name=Property]{property}%
	\declaretheorem[style=thmstyle,name=Proposition]{proposition}%

	% Unnumbered Theorem-like Environments
	\declaretheorem[style=thmstyle,unnumbered,name=Theorem*]{theorem*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Assertion*]{assertion*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Assumption*]{assumption*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Axiom*]{axiom*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Claim*]{claim*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Conclusion*]{conclusion*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Conjecture*]{conjecture*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Corollary*]{corollary*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Fact*]{fact*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Hypothesis*]{hypothesis*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Lemma*]{lemma*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Postulate*]{postulate*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Property*]{property*}%
	\declaretheorem[style=thmstyle,unnumbered,name=Proposition*]{proposition*}%

	% Definition-like Environments
	\declaretheorem[style=defstyle,name=Application]{application}%
	\declaretheorem[style=defstyle,name=Construction]{construction}%
	\declaretheorem[style=defstyle,name=Convention]{convention}%
	\declaretheorem[style=defstyle,name=Definition]{definition}%
	\declaretheorem[style=defstyle,name=Experiment]{experiment}%
	\declaretheorem[style=defstyle,name=Notation]{notation}%
	\declaretheorem[style=defstyle,name=Problem]{problem}%
	\declaretheorem[style=defstyle,name=Protocol]{protocol}%
	\declaretheorem[style=defstyle,name=Result]{result}%
	
	% Unnumbered Definition-like Environments
	\declaretheorem[style=defstyle,unnumbered,name=Application*]{application*}%
	\declaretheorem[style=defstyle,unnumbered,name=Construction*]{construction*}%
	\declaretheorem[style=defstyle,unnumbered,name=Convention*]{convention*}%
	\declaretheorem[style=defstyle,unnumbered,name=Definition*]{definition*}%
	\declaretheorem[style=defstyle,unnumbered,name=Experiment*]{experiment*}%
	\declaretheorem[style=defstyle,unnumbered,name=Notation*]{notation*}%
	\declaretheorem[style=defstyle,unnumbered,name=Problem*]{problem*}%
	\declaretheorem[style=defstyle,unnumbered,name=Protocol*]{protocol*}%
	\declaretheorem[style=defstyle,unnumbered,name=Result*]{result*}%

	% Remark-like Environments
	\declaretheorem[style=remarkstyle,name=Commentary]{commentary}%
	\declaretheorem[style=remarkstyle,name=Example]{example}%
	\declaretheorem[style=remarkstyle,name=Exercise]{exercise}%
	\declaretheorem[style=remarkstyle,name=Motivation]{motivation}%
	\declaretheorem[style=remarkstyle,name=Note]{note}%
	\declaretheorem[style=remarkstyle,name=Observation]{observation}%
	\declaretheorem[style=remarkstyle,name=Question]{question}%
	\declaretheorem[style=remarkstyle,name=Remark]{remark}%

	% Unnumbered Remark-like Environments
	\declaretheorem[style=remarkstyle,unnumbered,name=Commentary*]{commentary*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Example*]{example*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Exercise*]{exercise*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Motivation*]{motivation*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Note*]{note*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Observation*]{observation*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Question*]{question*}%
	\declaretheorem[style=remarkstyle,unnumbered,name=Remark*]{remark*}%

	% Highlight-like Environments
	\declaretheorem[style=hltstyle,name=Highlight]{highlight}%
	\declaretheorem[style=hltstyle,name=Important]{important}%
	\declaretheorem[style=hltstyle,name=KeyPoint]{keypoint}%
	\declaretheorem[style=hltstyle,name=Recall]{recall}%

	% Proof Environment (reset any previous definitions)
	\let\proof\relax%
	\let\endproof\relax%
	\declaretheorem[style=proofstyle]{proof}%
}

% Fancy Theorem Environments
\newcommand{\fancythm}{%
	% Common settings
	\renewcommand{\commonthmfont}{\normalfont}%
	\renewcommand{\commonthmsymb}{\ensuremath{\color{\accentcolor}\lrcorner}}%
	\renewcommand{\qedsymbol}{\ensuremath{\color{\accentcolor}\scriptstyle\blacksquare}}%

	% Heading fonts
	\renewcommand{\thmheadfont}{\sffamily}%
	\renewcommand{\defnheadfont}{\sffamily}%
	\renewcommand{\remarkheadfont}{\sffamily}%
	\renewcommand{\hltheadfont}{\sffamily}%

	% Body fonts
	\renewcommand{\thmfont}{\normalfont}%
	\renewcommand{\defnfont}{\normalfont}%
	\renewcommand{\remarkfont}{\normalfont}%
	\renewcommand{\hltfont}{\normalfont\sffamily\sansmath}%

	% Symbol definitions
	\renewcommand{\thmsymb}{}%
	\renewcommand{\defnsymb}{}%
	\renewcommand{\remarksymb}{}%
	\renewcommand{\hltsymb}{}%

	% Theorem style (with mdframed)
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,%
		headfont=\thmheadfont\color{\thmcolor}, notefont=\thmheadfont\color{\thmcolor},%
		bodyfont=\thmfont, postheadspace=5pt, numberwithin=section,%
		mdframed={linewidth=2pt, rightline=false, topline=false, bottomline=false,%
				linecolor=\thmcolor, backgroundcolor=\thmcolor!5},%
		headpunct={.}%
	]{thmstyle}%

	% Definition style
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,%
		headfont=\defnheadfont\color{\defncolor}, notefont=\defnheadfont\color{\defncolor},%
		bodyfont=\defnfont, postheadspace=5pt, numberwithin=section,%
		mdframed={linewidth=2pt, rightline=false, topline=false, bottomline=false,%
				linecolor=\defncolor, backgroundcolor=\defncolor!5},%
		headpunct={.}%
	]{defstyle}%

	% Remark style
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,%
		headfont=\remarkheadfont\color{\remarkcolor}, notefont=\remarkheadfont\color{\remarkcolor},%
		bodyfont=\remarkfont, postheadspace=5pt, numberwithin=section,%
		mdframed={linewidth=2pt, rightline=false, topline=false, bottomline=false,%
				linecolor=\remarkcolor, backgroundcolor=\remarkcolor!5},%
		headpunct={.}%
	]{remarkstyle}%

	% Highlight style
	\declaretheoremstyle[%
		spaceabove=0pt, spacebelow=0pt,%
		headfont=\hltheadfont\color{\hltcolor}, notefont=\hltheadfont\color{\hltcolor},%
		bodyfont=\hltfont, postheadspace=5pt, numberwithin=section,%
		mdframed={linewidth=2pt, rightline=false, topline=false, bottomline=false,%
				linecolor=\hltcolor, backgroundcolor=\hltcolor!5},%
		headpunct={.}%
	]{hltstyle}%

	% Proof style
	\declaretheoremstyle[%
		headfont=\sffamily\color{\thmcolor}, notefont=\sffamily\color{\thmcolor},%
		bodyfont=\normalfont, postheadspace=5pt, numbered=no, headpunct={.},%
		qed=\qedsymbol%
	]{proofstyle}%

	\basicenv%
}

% Standard (Normal) Theorem Environments
\newcommand{\normalthm}{%
	% Common settings
	\renewcommand{\commonthmfont}{\sffamily}%
	\renewcommand{\commonthmsymb}{\ensuremath{\color{\accentcolor}\lrcorner}}%
	\renewcommand{\qedsymbol}{\ensuremath{\color{\accentcolor}\scriptstyle\blacksquare}}%

	% Heading fonts
	\renewcommand{\thmheadfont}{\sffamily}%
	\renewcommand{\defnheadfont}{\sffamily}%
	\renewcommand{\remarkheadfont}{\sffamily}%
	\renewcommand{\hltheadfont}{\sffamily}%

	% Body fonts
	\renewcommand{\thmfont}{\normalfont}%
	\renewcommand{\defnfont}{\normalfont}%
	\renewcommand{\remarkfont}{\normalfont}%
	\renewcommand{\hltfont}{\normalfont\sffamily}%

	% Symbol definitions
	\renewcommand{\thmsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\blacktriangleright}}%
	\renewcommand{\defnsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\blacksquare}}%
	\renewcommand{\remarksymb}{\ensuremath{\color{\accentcolor}\scriptstyle\vartriangleright}}%
	\renewcommand{\hltsymb}{\ensuremath{\color{\accentcolor}\scriptstyle\square}}%

	% Theorem style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\thmheadfont\thmsymb~, notefont=\thmheadfont,%
		bodyfont=\thmfont, postheadspace=5pt, numberwithin=section,%
		qed=\commonthmsymb, headpunct={.}%
	]{thmstyle}%

	% Definition style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\defnheadfont\defnsymb~, notefont=\defnheadfont,%
		bodyfont=\defnfont, postheadspace=5pt, numberwithin=section,%
		qed=\commonthmsymb, headpunct={.}%
	]{defstyle}%

	% Remark style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\remarkheadfont\remarksymb~, notefont=\remarkheadfont,%
		bodyfont=\remarkfont, postheadspace=5pt, numberwithin=section,%
		qed=\commonthmsymb, headpunct={.}%
	]{remarkstyle}%

	% Highlight style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\hltheadfont\hltsymb~, notefont=\hltheadfont,%
		bodyfont=\hltfont, postheadspace=5pt, numberwithin=section,%
		qed=\commonthmsymb, headpunct={.}%
	]{hltstyle}%

	% Proof style
	\declaretheoremstyle[%
		headfont=\commonthmfont, notefont=\commonthmfont, bodyfont=\normalfont,%
		postheadspace=5pt, numbered=no, headpunct={.}, qed=\qedsymbol%
	]{proofstyle}%

	\basicenv%
}

% Old-School Theorem Environments
\newcommand{\oldschoolthm}{%
	% Common settings
	\renewcommand{\commonthmfont}{\normalfont}%
	\renewcommand{\commonthmsymb}{\ensuremath{\color{\accentcolor}\lrcorner}}%
	\renewcommand{\qedsymbol}{\ensuremath{\color{\accentcolor}\scriptstyle\blacksquare}}%

	% Heading fonts (old-school)
	\renewcommand{\thmheadfont}{\bfseries}%
	\renewcommand{\defnheadfont}{\scshape}%
	\renewcommand{\remarkheadfont}{\bfseries}%
	\renewcommand{\hltheadfont}{\sffamily}%

	% Body fonts
	\renewcommand{\thmfont}{\normalfont}%
	\renewcommand{\defnfont}{\normalfont}%
	\renewcommand{\remarkfont}{\normalfont}%
	\renewcommand{\hltfont}{\normalfont\sffamily}%

	% Symbol definitions
	\renewcommand{\thmsymb}{}%
	\renewcommand{\defnsymb}{}%
	\renewcommand{\remarksymb}{}%
	\renewcommand{\hltsymb}{}%

	% Theorem style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\thmheadfont\thmsymb, notefont=\thmheadfont,%
		bodyfont=\thmfont, postheadspace=5pt, numberwithin=section,%
		headpunct={.}%
	]{thmstyle}%

	% Definition style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\defnheadfont\defnsymb, notefont=\normalfont,%
		bodyfont=\defnfont, postheadspace=5pt, numberwithin=section,%
		headpunct={.}%
	]{defstyle}%

	% Remark style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\remarkheadfont\remarksymb, notefont=\normalfont,%
		bodyfont=\remarkfont, postheadspace=5pt, numberwithin=section,%
		headpunct={.}%
	]{remarkstyle}%

	% Highlight style
	\declaretheoremstyle[%
		spaceabove=\topsep, spacebelow=\topsep,%
		headfont=\hltheadfont\hltsymb, notefont=\hltheadfont,%
		bodyfont=\hltfont, postheadspace=5pt, numberwithin=section,%
		headpunct={.}%
	]{hltstyle}%

	% Proof style (italicized)
	\declaretheoremstyle[%
		headfont=\itshape, notefont=\itshape, bodyfont=\normalfont,%
		postheadspace=5pt, numbered=no, headpunct={.}, qed=\qedsymbol%
	]{proofstyle}%

	\basicenv%
}

% Cleveref Setup for Intelligent Cross-Referencing
\AtEndOfPackage{%
	\@ifpackageloaded{hyperref}{%
		\RequirePackage{cleveref}%

		% Theorem-like Environments
		\crefname{theorem}{theorem}{theorems}%
		\crefname{assertion}{assertion}{assertions}%
		\crefname{assumption}{assumption}{assumptions}%
		\crefname{axiom}{axiom}{axioms}%
		\crefname{claim}{claim}{claims}%
		\crefname{conclusion}{conclusion}{conclusions}%
		\crefname{conjecture}{conjecture}{conjectures}%
		\crefname{corollary}{corollary}{corollaries}%
		\crefname{fact}{fact}{facts}%
		\crefname{hypothesis}{hypothesis}{hypotheses}%
		\crefname{lemma}{lemma}{lemmas}%
		\crefname{postulate}{postulate}{postulates}%
		\crefname{property}{property}{properties}%
		\crefname{proposition}{proposition}{propositions}%

		% Definition-like Environments
		\crefname{application}{application}{applications}%
		\crefname{construction}{construction}{constructions}%
		\crefname{convention}{convention}{conventions}%
		\crefname{definition}{definition}{definitions}%
		\crefname{experiment}{experiment}{experiments}%
		\crefname{notation}{notation}{notations}%
		\crefname{problem}{problem}{problems}%
		\crefname{protocol}{protocol}{protocols}%
		\crefname{result}{result}{results}%

		% Remark-like Environments
		\crefname{commentary}{commentary}{commentaries}%
		\crefname{example}{example}{examples}%
		\crefname{exercise}{exercise}{exercises}%
		\crefname{motivation}{motivation}{motivations}%
		\crefname{note}{note}{notes}%
		\crefname{observation}{observation}{observations}%
		\crefname{question}{question}{questions}%
		\crefname{remark}{remark}{remarks}%

		% Highlight-like Environments
		\crefname{highlight}{highlight}{highlights}%
		\crefname{important}{important}{importants}%
		\crefname{keypoint}{keypoint}{keypoints}%
		\crefname{recall}{recall}{recalls}%

		% Email Link Formatting
		\providecommand{\email}[1]{\href{mailto:#1}{\texttt{#1}}}%
	}{%
		\PackageWarning{csthm}{%
			The 'cleveref' option was set, but 'hyperref' is not loaded.%
			Skipping 'cleveref' loading.%
		}%
	}%
}%

\ifcsbook@fancythm
	\fancythm
	\typeout{csbook: Fancy theorem style is enabled.}
\else
	\typeout{csbook: Fancy theorem style is not enabled.}
\fi
\ifcsbook@normalthm
	\normalthm
	\typeout{csbook: Normal theorem style is enabled.}
\else
	\typeout{csbook: Normal theorem style is not enabled.}
\fi
\ifcsbook@oldschoolthm
	\oldschoolthm
	\typeout{csbook: Old school theorem style is enabled.}
\else
	\typeout{csbook: Old school theorem style is not enabled.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography Management with BibLaTeX
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Configure BibLaTeX package with desired settings
\newcommand{\biblatex}{% no argument
	\RequirePackage[%
		hyperref=auto,         % Enable compatibility with hyperref for clickable links
		defernumbers=true,     % Delay reference number assignment until all entries are processed
		style=alphabetic,      % Use alphabetic citation style (e.g., [Doe2025])
		backref=true,          % Enable back-references to the citing pages from the bibliography
		sorting=anyt,          % Sort entries by their appearance in the text (not alphabetically)
		maxalphanames=99,      % Allow up to 99 names in alphabetic citations before using et al.
		maxnames=999,          % Display up to 999 authors in citations before truncating
		backend=biber          % Use Biber for bibliography processing (recommended over BibTeX)
	]{biblatex}%

	% Set bibliography font size
	\renewcommand*{\bibfont}{\small}%

	% Customize back-reference text for singular and plural
	\DefineBibliographyStrings{english}{%
		backrefpage={\unskip Cited on page},%
		backrefpages={\unskip Cited on pages}%
	}%
}

% Command to apply sorted BibLaTeX configuration
\newcommand{\sortedbib}{% no argument
	\biblatex%
	\DeclareBibliographyCategory{cited}%
	\AtEveryCitekey{\addtocategory{cited}{\thefield{entrykey}}}%
}

\ifcsbook@biblatex
	\biblatex
	\typeout{csbook: BibLaTeX is enabled.}
\else
	\typeout{csbook: BibLaTeX is not used.}
\fi
\ifcsbook@sortedbib
	\sortedbib
	\typeout{csbook: Sorted BibLaTeX is enabled.}
\else
	\typeout{csbook: Sorted BibLaTeX is not used.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Environments and Custom Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Environment for displaying learned material
\NewDocumentEnvironment{learned}{o}{%
\IfNoValueTF{#1}{%
	\begin{colbox}[frametitle={\normalfont\sffamily\large What Have We Learned?\medskip\hrule}]  % Default title when no argument is provided
}{%
	\begin{colbox}[frametitle={\normalfont\sffamily\large#1\medskip\hrule}]  % Custom title when argument is provided
		}%
		}{%
	\end{colbox}
}

% Environment for chapter notes and historical context
\NewDocumentEnvironment{chapternotes}{o}{%
	\IfNoValueTF{#1}{%
		\section*{Chapter Notes and History}  % Default section title when no argument is provided
		\addcontentsline{toc}{section}{Chapter Notes and History}  % Include in table of contents
	}{%
		\section*{#1}  % Custom section title when argument is provided
		\addcontentsline{toc}{section}{#1}  % Include custom title in table of contents
	}%
}{%
}

% Environment for problems and problem sets
\NewDocumentEnvironment{problems}{o}{%
	\IfNoValueTF{#1}{%
		\section*{Problem Set}  % Default section title when no argument is provided
		\addcontentsline{toc}{section}{Problem Set}  % Include in table of contents
	}{%
		\section*{#1}  % Custom section title when argument is provided
		\addcontentsline{toc}{section}{#1}  % Include custom title in table of contents
	}%

	% Customize enumeration format for problem items
	\setlist[enumerate, 1]{label={$\textrm{(\thechapter.\arabic*)}~$}, left=0pt}  % Format for main problem numbers
	\setlist[enumerate, 2]{label=(\arabic*), left=1em}  % Format for sub-problems
	\begin{enumerate}
		}{%
	\end{enumerate}
}

% Environment for multiple-choice questions
\NewDocumentEnvironment{mcq}{}{%
	\begin{enumerate}[label={$\texttt{\small(\alph*)}$}]  % Format for multiple-choice options
		}{%
	\end{enumerate}
}

% Environment for case study sections
\NewDocumentEnvironment{casestudy}{}{%
	\begin{mdframed}[linewidth=1pt,linecolor=black,backgroundcolor=none]  % Framed box for case studies
		}{%
	\end{mdframed}
}

% Custom command for "hard" list items with chapter-based numbering
\NewDocumentCommand{\harditem}{}{%
	\item[\textrm{(\ensuremath{\color{accentcolor}\star}\,\thechapter.\number\numexpr\value{enumi}+1\relax)}]  % Adds chapter-based numbering with a star
	\stepcounter{enumi}  % Increment item counter
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Utility Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Inline Commands
\newcommand{\code}[1]{{\ttfamily#1}} % Renders inline code
\newcommand{\cat}[1]{\ensuremath{\mathsf{#1}}} % Renders category names in math mode
\newcommand{\strike}[1]{\bgroup\ULdepth=-.55ex\ULon#1\ULoff\egroup} % Strike-through text
\newcommand{\dropcap}[2]{\lettrine[lines=2, lhang=0.05]{\textcolor{accentcolor}{#1}}{#2}} % Creates a colored drop-cap
\newcommand{\term}[1]{#1\index{#1}} % Marks a term for glossary/indexing
\newcommand{\textem}[1]{{\bfseries\color{accentcolor}#1}} % Applies bold and colored emphasis
\newcommand{\urlref}[1]{\href{#1}{#1}} % Creates a hyperlink to a URL

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Customisation of \maketitle Command
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{hep-title}    % Custom title formatting package
\RequirePackage{pgfornament}  % Package for adding decorative elements

\newcommand{\fancymaketitle}{%
	% Title Formatting
	\pretitle{\normalfont\scshape\LARGE\begin{center}} % Title styling and center alignment
			\posttitle{\end{center}} % End title alignment
	% Subtitle Formatting
	\presubtitle{\Large\scshape\begin{center}} % Subtitle styling and center alignment
			\postsubtitle{\par\end{center}} % End subtitle alignment
	% Author Formatting
	\preauthor{\scshape\large\begin{center}\lineskip0.25em\begin{tabular}[t]{c}} % Author styling and center alignment
				\postauthor{\end{tabular}\par\end{center}} % End author alignment
	% Date Formatting
	\predate{\normalsize\scshape\begin{center}\par} % Date styling and center alignment
			\postdate{\par\end{center}} % End date alignment
}

% Apply custom title formatting at the end of the preamble
\AtEndPreamble{\fancymaketitle}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Print Title Page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\printtitlepage}{
	\cleardoublepage % Start a new page
	\begingroup
	\thispagestyle{empty} % No header/footer on the title page
	\vspace*{\fill} % Center content vertically
	\Huge\scshape % Apply title styling
	\begin{flushright} % Right-align title
		\hrule width \textwidth height 1pt\par % Horizontal rule above title
		\vspace{1cm} % Space between rule and title
		\@title\par % Display the title
		\vspace{1cm} % Space between title and rule
		\hrule width \textwidth height 1pt % Horizontal rule below title
	\end{flushright}
	\vspace*{\fill} % Center content vertically
	\endgroup
	\clearpage % End the page
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Command for Generating the Copyright Page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\makecopyrightpage}{%
	\pagestyle{empty} % No header/footer on the copyright page
	\begingroup
	% Title and copyright information
	\begin{flushleft}
		{\noindent\large\textbf{\@title}}\par\medskip % Title in large bold text
		{\noindent\normalsize By \@author}\par\smallskip % Author information
		{\noindent\normalsize\textcopyright~\@date. All Rights Reserved.}\par % Copyright symbol and date
	\end{flushleft}
	\vfill % Push content to the bottom
	% Copyright and usage notice
	\begin{small}
		This is a prepublication manuscript. The contents are subject to revision and may differ from the final published version. This draft is provided for limited distribution for academic, editorial, and peer review purposes only. It is not to be considered a final or authoritative edition of the work. All rights to this manuscript, including but not limited to rights of reproduction, distribution, adaptation, and public display, are reserved by the author. No part of this work may be copied, shared, reproduced, stored, or transmitted in any form, including electronic, mechanical, photocopying, or any other means, without explicit prior written permission from the author or authorized publisher. The author grants permission for fair use in academic discourse, including citation, commentary, and critique. However, commercial reproduction, distribution, adaptation, and integration into artificial intelligence or machine learning models are strictly prohibited without formal licensing agreements. This manuscript is provided ``as is'' without warranties of any kind, express or implied. The author makes no representations regarding the accuracy, completeness, or suitability of the content for any specific purpose. The author assumes no liability for any reliance on this work before its official publication. For permissions, licensing, or inquiries regarding publication rights, please contact the author directly. Unauthorized use may result in legal action under applicable copyright and intellectual property laws.
	\end{small}
	\endgroup
	\cleardoublepage % Start a new page
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code Listings and Snippets Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\codelist}{%
	\RequirePackage{listings}  % Package for code listings

	% Define C code style
	\lstdefinestyle{CStyle}{%
		language=C,  % Language set to C
		basicstyle=\ttfamily\small,  % Basic font style for code
		keywordstyle=\color{RoyalBlue3},  % Style for keywords
		keywordstyle=[2]\color{HotPink4},  % Style for second-level keywords
		keywordstyle=[3]\color{SpringGreen4},  % Style for third-level keywords
		keywordstyle=[4]\color{SlateBlue2},  % Style for fourth-level keywords
		commentstyle=\color{LightSteelBlue4},  % Style for comments
		stringstyle=\color{Firebrick2},  % Style for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4},  % Line number style
		numbers=left,  % Show line numbers on the left
		stepnumber=1,  % Number each line
		numbersep=10pt,  % Space between numbers and code
		backgroundcolor=\color{white},  % Background color of the code box
		breaklines=true,  % Enable line breaking
		captionpos=b,  % Position of the caption (below)
		showspaces=false,  % Do not show spaces
		showstringspaces=false,  % Do not show spaces in strings
		showtabs=false,  % Do not show tab characters
		tabsize=4,  % Tab size
		escapeinside={\%*}{*)}  % Escape sequence for special characters
	}

	% Define C++ code style
	\lstdefinestyle{CPlusPlusStyle}{%
		language=C++,  % Language set to C++
		basicstyle=\ttfamily\small,  % Basic font style for code
		keywordstyle=\color{RoyalBlue3},  % Style for keywords
		keywordstyle=[2]\color{HotPink4},  % Style for second-level keywords
		keywordstyle=[3]\color{SpringGreen4},  % Style for third-level keywords
		keywordstyle=[4]\color{SlateBlue2},  % Style for fourth-level keywords
		commentstyle=\color{LightSteelBlue4},  % Style for comments
		stringstyle=\color{Firebrick2},  % Style for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4},  % Line number style
		numbers=left,  % Show line numbers on the left
		stepnumber=1,  % Number each line
		numbersep=10pt,  % Space between numbers and code
		backgroundcolor=\color{white},  % Background color of the code box
		breaklines=true,  % Enable line breaking
		captionpos=b,  % Position of the caption (below)
		showspaces=false,  % Do not show spaces
		showstringspaces=false,  % Do not show spaces in strings
		showtabs=false,  % Do not show tab characters
		tabsize=4,  % Tab size
		escapeinside={\%*}{*)}  % Escape sequence for special characters
	}

	% Define Java code style
	\lstdefinestyle{JavaStyle}{%
		language=Java,  % Language set to Java
		basicstyle=\ttfamily\small,  % Basic font style for code
		keywordstyle=\color{RoyalBlue3},  % Style for keywords
		keywordstyle=[2]\color{HotPink4},  % Style for second-level keywords
		keywordstyle=[3]\color{SpringGreen4},  % Style for third-level keywords
		keywordstyle=[4]\color{SlateBlue2},  % Style for fourth-level keywords
		commentstyle=\color{LightSteelBlue4},  % Style for comments
		stringstyle=\color{Firebrick2},  % Style for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4},  % Line number style
		numbers=left,  % Show line numbers on the left
		stepnumber=1,  % Number each line
		numbersep=10pt,  % Space between numbers and code
		backgroundcolor=\color{white},  % Background color of the code box
		breaklines=true,  % Enable line breaking
		captionpos=b,  % Position of the caption (below)
		showspaces=false,  % Do not show spaces
		showstringspaces=false,  % Do not show spaces in strings
		showtabs=false,  % Do not show tab characters
		tabsize=4,  % Tab size
		escapeinside={\%*}{*)}  % Escape sequence for special characters
	}

	% Define Python code style
	\lstdefinestyle{PythonStyle}{%
		language=Python,  % Language set to Python
		basicstyle=\ttfamily\small,  % Basic font style for code
		keywordstyle=\color{RoyalBlue3},  % Style for keywords
		keywordstyle=[2]\color{HotPink4},  % Style for second-level keywords
		keywordstyle=[3]\color{SpringGreen4},  % Style for third-level keywords
		keywordstyle=[4]\color{SlateBlue2},  % Style for fourth-level keywords
		commentstyle=\color{LightSteelBlue4},  % Style for comments
		stringstyle=\color{Firebrick2},  % Style for strings
		numberstyle=\tiny\ttfamily\color{SlateGray4},  % Line number style
		numbers=left,  % Show line numbers on the left
		stepnumber=1,  % Number each line
		numbersep=10pt,  % Space between numbers and code
		backgroundcolor=\color{white},  % Background color of the code box
		breaklines=true,  % Enable line breaking
		captionpos=b,  % Position of the caption (below)
		showspaces=false,  % Do not show spaces
		showstringspaces=false,  % Do not show spaces in strings
		showtabs=false,  % Do not show tab characters
		tabsize=4,  % Tab size
		escapeinside={\%*}{*)}  % Escape sequence for special characters
	}

	% Reset the code box counter at the beginning of each chapter
	\preto\chapter{\setcounter{codeboxcounter}{0}}
	\newcounter{codeboxcounter}[chapter]  % Counter for code boxes

	% Define a new code box environment for formatted code snippets with an optional title
	\NewDocumentEnvironment{codebox}{O{Code Box}}{%
		\stepcounter{codeboxcounter}  % Increment the counter for the code box
		\begin{mdframed}[%
				frametitlebackgroundcolor=none,  % No background for the title
				frametitlefont=\scshape\sffamily,  % Title font style
				frametitleaboveskip=5pt,  % Space above title
				frametitlerule=true,  % Show rule below the title
				frametitlerulecolor=black,  % Rule color
				frametitlerulewidth=1pt,  % Rule width
				frametitlealignment=\raggedright,  % Title aligned to the left
				frametitle={\thechapter.\arabic{codeboxcounter}:~##1},  % Title with chapter and box number
				linewidth=1pt,  % Border thickness
				linecolor=black,  % Border color
				innertopmargin=10pt,  % Space at the top inside the box
				innerbottommargin=10pt,  % Space at the bottom inside the box
				leftline=false,  % No left border
				rightline=false  % No right border
			]%
			}{%
		\end{mdframed}
	}
	% Define a command to add a code listing with a title inside a code box
	% Arguments:
	%   #1 = Code box title
	%   #2 = Label (without "code:" prefix)
	%   #3 = Listing style (e.g. CStyle, CPlusPlusStyle, etc.)
	%   #4 = Filename of the code to include
	\newcommand{\addCode}[4]{%
		\begin{codebox}[##1]\label{code:##2}  % Create a code box with a title and label
			\lstinputlisting[style=##3]{##4}  % Input the code from the specified file
		\end{codebox}%
	}
}

\ifcsbook@codelist
	\codelist
	\typeout{csbook: Code listings are enabled.}
\else
	\typeout{csbook: Code listings are not used.}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Comments and TODOs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifcsbook@comments
	% Command for adding TODO notes
	\NewDocumentCommand{\todo}{m}{%
		\fcolorbox{IndianRed1!20}{IndianRed1!10}{\textsf{\color{IndianRed1}\small #1}}  % Wraps TODO notes in a colored box
	}

	% Command for indicating missing citations
	\NewDocumentCommand{\needcite}{o}{%
		\IfNoValueTF{#1}{%
			\fcolorbox{IndianRed1!20}{IndianRed1!10}{\textsf{\color{IndianRed1}\small Citation needed.}}  % Display a generic citation missing note
		}{%
			\fcolorbox{IndianRed1!20}{IndianRed1!10}{\textsf{\color{IndianRed1}\small Citation needed: #1}}  % Display a citation missing note with specific reference
		}%
	}

	% Command for marking citation errors
	\NewDocumentCommand{\misscite}{o}{%
		\IfNoValueTF{#1}{%
			\textsf{\small\color{IndianRed1}Missing citation!}  % Mark a citation as missing in the document
		}{%
			\textsf{\small\color{IndianRed1}Missing citation: #1!}  % Indicate a specific citation is missing
		}%
	}

	% Command for marking missing or undefined content
	\NewDocumentCommand{\missing}{m}{%
		\textsf{\color{IndianRed1}#1}  % Highlight the missing content with a specific color
	}

	% Command to define new comment macros with tags
	% Arguments:
	% #1 = Tag or description (e.g., "Fix")
	% #2 = Color for highlighting
	% #3 = Macro name (without backslash)
	\NewDocumentCommand{\newcomment}{mmm}{%
		\expandafter\NewDocumentCommand\csname#3\endcsname{m}{%
			\noindent\textcolor{#2}{\color{#2}\sffamily##1 -- $\mathsf{#1}$}  % New comment macro with specific color and description
		}%
	}
	\typeout{csbook: Comments are used.}  % Notify that comments are active
\else
	% If comments are disabled, all commands become no-operations
	\NewDocumentCommand{\todo}{m}{}  % No action for TODOs
	\NewDocumentCommand{\needcite}{o}{}  % No action for need cite
	\NewDocumentCommand{\misscite}{o}{}  % No action for miss cite
	\NewDocumentCommand{\missing}{m}{}  % No action for missing content
	\NewDocumentCommand{\newcomment}{mmm}{\expandafter\NewDocumentCommand\csname#3\endcsname{m}}{}  % No action for new comment macros
	\typeout{csbook: Comments are not used.}  % Notify that comments are not active
\fi

% Disable the use of '@' in command names
\makeatother

% End of package
\endinput
