%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% csdirty.sty — Academic LaTeX Package
% Author: Agni Datta
% Version: 1.6 (2025/06/26)
% License: LaTeX Project Public License v1.3c
% Contact: agnidatta.org@gmail.com
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OVERVIEW
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% The csdirty package offers a comprehensive, modular, and extensible LaTeX framework,
% specifically developed to meet the rigorous standards of academic, technical, and
% scientific writing. It streamlines the preparation of scholarly documents by integrating
% access to a curated suite of foundational and advanced LaTeX packages, supporting robust
% version control, and enabling precise feature customization. The package is suitable for
% research articles, technical reports, dissertations, and conference proceedings, and is
% engineered for compatibility with all major LaTeX engines and standard document classes.
%
% csdirty emphasizes reproducibility, typographic rigor, and workflow efficiency, allowing
% authors to focus on substantive content while ensuring professional presentation and
% compliance with academic conventions.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% KEY FEATURES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - Unified and conditional loading of essential and advanced LaTeX packages.
% - Flexible version control: seamless switching between full/preprint and short/conference versions.
% - Fine-grained toggling of features for graphics, cryptography, theorem environments, typography, and more.
% - Modern mathematics and font support, including Libertinus, Concmath, and Garamond.
% - Advanced table, figure, and content box environments, including support for multi-page and styled tables.
% - Enhanced support for cryptography, protocols, and upright Greek symbols.
% - Professional title, section, and table of contents formatting, with customizable spacing and fonts.
% - Robust support for comments, annotations, and author identification (including ORCID integration).
% - Comprehensive macro suite for cryptography, mathematics, and academic writing.
% - Enhanced environments for protocols, code listings, wireboxes, and simple content boxes.
% - Improved compatibility and fallback logic for upright Greek symbols and mathematical fonts.
% - Support for legacy section symbol formatting and advanced line spacing options.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% USAGE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   \usepackage[<options>]{csdirty}
%   % Example: \usepackage[full,comments,crypto]{csdirty}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OPTIONS (some options have both positive and negative forms)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% VERSION CONTROL:
%   fullversion        — Full document (authors, affiliations, appendices, etc.)
%   shortversion       — Abbreviated version (no appendices, detailed proofs, etc.)
%   preprint           — Alias for fullversion (for arXiv/preprints)
%
% COMMENTS & ANNOTATIONS:
%   comments           — Enable inline comments/annotations (loads comment package)
%   nocomments         — Disable comment functionality (default)
%
% MATHEMATICS & FONTS:
%   concmath           — Use Concmath for advanced math typesetting
%   noconcmath         — Do not use Concmath
%   libertinus         — Use Libertinus/Libertine font family for text/math
%   nolicertinus       — Do not use Libertinus/Libertine fonts
%   garamond           — Use Garamond font family for text
%   nogaramond         — Do not use Garamond fonts
%   nomath             — Disable advanced math packages (basic LaTeX math only)
%   modgreeksymbs      — Use upright Greek symbols (via upgreek, with robust fallback)
%   nicodemus          — Enable Nicodemus cryptography macros
%   nonicodemus        — Do not load Nicodemus macros
%
% FEATURE LOADING:
%   tikz               — Load TikZ suite (3dplot, cd, automata, circuits, etc.)
%   notikz             — Do not load TikZ or related graphics packages
%   appendix           — Enhanced appendix formatting and management
%   noappendix         — Do not load appendix enhancements
%   crypto             — Cryptography packages and notation (protocols, security, etc.)
%   nocrypto           — Do not load cryptography packages
%   theorems           — Enhanced theorem/proof environments and cross-referencing
%   notheorems         — Do not load theorem/proof enhancements
%   orcidlink          — ORCID link support for author identification
%   noorcidlink        — Do not load ORCID link package
%   epigraph           — Enhanced epigraph formatting and styling
%   noepigraph         — Do not load epigraph enhancements
%   fullpage           — Advanced full-page layout and formatting
%   nofullpage         — Do not load full-page layout options
%   nicespacing        — Enhanced line spacing (1.15 stretch factor)
%   badspacing         — Standard line spacing (1.0, default)
%   full               — Load all available features (recommended for full academic documents)
%   usefulcommands     — Load handy macros for cryptography, math, and writing
%   nousefulcommands   — Do not load the macro suite
%   oldsection         — Use legacy section symbol formatting (with section symbols)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ENHANCED ENVIRONMENTS & MACROS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - Advanced Graphics: PGFPlots (compatibility mode 1.18) for data visualization.
% - TikZ Libraries: 3D plotting, commutative diagrams, automata, circuits, logic, decorations, shapes, arrows, and more.
% - Colored Content Boxes: tcolorbox for styled content and wireboxes.
% - Framed Environments: mdframed for protocol, code list, and simple content boxes.
% - Advanced Tables: tabularray for complex, multi-page, and styled tables; tabularx, xtab, longtable, threeparttable, makecell, multicol, multirow.
% - Protocol and Code List Environments: \begin{protocolbox}, \begin{codelistbox}, \begin{simplebox}.
% - Wirebox Environment: \begin{wirebox} (if tcolorbox loaded).
% - Enhanced Title and Section Formatting: Customizable fonts and spacing for title, subtitle, author, affiliation, date, and preprint lines.
% - Table of Contents Spacing: Fine-tuned via \adjusttocspacing.
% - Upright Greek Letters: Optionally replaces standard Greek macros with upright forms, with robust fallback logic.
% - Useful Macros: For cryptography, mathematics, and general writing (if enabled).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% USAGE EXAMPLES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   % Basic usage with defaults
%   \usepackage{csdirty}
%
%   % Full version with all features
%   \usepackage[fullversion]{csdirty}
%
%   % Short version, no comments
%   \usepackage[shortversion,nocomments]{csdirty}
%
%   % With TikZ and cryptography
%   \usepackage[tikz,crypto]{csdirty}
%
%   % Theorem formatting and ORCID
%   \usepackage[theorems,orcidlink]{csdirty}
%
%   % Epigraphs and full-page layout
%   \usepackage[epigraph,fullpage]{csdirty}
%
%   % Enhanced line spacing
%   \usepackage[nicespacing]{csdirty}
%
%   % All features enabled
%   \usepackage[full]{csdirty}
%
%   % Exclude TikZ
%   \usepackage[notikz]{csdirty}
%
%   % Exclude appendix and epigraph features
%   \usepackage[noappendix,noepigraph]{csdirty}
%
%   % Libertinus font, Concmath, and crypto
%   \usepackage[libertinus,concmath,crypto]{csdirty}
%
%   % Garamond font and advanced tables
%   \usepackage[garamond]{csdirty}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ENVIRONMENT USAGE EXAMPLES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   % Colored content box (tcolorbox)
%   \begin{tcolorbox}[colback=blue!5!white, colframe=blue!75!black, title=Example Box]
%   This is a styled content box.
%   \end{tcolorbox}
%
%   % Wirebox (if tcolorbox loaded)
%   \begin{wirebox}
%   This is a wirebox for highlighting content.
%   \end{wirebox}
%
%   % Protocol box (if mdframed loaded)
%   \begin{protocolbox}[Protocol Name]
%   \item Step 1
%   \item Step 2
%   \end{protocolbox}
%
%   % Advanced table (tabularray is always loaded)
%   \begin{tblr}{
%     colspec = {Q[l]Q[c]Q[r]},
%     row{1} = {font=\bfseries}
%   }
%   Header 1 & Header 2 & Header 3 \\
%   Left     & Center   & Right    \\
%   \end{tblr}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEPENDENCIES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Core dependencies (always loaded):
%   - amsmath, amssymb (mathematical notation)
%   - geometry (page layout)
%   - hyperref (hyperlinks and references)
%   - tabularray, tabularx, xtab, longtable, threeparttable, makecell, multicol, multirow (advanced tables)
%   - setspace (line spacing control)
%   - microtype (enhanced typography)
%   - ragged2e, xhfill (text formatting)
%   - graphicx, pdflscape, placeins, wrapfig, rotating, subcaption (graphics and floats)
%
% Optional dependencies (loaded based on options):
%   - tikz, tikz-cd, tikz-3dplot, and TikZ libraries (tikz option)
%   - pgfplots (data visualization)
%   - tcolorbox (colored content boxes)
%   - mdframed (framed environments)
%   - comment (comments option)
%   - cryptography packages (crypto option)
%   - csthm (theorems option)
%   - orcidlink (orcidlink option)
%   - appendix (appendix option)
%   - epigraph (epigraph option)
%   - libertinus, unicode-math, fontspec (libertinus option)
%   - concmath (concmath option)
%   - garamond (garamond option)
%   - nicodemus (nicodemus option)
%   - upgreek (modgreeksymbs option)
%   - hep-title (title formatting)
%   - titlesec, tocloft (section and TOC formatting)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% COMPATIBILITY
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - Fully compatible with modern LaTeX distributions (TeX Live 2022+, MiKTeX 23+).
% - Extensively tested with standard document classes: article, report, book, and others.
% - Requires e-TeX extensions (standard in modern LaTeX).
% - Supports all major engines: pdfLaTeX, XeLaTeX, and LuaLaTeX.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% KNOWN ISSUES & LIMITATIONS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - Version control options may require manual adjustment for complex or highly customized documents.
% - TikZ graphics may require multiple compilation passes for complex diagrams.
% - PGFPlots compatibility mode 1.18 may require adjustment for newer versions.
% - Full-page layout options may conflict with certain document class settings.
% - Enhanced spacing and advanced typography may affect layout and require fine-tuning.
% - Some options may increase compilation time and memory usage.
% - Certain advanced features (e.g., fontspec, unicode-math) require specific engines (XeLaTeX/LuaLaTeX).
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CHANGELOG (v1.6)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% - Expanded TikZ library support (including logic, circuits, datavisualization, etc.).
% - Added upright Greek symbol option (modgreeksymbs) with robust fallback logic.
% - Improved protocol, code list, and simple box environments (mdframed-based).
% - Enhanced table support: tabularray, tabularx, xtab, longtable, threeparttable, makecell.
% - Improved title and section formatting (hep-title, titlesec, tocloft).
% - Added wirebox environment (tcolorbox-based).
% - Improved macro suite for cryptography and mathematics.
% - Added Garamond font support for text.
% - Updated documentation and usage examples for clarity and completeness.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ProvidesPackage{csdirty}[2025/06/26 v1.6 csdirty package]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Options
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% General Boolean flags
\newif\ifComments                       \Commentsfalse
\newif\ifFullVersion                    \FullVersionfalse
\newif\ifShortVersion                   \ShortVersionfalse

% Package-specific Boolean flags
\newif\ifcsdirty@Concmath               \csdirty@Concmathfalse
\newif\ifcsdirty@Garamond               \csdirty@Garamondfalse
\newif\ifcsdirty@Libertinus             \csdirty@Libertinusfalse
\newif\ifcsdirty@LoadAppendix           \csdirty@LoadAppendixfalse
\newif\ifcsdirty@LoadCrypto             \csdirty@LoadCryptofalse
\newif\ifcsdirty@LoadEpigraph           \csdirty@LoadEpigraphfalse
\newif\ifcsdirty@LoadFull               \csdirty@LoadFulltrue
\newif\ifcsdirty@LoadFullPage           \csdirty@LoadFullPagefalse
\newif\ifcsdirty@LoadNiceSpacing        \csdirty@LoadNiceSpacingfalse
\newif\ifcsdirty@LoadNicodemus          \csdirty@LoadNicodemusfalse
\newif\ifcsdirty@LoadNoMath             \csdirty@LoadNoMathfalse
\newif\ifcsdirty@LoadOldSectionSymb     \csdirty@LoadOldSectionSymbfalse
\newif\ifcsdirty@LoadOrcidlink          \csdirty@LoadOrcidlinkfalse
\newif\ifcsdirty@LoadTheorems           \csdirty@LoadTheoremsfalse
\newif\ifcsdirty@LoadTikz               \csdirty@LoadTikzfalse
\newif\ifcsdirty@LoadUsefulCommands     \csdirty@LoadUsefulCommandstrue
\newif\ifcsdirty@ModGreekSymbs          \csdirty@ModGreekSymbsfalse

% Version control options
\DeclareOption{fullversion}{\FullVersiontrue\ShortVersionfalse}             % Use full version
\DeclareOption{shortversion}{\ShortVersiontrue\FullVersionfalse}            % Use short version
\DeclareOption{preprint}{\ShortVersionfalse\FullVersiontrue}                % Preprint = full version

% Comment and annotation options
\DeclareOption{appendix}{\csdirty@LoadAppendixtrue}                         % Load Appendix
\DeclareOption{badspacing}{\csdirty@LoadNiceSpacingfalse}                   % Load Bad Spacing
\DeclareOption{comments}{\Commentstrue}                                     % Enable comments
\DeclareOption{concrete}{\csdirty@Concmathtrue}                             % Enable Concmath
\DeclareOption{garamond}{\csdirty@Garamondtrue}                             % Enable Garamond font
\DeclareOption{crypto}{\csdirty@LoadCryptotrue}                             % Load Cryptography
\DeclareOption{epigraph}{\csdirty@LoadEpigraphtrue}                         % Load Epigraphs
\DeclareOption{full}{\csdirty@LoadFulltrue}                                 % Load Full
\DeclareOption{fullpage}{\csdirty@LoadFullPagetrue}                         % Load Full Page
\DeclareOption{libertinus}{\csdirty@Libertinustrue}                         % Enable Libertinus/Libertine font
\DeclareOption{modgreeksymbs}{\csdirty@ModGreekSymbstrue}                   % Load modified Greek symbols
\DeclareOption{nicespacing}{\csdirty@LoadNiceSpacingtrue}                   % Load Nice Spacing
\DeclareOption{nicodemus}{\csdirty@LoadNicodemustrue}                       % Enable Nicodemus macros
\DeclareOption{noappendix}{\csdirty@LoadAppendixfalse}                      % Do not load Appendix
\DeclareOption{nocomments}{\Commentsfalse}                                  % Disable comments
\DeclareOption{nocrypto}{\csdirty@LoadCryptofalse}                          % Do not load Cryptography
\DeclareOption{noepigraph}{\csdirty@LoadEpigraphfalse}                      % Do not load Epigraphs
\DeclareOption{nofullpage}{\csdirty@LoadFullPagefalse}                      % Do not load Full Page
\DeclareOption{nomath}{\csdirty@LoadNoMathtrue}                             % Disable math packages
\DeclareOption{noorcidlink}{\csdirty@LoadOrcidlinkfalse}                    % Do not load ORCID link
\DeclareOption{notheorems}{\csdirty@LoadTheoremsfalse}                      % Do not load Theorems
\DeclareOption{notikz}{\csdirty@LoadTikzfalse}                              % Do not load TikZ
\DeclareOption{nousefulcommands}{\csdirty@LoadUsefulCommandsfalse}          % Do not load Useful Commands
\DeclareOption{oldsection}{\csdirty@LoadOldSectionSymbtrue}                 % Load old section symbol
\DeclareOption{orcidlink}{\csdirty@LoadOrcidlinktrue}                       % Load ORCID link
\DeclareOption{theorems}{\csdirty@LoadTheoremstrue}                         % Load Theorems
\DeclareOption{tikz}{\csdirty@LoadTikztrue}                                 % Load TikZ
\DeclareOption{usefulcommands}{\csdirty@LoadUsefulCommandstrue}             % Load Useful Commands

\ifcsdirty@LoadFull
	\typeout{csdirty: Loading full version}
	\csdirty@LoadAppendixtrue
	\csdirty@LoadEpigraphtrue
	\csdirty@LoadNiceSpacingtrue
	\csdirty@LoadOrcidlinktrue
	\csdirty@LoadTheoremstrue
	\csdirty@LoadTikztrue
	\csdirty@LoadUsefulCommandstrue
\fi

% Ignore unknown options
\DeclareOption*{\PackageWarning{csdirty}{Unknown option '\CurrentOption'}}
\DeclareOption*{\relax}
\ProcessOptions\relax

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Core Programming and Utility Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{calc}                                        % Arithmetic with lengths
\RequirePackage{comment}                                     % Block comment environment
\RequirePackage{etoolbox}                                    % Logic and macro patching
\RequirePackage{ifpdf}                                       % Detect PDF output mode
\RequirePackage{iftex}                                       % Detect engine: pdfTeX, XeTeX, LuaTeX
\RequirePackage{xkeyval}                                     % Key-value parsing
\RequirePackage{xparse}                                      % Extended command/environment definitions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Engine and Class Compatibility Warnings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifLuaTeX
	\typeout{csdirty: rock on! LuaTeX engine detected (this is the good stuff)}
\else
	\ifXeTeX
		\typeout{csdirty: nice! XeTeX engine detected (you're doing it right)}
	\else
		\PackageWarning{csdirty}{%
			pdfTeX engine detected. Concrete math option requires LuaTeX or XeTeX for full Unicode support.
		}%
	\fi
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Check for supported document classes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\@ifclassloaded{article}{%
	\typeout{csdirty: Detected document class: article.}
}{%
	\@ifclassloaded{report}{%
		\typeout{csdirty: Detected document class: report.}
	}{%
		\@ifclassloaded{book}{%
			\typeout{csdirty: Detected document class: book.}
		}{%
			\PackageWarning{csdirty}{%
				Unsupported document class detected.
				This package is officially supported only for the following classes: article, report, or book.
				Your class (\@classload) has not been tested with this package.
				Unexpected behavior may occur.
			}%
		}%
	}%
}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Color
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[x11names, dvipsnames, svgnames]{xcolor}      % Extended color support.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PDF and Document Structure Control
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[2.0,objcompress,compress]{bxpdfver}          % PDF version and compression management
\RequirePackage[nottoc]{tocbibind}                           % Add bibliography/lists to TOC (exclude TOC itself)
\RequirePackage{babel}                                       % Language, hyphenation
\RequirePackage{pdfpages}                                    % Include external PDFs
\RequirePackage{refcount}                                    % Reference counting

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Margin and Spacing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifcsdirty@LoadFullPage
	\RequirePackage[margin=2.5cm]{geometry}     	% Page layout
	\typeout{csdirty: Loading full page layout}
\else
	\RequirePackage[margin=3.5cm]{geometry}         % Page layout (default)
	\typeout{csdirty: Loading default page layout}
\fi

\ifcsdirty@LoadNiceSpacing
	\RequirePackage{setspace}
	\setstretch{1.15}
\else
	\RequirePackage{setspace}
	\setstretch{1.0}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Text, Layout, and Miscellaneous Enhancements
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[autostyle=true, csdisplay=true]{csquotes}    % Automatic quotation marks and smart citations
\RequirePackage[final]{microtype}                            % Improved justification and hyphenation
\RequirePackage[full]{textcomp}                              % Additional text symbols (e.g., degree sign)
\RequirePackage[nocompress]{cite}                            % Citation package for references
\RequirePackage[normalem]{ulem}                              % Underlining and strikethrough capabilities
\RequirePackage{emptypage}                                   % No page numbers on empty pages
\RequirePackage{lipsum}                                      % Dummy text
\RequirePackage{paralist}                                    % Long List Style environments
\RequirePackage{pifont}                                      % For using Dingbat fonts
\RequirePackage{soul}                                        % For text highlighting
\RequirePackage{xspace}                                      % Intelligent spacing after macros
\RequirePackage{xurl}                                        % Breakable URLs

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fonts and Math
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\csdirty@loadnomath}{%
	\typeout{csdirty: Loading no math packages}
	\RequirePackage[T1]{fontenc}
}

\newcommand{\csdirty@loadlibertinus}{%
	\ifLuaTeX
		\typeout{csdirty: Loading Libertinus math for LuaTeX}
		\RequirePackage{lualatex-math}
		\RequirePackage{amssymb}
		\RequirePackage{mathtools}
		\RequirePackage{fontspec}
		\RequirePackage{moresize}
		\RequirePackage{nicefrac}
		\RequirePackage{siunitx}
		\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
		\setmainfont[
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+cpsp,+kern,+liga,+lnum,+mark,+mkmk,+pnum,+ss06},
			ItalicFont = LibertinusSerif-Italic.otf,
			BoldFont = LibertinusSerif-Bold.otf,
			BoldItalicFont = LibertinusSerif-BoldItalic.otf
		]{LibertinusSerif-Regular.otf}
		\setmathfont[
			AutoFakeBold,
			Scale=MatchUppercase
		]{LibertinusMath-Regular.otf}
		\setmonofont[
			Scale=MatchLowercase,
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+dlig,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
		]{notosansmono}
		\setsansfont[
			Scale=MatchLowercase,
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
		]{ysabeau}
		\let\mathbfcal\relax
		\let\mathbfscr\relax
		\RequirePackage{mathrsfs}
		\RequirePackage[cal=stixplain,bb=bboldx,scr=esstix]{mathalpha}
	\else
		\ifXeTeX
			\typeout{csdirty: Loading Libertinus math for XeTeX}
			\RequirePackage{amssymb}
			\RequirePackage{mathtools}
			\RequirePackage{moresize}
			\RequirePackage{nicefrac}
			\RequirePackage{siunitx}
			\RequirePackage{fontspec}
			\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
			\setmainfont[
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+cpsp,+kern,+liga,+lnum,+mark,+mkmk,+pnum,+ss06},
				ItalicFont = LibertinusSerif-Italic.otf,
				BoldFont = LibertinusSerif-Bold.otf,
				BoldItalicFont = LibertinusSerif-BoldItalic.otf
			]{LibertinusSerif-Regular.otf}
			\setmathfont[
				AutoFakeBold,
				Scale=MatchUppercase
			]{LibertinusMath-Regular.otf}
			\setmonofont[
				Scale=MatchLowercase,
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+dlig,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
			]{inconsolata}
			\setsansfont[
				Scale=MatchLowercase,
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
			]{Ysabeau}
			\let\mathbfcal\relax
			\let\mathbfscr\relax
			\RequirePackage{mathrsfs}
			\RequirePackage[cal=stixplain,bb=bboldx,scr=esstix]{mathalpha}
		\else
			\typeout{csdirty: Libertinus math with nextx supported for this engine.}
			\RequirePackage[T1]{fontenc}
			\RequirePackage{amssymb}
			\RequirePackage{mathtools}
			\RequirePackage{moresize}
			\RequirePackage{nicefrac}
			\RequirePackage{siunitx}
			\RequirePackage{libertineRoman}
			\RequirePackage{AnonymousPro}
			\RequirePackage{ysabeau}
			\RequirePackage[libertine]{newtxmath}
			\RequirePackage[bb=bboldx,cal=cm,scr=esstix]{mathalpha}
		\fi
	\fi
}

\newcommand{\csdirty@loadconcmath}{%
	\ifLuaTeX
		\typeout{csdirty: Loading Concrete math for LuaTeX}
		\RequirePackage{amssymb}
		\RequirePackage{mathtools}
		\RequirePackage{fontspec}
		\RequirePackage{moresize}
		\RequirePackage{nicefrac}
		\RequirePackage{siunitx}
		\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
		\RequirePackage[concrete]{fontsetup}
		\let\mathbfcal\relax
		\let\mathbfscr\relax
		\RequirePackage{mathrsfs}
		\RequirePackage[cal=cm,bb=bboldx,scr=esstix]{mathalpha}
	\else
		\ifXeTeX
			\typeout{csdirty: Loading Concrete math for XeTeX}
			\RequirePackage{amssymb}
			\RequirePackage{mathtools}
			\RequirePackage{fontspec}
			\RequirePackage{moresize}
			\RequirePackage{nicefrac}
			\RequirePackage{siunitx}
			\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
			\RequirePackage[concrete]{fontsetup}
			\let\mathbfcal\relax
			\let\mathbfscr\relax
			\RequirePackage{mathrsfs}
			\RequirePackage[bb=bboldx,cal=cm,scr=esstix]{mathalpha}
		\else
			\typeout{csdirty: Concrete math setup not supported for this engine.}
		\fi
	\fi
}

\newcommand{\csdirty@loadgaramond}{%
	\ifLuaTeX
		\typeout{csdirty: Loading Garamond math for LuaTeX}
		\RequirePackage{lualatex-math}
		\RequirePackage{amssymb}
		\RequirePackage{mathtools}
		\RequirePackage{fontspec}
		\RequirePackage{moresize}
		\RequirePackage{nicefrac}
		\RequirePackage{siunitx}
		\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
		\setmainfont[
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+cpsp,+kern,+liga,+lnum,+mark,+mkmk,+pnum},
			SmallCapsFont = EBGaramond-Medium.otf,
			BoldFont = GaramondLibre-Bold.otf,
			ItalicFont = GaramondLibre-Italic.otf,
			BoldItalicFont = GaramondLibre-BoldItalic.otf
		]{GaramondLibre-Regular.otf}
		\setmathfont[
			AutoFakeBold,
			StylisticSet = {2,6,7,9},
			Scale=MatchUppercase
		]{Garamond-Math.otf}
		\setmonofont[
			Scale=MatchLowercase,
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+dlig,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
		]{notosansmono}
		\setsansfont[
			Scale=MatchLowercase,
			SmallCapsFeatures={RawFeature=+smcp},
			RawFeature={+calt,+case,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
		]{ysabeau}
		\let\mathbfcal\relax
		\let\mathbfscr\relax
		\RequirePackage{mathrsfs}
		\RequirePackage[cal=cm,bb=bboldx,scr=esstix]{mathalpha}
	\else
		\ifXeTeX
			\RequirePackage{amssymb}
			\RequirePackage{mathtools}
			\RequirePackage{moresize}
			\RequirePackage{nicefrac}
			\RequirePackage{siunitx}
			\RequirePackage{fontspec}
			\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
			\setmainfont[
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+cpsp,+kern,+liga,+lnum,+mark,+mkmk,+pnum},
				SmallCapsFont = EBGaramond-Medium.otf,
				BoldFont = GaramondLibre-Bold.otf,
				ItalicFont = GaramondLibre-Italic.otf,
				BoldItalicFont = GaramondLibre-BoldItalic.otf
			]{GaramondLibre-Regular.otf}
			\setmathfont[
				AutoFakeBold,
				StylisticSet = {2,6,7,9},
				Scale=MatchUppercase
			]{Garamond-Math.otf}
			\setmonofont[
				Scale=MatchLowercase,
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+dlig,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
			]{inconsolata}
			\setsansfont[
				Scale=MatchLowercase,
				SmallCapsFeatures={RawFeature=+smcp},
				RawFeature={+calt,+case,+kern,+liga,+lnum,+mark,+mkmk,+pnum}
			]{Ysabeau}
			\let\mathbfcal\relax
			\let\mathbfscr\relax
			\RequirePackage{mathrsfs}
			\RequirePackage[cal=cm,bb=bboldx,scr=esstix]{mathalpha}
		\fi
	\fi
}

\newcommand{\csdirty@loadlatinmodern}{%
	\typeout{csdirty: Loading Latin Modern math}
	\RequirePackage{fontspec}
	\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
	\setmainfont[
		ItalicFont = NewCM10-BookItalic.otf,
		SmallCapsFont = NewCM10-Book.otf,
		SmallCapsFeatures = {RawFeature=+smcp},
		BoldFont = NewCM10-Bold.otf,
		BoldItalicFont = NewCM10-BoldItalic.otf,
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}
	]{NewCM10-Book.otf}
	\setmathfont{NewCMMath-Book.otf}
	\setsansfont[
		ItalicFont = NewCMSans10-Oblique.otf,
		SmallCapsFont = NewCMSans10-Book.otf,
		SmallCapsFeatures = {RawFeature=+smcp},
		BoldFont = NewCMSans10-Bold.otf,
		BoldItalicFont = NewCMSans10-BoldOblique.otf,
		RawFeature = {+calt, +case, +hlig, +kern, +liga, +lnum, +mark, +mkmk, +pnum}
	]{NewCMSans10-Book.otf}
}

\newcommand{\csdirty@loadstdmath}{%
	\typeout{csdirty: Loading standard math packages}
	\RequirePackage[T1]{fontenc}
	\RequirePackage{lmodern}
	\RequirePackage{amsfonts}
	\RequirePackage{amsmath}
	\RequirePackage{moresize}
	\RequirePackage{nicefrac}
	\RequirePackage{siunitx}
	\ifLuaTeX
		\csdirty@loadlatinmodern
	\else
		\ifXeTeX
			\csdirty@loadlatinmodern
		\else
			\RequirePackage{amssymb}
			\RequirePackage{bm}
			\RequirePackage{mathtools}
		\fi
	\fi
	\let\mathbfcal\relax
	\let\mathbfscr\relax
	\RequirePackage{mathrsfs}
	\RequirePackage[cal=cm,bb=bboldx,scr=esstix]{mathalpha}
}

% Select math loader at end of preamble
\AtEndPreamble{%
	\ifcsdirty@LoadNoMath
		\csdirty@loadnomath
	\else
		\ifcsdirty@Libertinus
			\csdirty@loadlibertinus
		\else
			\ifcsdirty@Concmath
				\csdirty@loadconcmath
			\else
				\ifcsdirty@Garamond
					\csdirty@loadgaramond
				\else
					\csdirty@loadstdmath
				\fi
			\fi
		\fi
	\fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyperlinks & Referencing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{nameref}                                     % Name-based referencing
\RequirePackage[%
	bookmarksnumbered=true,                                  % Number PDF bookmarks
	breaklinks=true,                                         % Allow links to break over lines
	citecolor=DodgerBlue3,                                   % Color for citations
	colorlinks=true,                                         % Use colored links
	frenchlinks=true,                                        % Use small caps for links
	linkcolor=RoyalBlue3,                                    % Color for internal links
	pagebackref,                                             % Back-references from bibliography
	pdfencoding=auto,                                        % Automatic encoding detection
	pdfpagelabels=true,                                      % Correct page labels in PDF
	pdfpagelayout=SinglePage,                                % Single page view
	pdfstartview=FitH,                                       % Fit the page to the window
	pdfusetitle,                                             % Use document title as PDF title
	unicode=true,                                            % Support for Unicode
	urlcolor=Turquoise4                                      % Color for URLs
]{hyperref}
\AtBeginDocument{%
	\RequirePackage[capitalize,nameinlink,noabbrev]{cleveref} % Clever references
	% Sectioning names for cleveref
	\crefname{section}{\textsection}{\textsection\textsection}
	\Crefname{section}{\textsection}{\textsection\textsection}
	\crefname{subsection}{\textsection}{\textsection\textsection}
	\Crefname{subsection}{\textsection}{\textsection\textsection}
	\crefname{subsubsection}{\textsection}{\textsection\textsection}
	\Crefname{subsubsection}{\textsection}{\textsection\textsection}
}
\RequirePackage{xr}                                           % Cross-document references
% Customize backrefs
\renewcommand*{\backref}[1]{}
\renewcommand*{\backrefalt}[4]{%
	\ifcase #1\or (Cited on p.~#2).%
	\else (Cited on pp.~#2).%
	\fi
}
% Full reference combining hyperref, autoref, and nameref.
\newcommand*{\fullref}[1]{\hyperref[{#1}]{\autoref*{#1}~\nameref*{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Figures and Tables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{adjustbox}                                     % Graphic/table boxes: scaling, trimming, framing
\RequirePackage{array}                                         % Custom column types and alignment
\RequirePackage{booktabs}                                      % High-quality horizontal rules for tables
\RequirePackage{caption}                                       % Custom caption formatting
\RequirePackage{colortbl}                                      % Cell background coloring in tables
\RequirePackage{dashbox}                                       % Dashed framed boxes
\RequirePackage{diagbox}                                       % Diagonal split table headers
\RequirePackage{fancybox}                                      % Simple framed boxes
\RequirePackage{float}                                         % Precise float positioning
\RequirePackage{framed}                                        % Framed environments (e.g., figures, text)
\RequirePackage{graphicx}                                      % Image inclusion and scaling
\RequirePackage{hhline}                                        % Horizontal lines in tables
\RequirePackage{longtable}                                     % Multi-page tables
\RequirePackage{makecell}                                      % Line breaks and formatting in cells
\RequirePackage{multicol}                                      % Multiple text columns
\RequirePackage{multirow}                                      % Multi-row cells in tables
\RequirePackage{pdflscape}                                     % Landscape pages in PDF output
\RequirePackage{placeins}                                      % Float placement control (e.g., \FloatBarrier)
\RequirePackage{ragged2e}                                      % Improved text justification
\RequirePackage{rotating}                                      % Rotated figures and tables
\RequirePackage{subcaption}                                    % Subfigures and subtables with captions
\RequirePackage{tabularray}                                    % Advanced table types and styling
\RequirePackage{tabularx}                                      % Tables with auto-stretching columns
\RequirePackage{threeparttable}                                % Notes and footnotes in tables
\RequirePackage{verbatim}                                      % Verbatim environment
\RequirePackage{wrapfig}                                       % Text wrapping around figures/tables
\RequirePackage{xhfill}                                        % Horizontal line
\RequirePackage{xtab}                                          % Page-breaking tables (alt to supertabular)
\AtBeginDocument{%
	\captionsetup{%
		font={rm,small},                                       % Roman font
		labelfont={color=black,sc,small},                      % Label in black roman
		labelsep=period,                                       % Label ends with period
		skip=5pt,                                              % Space below caption
		justification=justified                                % Center the caption
	}%
}%
\captionsetup[table]{position=bottom, skip=5pt}                % Table captions below
\captionsetup[figure]{position=bottom, skip=5pt}               % Figure captions below

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% List Customization
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{enumitem}                                      % Precise control over list environments

% Global list spacing
\setlist{nosep}                                                % Suppress vertical spacing between items

% Enumerate: Custom labels by nesting level
\setlist[enumerate,1]{label=(\arabic*)}                        % Level 1: (1), (2), ...
\setlist[enumerate,2]{label=(\alph*)}                          % Level 2: (a), (b), ...
\setlist[enumerate,3]{label=(\Roman*)}                         % Level 3: (I), (II), ...

% Itemize: Custom symbols by nesting level
\setlist[itemize,1]{label=\ensuremath{\bullet}}                % Level 1: bullet
\setlist[itemize,2]{label=\ensuremath{\textendash}}            % Level 2: en dash
\setlist[itemize,3]{label=\ensuremath{\circ}}                  % Level 3: open circle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Epigraphs
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifcsdirty@LoadEpigraph
	\RequirePackage{epigraph} % Load epigraph package for introductory quotations

	% Epigraph appearance configuration
	\setlength{\epigraphrule}{0.5pt}         	% Thickness of the epigraph rule
	\setlength{\epigraphwidth}{0.65\textwidth} 	% Width of the epigraph block
	\renewcommand{\textflush}{flushright}      	% Align epigraph text to the right
	\renewcommand{\epigraphsize}{\small}       	% Set epigraph font size

	% Enhanced epigraph command using xparse
	\let\oldepigraph\epigraph
	\RenewDocumentCommand{\epigraph}{mm}{%
		\oldepigraph{\textsf{#1}}{\smallskip\textsc{#2}}%
	}

	% Dedication page core (centered, large, on its own page)
	\NewDocumentCommand{\csdirty@dedicationscore}{m}{%
		\thispagestyle{plain}%
		\begin{center}%
			\vspace*{\fill}%
			\large #1%
			\vspace*{\fill}%
		\end{center}%
		\cleardoublepage%
	}

	% Define \generateDedications only for book or report classes
	\@ifclassloaded{book}{%
		\NewDocumentCommand{\generateDedications}{m}{\csdirty@dedicationscore{#1}}
	}{%
		\@ifclassloaded{report}{%
			\NewDocumentCommand{\generateDedications}{m}{\csdirty@dedicationscore{#1}}
		}{}%
	}

	% Dedication environment core: right-aligned, sffamily, on its own page
	\NewDocumentCommand{\csdirty@dedicationenvcore}{m}{%
		\cleardoublepage
		\thispagestyle{empty}
		\null\vfill
		\begin{flushright}
			\begin{minipage}{0.6\textwidth}
				\sffamily
				#1
			\end{minipage}
		\end{flushright}
		\vfill\null
		\clearpage
	}

	% Dedication environment body: main text and optional author/attribution
	\NewDocumentCommand{\csdirty@dedicationenvbody}{mm}{%
		#1%
		% If the second argument is not empty, typeset as small caps at the end
		\IfNoValueF{#2}{%
			\normalfont\small
			\par\smallskip\hfill\textsc{#2}%
		}%
	}

	% Modular dedication environment, only for book or report classes
	\@ifclassloaded{book}{%
		\NewDocumentEnvironment{dedication}{O{}}{%
			\csdirty@dedicationenvcore{%
				\csdirty@dedicationenvbody{##1}{##1}
			}%
		}{}
	}{%
		\@ifclassloaded{report}{%
			\NewDocumentEnvironment{dedication}{O{}}{%
				\csdirty@dedicationenvcore{%
					\csdirty@dedicationenvbody{##1}{##1}
				}%
			}{}
		}{}%
	}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colored Boxes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[most]{tcolorbox}                              % Colored and styled boxes
\RequirePackage[%
	skipabove=1em,                                            % Vertical space above the frame
	skipbelow=1em,                                            % Vertical space below the frame
	ntheorem,                                                 % Compatibility with theorem environments
	framemethod=Tikz                                          % Use TikZ for frame rendering
]{mdframed}                                                   % Framed environments with theorem support

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TikZ
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifcsdirty@LoadTikz
	\typeout{csdirty: Loading TikZ package}
	\RequirePackage{pgfplots}                                     % Function/data plots
	\pgfplotsset{compat=1.18}                                     % PGFPlots compatibility version
	\RequirePackage{tikz}                                         % Core TikZ package
	\RequirePackage{tikz-cd}                                      % Commutative diagrams
	\RequirePackage{tikz-3dplot}                                  % 3D coordinate plotting

	% TikZ libraries for enhanced diagrammatic capability
	\usetikzlibrary{%
		3d,
		arrows,
		arrows.meta,
		automata,
		babel,
		backgrounds,
		bending,
		calc,
		calendar,
		chains,
		circuits.ee.IEC,
		circuits.logic.IEC,
		datavisualization,
		datavisualization.formats.functions,
		decorations,
		decorations.markings,
		decorations.pathmorphing,
		decorations.shapes,
		decorations.text,
		er,
		external,
		fadings,
		fit,
		graphs,
		graphs.standard,
		hobby,
		intersections,
		lindenmayersystems,
		matrix,
		mindmap,
		patterns,
		patterns.meta,
		petri,
		plothandlers,
		plotmarks,
		positioning,
		quotes,
		scopes,
		shadows,
		shapes,
		shapes.arrows,
		shapes.callouts,
		shapes.geometric,
		shapes.misc,
		shapes.multipart,
		shapes.symbols,
		spy,
		svg.path,
		through,
		tikzmark,
		trees
	}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendices
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[page, title, header, titletoc, toc]{appendix} % For handling appendices

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Cryptography and Styling
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifcsdirty@LoadTheorems
	\typeout{csdirty: Loading theorem formatting package}
	\IfFileExists{csthm.sty}{%
		\RequirePackage[oldschool]{csthm}
	}{%
		\PackageWarning{csdirty}{Package `csthm` not found.}
	} % Theorem formatting
\fi

\ifcsdirty@LoadCrypto
	\typeout{csdirty: Loading cryptography package}
	\IfFileExists{tcscrypto.sty}{%
		\RequirePackage{tcscrypto}
	}{%
		\PackageWarning{csdirty}{Package `tcscrypto` not found.}
	} % Cryptography macros
\fi

\ifcsdirty@LoadOrcidlink
	\typeout{csdirty: Loading ORCID link package}
	\IfFileExists{orcidlink.sty}{%
		\RequirePackage{orcidlink}
	}{%
		\PackageWarning{csdirty}{Package `orcidlink` not found.}
	} % ORCID ID and icon
\fi

\ifcsdirty@LoadNicodemus
	\typeout{csdirty: Loading Nicodemus font package}
	\IfFileExists{nicodemus.sty}{%
		\RequirePackage{nicodemus}
	}{%
		\PackageWarning{csdirty}{Package `nicodemus` not found.}
	} % Nicodemus macros
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Versioning, Comments, Acknowledgment, Abstract
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Comment macro: \newcomment{name}{color}{command}
\NewDocumentCommand{\newcomment}{mmm}{%
	\expandafter\NewDocumentCommand\csname#3\endcsname{m}{%
		\ifComments
			\noindent\textcolor{#2}{\sffamily##1 -- $\mathsf{#1}$}%
		\fi
	}%
}

\AtBeginDocument{%
	% Acknowledgment: hidden if anonymized, class-based otherwise
	\ifShortVersion
		\NewDocumentEnvironment{acknowledgment}{o}{}{}
	\else
		\NewDocumentEnvironment{acknowledgment}{o}{%
			\@ifclassloaded{book}{%
				\IfNoValueTF{#1}{\chapter*{Acknowledgment}}{\chapter*{#1}}%
			}{%
				\@ifclassloaded{report}{%
					\IfNoValueTF{#1}{\chapter*{Acknowledgment}}{\chapter*{#1}}%
				}{%
					\IfNoValueTF{#1}{\paragraph*{Acknowledgment.}}{\paragraph*{#1}}%
				}%
			}%
		}{}
	\fi
}

% Abstract: indented with TOC entry
\@ifclassloaded{book}{%
	\NewDocumentEnvironment{abstract}{}{%
		\begingroup
		\quotation
		\small
		\textbf{\abstractname.\ }%
		\addcontentsline{toc}{section}{\protect{\abstractname}}%
	}{%
		\endquotation
		\endgroup
	}
}{%
	\RenewDocumentEnvironment{abstract}{}{%
		\begingroup
		\quotation
		\small
		\textbf{\abstractname.\ }%
		\addcontentsline{toc}{section}{\protect{\abstractname}}%
	}{%
		\endquotation
		\endgroup
	}
}

% Table of Contents
\NewDocumentCommand{\toc}{}{%
	\clearpage
	\vfill
	\begin{spacing}{1.00}
		\tableofcontents
	\end{spacing}
	\vfill
	\clearpage
}

% Bibliography 
\NewDocumentCommand{\printbib}{O{alphaurl} m}{%
	\vfill
	\clearpage
	\begin{spacing}{1.00}
		\bibliographystyle{#1}
		\bibliography{#2}
	\end{spacing}
	\vfill
	\clearpage
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title Formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{hep-title}                                   % Lightweight title formatting
\titlefont{\normalfont\LARGE\bfseries}                       % Title
\subtitlefont{\normalfont\large\bfseries}                    % Subtitle
\authorfont{\normalfont\normalsize\scshape}                  % Author
\affiliationfont{\normalfont\small\scshape}                  % Affiliation
\datefont{\normalfont\small\scshape}                         % Date
\preprintfont{\normalfont\small\ttfamily\scshape}            % Preprint line

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Adjust Table of Contents spacing
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[titles]{tocloft}                             % TOC title formatting
\NewDocumentCommand{\adjusttocspacing}{}{%
	\addtolength{\cftchapnumwidth}{5pt}%
	\addtolength{\cftsecnumwidth}{3.5pt}%
	\addtolength{\cftsubsecnumwidth}{3.5pt}%
	\addtolength{\cftsubsubsecnumwidth}{3.5pt}%
	\addtolength{\cftsecindent}{5pt}%
	\addtolength{\cftsubsecindent}{8.5pt}%
	\addtolength{\cftsubsubsecindent}{12pt}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Header-level formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{titlesec}                                    % Header title formatting

% Define section-specific heading fonts and sizes
\NewDocumentCommand{\partheadingfont}{}{\normalfont\bfseries\huge}
\NewDocumentCommand{\chapterheadingfont}{}{\normalfont\bfseries\LARGE}
\NewDocumentCommand{\sectionheadingfont}{}{\normalfont\bfseries\Large}
\NewDocumentCommand{\subsectionheadingfont}{}{\normalfont\bfseries\large}
\NewDocumentCommand{\subsubsectionheadingfont}{}{\normalfont\bfseries\normalsize}
\NewDocumentCommand{\paragraphheadingfont}{}{\normalfont\bfseries\normalsize}
\NewDocumentCommand{\subparagraphheadingfont}{}{\normalfont\scshape\normalsize}

\ifcsdirty@LoadOldSectionSymb
	% Ancient Section, subsection, etc. formatting rules
	\NewDocumentCommand{\setsectionformats}{}{%
		\titleformat{\section}
		{\sectionheadingfont}
		{\textsection\thesection}
		{10pt}
		{}%
		\titleformat{\subsection}
		{\subsectionheadingfont}
		{\textsection\textsection\thesubsection}
		{10pt}
		{}%
		\titleformat{\subsubsection}[runin]
		{\subsubsectionheadingfont}
		{\textsection\textsection\textsection\thesubsubsection}
		{10pt}
		{}%
		\titleformat{\paragraph}[runin]
		{\paragraphheadingfont}
		{\theparagraph}
		{10pt}
		{}[.]%
		\titlespacing*{\paragraph}{0pt}{\medskipamount}{*1}%
		\titleformat{\subparagraph}[runin]
		{\subparagraphheadingfont}
		{\thesubparagraph}
		{10pt}
		{}[.]%
		\titlespacing*{\subparagraph}{0pt}{\medskipamount}{*1}%
	}
\else
	% Section, subsection, etc. formatting rules
	\NewDocumentCommand{\setsectionformats}{}{%
		\titleformat{\section}
		{\sectionheadingfont}
		{\thesection}
		{10pt}
		{}%
		\titleformat{\subsection}
		{\subsectionheadingfont}
		{\thesubsection}
		{10pt}
		{}%
		\titleformat{\subsubsection}[runin]
		{\subsubsectionheadingfont}
		{\thesubsubsection}
		{10pt}
		{}%
		\titleformat{\paragraph}[runin]
		{\paragraphheadingfont}
		{\theparagraph}
		{10pt}
		{}[.]%
		\titlespacing*{\paragraph}{0pt}{\medskipamount}{*1}%
		\titleformat{\subparagraph}[runin]
		{\subparagraphheadingfont}
		{\thesubparagraph}
		{10pt}
		{}[.]%
		\titlespacing*{\subparagraph}{0pt}{\medskipamount}{*1}%
	}
\fi

% Chapter-level title formatting (with embedded size and style)
\NewDocumentCommand{\setchapterformat}{}{%
	\titleformat{\chapter}[display]
	{\chapterheadingfont}
	{\filleft\textnormal{\textsc{\large\chaptertitlename}~\Huge\textsf{\thechapter}}}
	{2ex}
	{\titlerule\vspace{1ex}\filright}
	[\vspace{1ex}\titlerule]%
}

% Part-level title formatting (with embedded size and style)
\NewDocumentCommand{\setpartformat}{}{%
\titleclass{\part}{top}
\titleformat{\part}[display]
{\partheadingfont}
{\scshape\partname~{\Huge\thepart}}
{1ex}
{\scshape\titlerule\vspace{1ex}\Huge}
[\vspace{1ex}\titlerule]%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Paragraph formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Flag for punctuation detection
\newif\ifcsdirty@haspunctuation

% Check whether the second argument is empty (used for punctuation detection)
\def\csdirty@checkpunctuation#1{%
	\ifx\csdirty@checkpunctuation#1\csdirty@checkpunctuation
	\else
		\csdirty@haspunctuationtrue
	\fi
}

% Specific punctuation testers for '.', '?', '!', ':'
\def\csdirty@checkdot#1.\csdirty@delim#2\csdirty@stop{\csdirty@checkpunctuation{#2}}
\def\csdirty@checkquestion#1?\csdirty@delim#2\csdirty@stop{\csdirty@checkpunctuation{#2}}
\def\csdirty@checkexclam#1!\csdirty@delim#2\csdirty@stop{\csdirty@checkpunctuation{#2}}
\def\csdirty@checkcolon#1:\csdirty@delim#2\csdirty@stop{\csdirty@checkpunctuation{#2}}

% Main interface: Append period unless line ends with '.', '?', '!', or ':'
\def\csdirty@appendpunctuationifneeded#1{%
	\csdirty@haspunctuationfalse
	\csdirty@checkdot#1\csdirty@delim.\csdirty@delim\csdirty@stop
	\csdirty@checkquestion#1\csdirty@delim?\csdirty@delim\csdirty@stop
	\csdirty@checkexclam#1\csdirty@delim!\csdirty@delim\csdirty@stop
	\csdirty@checkcolon#1\csdirty@delim:\csdirty@delim\csdirty@stop
	#1\ifcsdirty@haspunctuation \else.\fi%
}

% Skip spaces and implicit paragraphs (blank lines)
\def\csdirty@ignorewhitespaceandimplicitpars{%
	\begingroup
	\catcode13=10 %
	\@ifnextchar\relax
	{\endgroup}
	{\endgroup}%
}

% Skip spaces, implicit paragraphs, and explicit \par commands
\def\csdirty@ignoreallpars{%
	\begingroup
	\catcode13=10 %
	\@ifnextchar\par
	{\endgroup\expandafter\csdirty@ignoreallpars\@gobble}
	{\endgroup}%
}

% Section-style paragraph header with automatic punctuation and spacing
\NewDocumentCommand{\csdirty@paragraphhead}{m}{%
	\smallskip
	\noindent
	\textbf{\boldmath\ignorespaces\csdirty@appendpunctuationifneeded{#1}}%
	\hskip 0.9em plus 0.3em minus 0.3em
	\csdirty@ignorewhitespaceandimplicitpars
}

\NewDocumentCommand{\parhead}{m}{\csdirty@paragraphhead{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Nested bar environment
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\long\def\csdirty@customfbox#1#2#3#4#5#6#7#8#9{%
	\leavevmode
	\begingroup
	\setbox\@tempboxa\hbox{%
		\color@begingroup
		\kern\fboxsep{#9}\kern\fboxsep
		\color@endgroup}%
	\hbox{%
		\begingroup
		\@tempdima#4\relax
		\advance\@tempdima\fboxsep
		\advance\@tempdima\dp\@tempboxa
		\expandafter\endgroup
		\expandafter\lower\the\@tempdima\hbox{%
			\vbox{%
				\hrule \@height#3 \@width#7
				#1%
				\hbox{%
					\vrule \@width#5
					\hspace{#8}%
					\vbox{%
						\vskip\fboxsep
						\copy\@tempboxa
						\vskip\fboxsep}%
					\vrule \@width#6}%
				#2%
				\hrule \@height#4\@width#7}%
		}%
	}%
	\endgroup
}

% Parameters for bar dimensions and spacing
\newcommand{\csdirty@nestedbar@topbotrulelength}{1em}
\newcommand{\csdirty@nestedbar@indent}{0.5em}

% FrameCommand helper that sets up side rule and spacing
\def\csdirty@openframebox#1#2{%
	\fboxsep=\FrameSep
	\csdirty@customfbox
	{}{}% no content above or below
	{#1}{#2}% top and bottom rule thicknesses
	\FrameRule\z@% left and right rule thickness
	\csdirty@nestedbar@topbotrulelength% horizontal rule length
	\csdirty@nestedbar@indent% indent from vertical rule
}

% Definition of the nestedbar environment
\newenvironment{nestedbar}[1][\hsize]{%
	\@ifundefined{OuterFrameSep}{%
		\@latex@error{To use nestedbar, update framed.sty to a recent version.}\@ehd}{}%
	\def\FrameCommand{\csdirty@openframebox\FrameRule\FrameRule}%
	\def\FirstFrameCommand{\csdirty@openframebox\FrameRule\z@}%
	\def\MidFrameCommand{\csdirty@openframebox\z@\z@}%
	\def\LastFrameCommand{\csdirty@openframebox\z@\FrameRule}%
	\OuterFrameSep=1ex
	\FrameSep=0pt
	\MakeFramed{\hsize#1\advance\hsize-\width\FrameRestore}%
}{%
	\endMakeFramed
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Simple fancyhdr header setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\NewDocumentCommand{\simplefancyheader}{}{%
	\RequirePackage{fancyhdr}%
	\pagestyle{fancy}%
	\fancyhf{}%
	\fancyhead[LE,RO]{\rmfamily\small\textnormal{\@title}}%
	\fancyhead[RE,LO]{\rmfamily\small\thepage}%
	\fancyfoot{}%
	\setlength{\headheight}{12pt}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Class-specific adjustments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginDocument{%
	\@ifclassloaded{article}{%
		\setsectionformats%
		\setpartformat%
	}{}

	\@ifclassloaded{report}{%
		\setpartformat%
		\setchapterformat%
		\setsectionformats%
		\simplefancyheader%
		\adjusttocspacing%
	}{}

	\@ifclassloaded{book}{%
		\setpartformat%
		\setchapterformat%
		\setsectionformats%
		\simplefancyheader%
		\adjusttocspacing%
	}{}
}%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Useful commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Commands for the main document
\ifcsdirty@LoadUsefulCommands
	\@ifpackageloaded{enumitem}{%
		% Define 'points' list: itemize using "--"
		\newlist{points}{itemize}{1}
		\setlist[points]{%
			label={\textendash},
			leftmargin=1em,
			itemsep=1pt,
			align=left,
			before=\smallskip,
			after=\smallskip
		}

		% Define 'codelist' list: enumerated as [\texttt{1}], [\texttt{2}], ...
		\newlist{codelist}{enumerate}{1}
		\setlist[codelist,1]{%
			label=\textcolor{gray}{\texttt{[\arabic*]}},
			leftmargin=1em,
			itemsep=1pt,
			align=left,
			before=\smallskip,
			after=\smallskip
		}

		% Define 'checkbox' list
		\newlist{checkbox}{itemize}{1}
		\setlist[checkbox]{%
			label=$\square$,
			leftmargin=1em,
			align=left
		}
		% Define \checked command to switch label for one item
		\newcommand{\checked}{\item[\checkmark]}

		% Define a rigorous description list for definitions
		\newlist{deflist}{description}{1}
		\setlist[deflist]{%
			labelwidth=0.35\textwidth,
			labelsep=1em,
			leftmargin=0.35\textwidth,
			font=\normalfont\bfseries,
			style=nextline,
			itemsep=5pt
		}
	}{}

	% Highlight color for text and math
	\newcommand{\highlightcolor}{RoyalBlue}
	\newcommand{\sethighlightcolor}[1]{\renewcommand{\highlightcolor}{#1}}

	% Text and math highlighting
	\newcommand{\emphmath}[1]{\textcolor{\highlightcolor}{\mathrm{#1}}}
	\newcommand{\emphtext}[1]{\textcolor{\highlightcolor}{#1}}
	\newcommand{\textbi}[1]{\textbf{\textit{#1}}}
	\newcommand{\textem}[1]{\textcolor{\highlightcolor}{#1}}

	% Code highlighting
	\newcommand{\code}[1]{\texttt{#1}}

	% Math small caps and bold italic
	\newcommand{\mathsc}[1]{\textnormal{\textsc{#1}}}
	\newcommand{\mathbi}[1]{\textnormal{\textbf{\textit{#1}}}}

	% Inline math shortcut
	\newcommand{\inmath}[1]{\ensuremath{#1}}

	% Hyphen in math
	\mathchardef\mathhyphen="2D

	% Put in quotes
	\newcommand{\putInQuotes}[1]{``#1''}

	% Strike-through text
	\newcommand{\strike}[1]{\bgroup\ULdepth=-.55ex\ULset\strike{#1}\egroup}

	% Highlight missing or problematic text
	\newcounter{missingctr}
	\newcommand{\missinglist}{}

	% Main \missing command
	\newcommand{\missing}[1]{%
		\refstepcounter{missingctr}%
		\label{missing:\themissingctr}%
		\gappto\missinglist{%
			\noindent\textcolor{Brown4}{%
				\ensuremath{\star}~\themissingctr~(\textsf{Missing at p.~\pageref{missing:\themissingctr}}):~#1
			}\par\medskip
		}%
		\textcolor{Brown4}{#1}%
	}

	% Print all collected missing items with page references
	\newcommand{\printmissing}{%
		\section*{Missing Content Report}%
		\missinglist
	}

	% Format for missing citations
	\newcommand{\missingcitation}{\textcolor{Brown4}{
			\refstepcounter{missingctr}%
			\label{missing:\themissingctr}%
			\gappto\missinglist{%
				\noindent\textcolor{Brown4}{%
					\ensuremath{\star}~\themissingctr~(\textsf{Missing at p.~\pageref{missing:\themissingctr}}):~#1
				}\par\medskip
			}%	
			\code{<Citation Missing>}
		}
	}


	% Double-struck Pi symbol for different engines
	\newcommand{\dsPi}{%
		\ifluatex
			\char"213F
		\else
			\ifxetex
				\char"213F
			\else
				\Pi
			\fi
		\fi
	}

	% Sans-serif Pi symbol for different engines
	\newcommand{\sansPi}{%
		\ifluatex
			\char"1D765
		\else
			\ifxetex
				\char"1D765
			\else
				\Pi
			\fi
		\fi
	}

	\@ifpackageloaded{mdframed}{%
		% Protocol box environment
		\NewDocumentEnvironment{protocolbox}{o}
		{%
			\begin{mdframed}[
					font=\small,
					roundcorner=1.5pt,
					linewidth=0.5pt,
					skipabove=0.5\baselineskip,
					skipbelow=0.1\baselineskip,
					leftmargin=0pt,
					rightmargin=0pt,
					innerleftmargin=5pt,
					innerrightmargin=5pt,
					innertopmargin=5pt,
					innerbottommargin=5pt,
					backgroundcolor=white,
					linecolor=black
				]%
				\IfNoValueF{#1}{%
					\noindent\textnormal{\small\textbf{#1}}\par\smallskip
					\noindent\hrule height 0.4pt\relax\vspace{0.5\baselineskip}%
				}%
				\begin{points}%
					}
					{%
				\end{points}
			\end{mdframed}%
		}

		% Code list box environment
		\NewDocumentEnvironment{codelistbox}{o}
		{%
			\begin{mdframed}[
					font=\small,
					roundcorner=1.5pt,
					linewidth=0.5pt,
					skipabove=0.5\baselineskip,
					skipbelow=0.1\baselineskip,
					leftmargin=0pt,
					rightmargin=0pt,
					innerleftmargin=5pt,
					innerrightmargin=5pt,
					innertopmargin=5pt,
					innerbottommargin=5pt,
					backgroundcolor=white,
					linecolor=black
				]%
				\IfNoValueF{#1}{%
					\noindent\textnormal{\small\textbf{#1}}\par\smallskip
					\noindent\hrule height 0.4pt\relax\vspace{0.5\baselineskip}%
				}%
				\begin{codelist}%
					}
					{%
				\end{codelist}
			\end{mdframed}%
		}

		\NewDocumentEnvironment{simplebox}{o}
		{%
			\begin{mdframed}[
					font=\small,
					roundcorner=1.5pt,
					linewidth=0.5pt,
					skipabove=0.5\baselineskip,
					skipbelow=0.1\baselineskip,
					leftmargin=0pt,
					rightmargin=0pt,
					innerleftmargin=5pt,
					innerrightmargin=5pt,
					innertopmargin=5pt,
					innerbottommargin=5pt,
					backgroundcolor=white,
					linecolor=black
				]%
				\IfNoValueF{#1}{%
					\noindent\textnormal{\small\textbf{#1}}\par\smallskip
					\noindent\hrule height 0.4pt\relax\vspace{0.5\baselineskip}%
				}%
				}
				{%
			\end{mdframed}%
		}
	}{}

	\@ifpackageloaded{tcolorbox}{%
		% Wire box environment
		\newtcolorbox{wirebox}{%
			colframe=black,
			colback=white,
			sharp corners,
			boxrule=0.5pt,
			coltitle=black,
			colbacktitle=white,
			boxsep=5pt,
			top=0pt,
			bottom=0pt,
			left=5pt,
			right=5pt
		}
	}{}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Upright Greek Letters Setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifcsdirty@ModGreekSymbs
	\RequirePackage{upgreek} % Load upright Greek letter symbols

	% Provide definitions for missing uppercase Greek macros as roman letters, if undefined
	\@ifundefined{Alpha}{\newcommand{\Alpha}{\mathrm{A}}}{}
	\@ifundefined{Beta}{\newcommand{\Beta}{\mathrm{B}}}{}
	\@ifundefined{Chi}{\newcommand{\Chi}{\mathrm{X}}}{}
	\@ifundefined{Epsilon}{\newcommand{\Epsilon}{\mathrm{E}}}{}
	\@ifundefined{Eta}{\newcommand{\Eta}{\mathrm{H}}}{}
	\@ifundefined{Iota}{\newcommand{\Iota}{\mathrm{I}}}{}
	\@ifundefined{Kappa}{\newcommand{\Kappa}{\mathrm{K}}}{}
	\@ifundefined{Mu}{\newcommand{\Mu}{\mathrm{M}}}{}
	\@ifundefined{Nu}{\newcommand{\Nu}{\mathrm{N}}}{}
	\@ifundefined{Omicron}{\newcommand{\Omicron}{\mathrm{O}}}{}
	\@ifundefined{Rho}{\newcommand{\Rho}{\mathrm{R}}}{}
	\@ifundefined{Tau}{\newcommand{\Tau}{\mathrm{T}}}{}
	\@ifundefined{Zeta}{\newcommand{\Zeta}{\mathrm{Z}}}{}
	\@ifundefined{omicron}{\newcommand{\omicron}{\mathrm{o}}}{}

	% Fallbacks for upright forms from `upgreek`, if undefined
	\@ifundefined{Upalpha}{\newcommand{\Upalpha}{\mathrm{A}}}{}
	\@ifundefined{Upbeta}{\newcommand{\Upbeta}{\mathrm{B}}}{}
	\@ifundefined{Upchi}{\newcommand{\Upchi}{\mathrm{X}}}{}
	\@ifundefined{Upepsilon}{\newcommand{\Upepsilon}{\mathrm{E}}}{}
	\@ifundefined{Upeta}{\newcommand{\Upeta}{\mathrm{H}}}{}
	\@ifundefined{Upiota}{\newcommand{\Upiota}{\mathrm{I}}}{}
	\@ifundefined{Upkappa}{\newcommand{\Upkappa}{\mathrm{K}}}{}
	\@ifundefined{Upmu}{\newcommand{\Upmu}{\mathrm{M}}}{}
	\@ifundefined{Upnu}{\newcommand{\Upnu}{\mathrm{N}}}{}
	\@ifundefined{Upomicron}{\newcommand{\Upomicron}{\mathrm{O}}}{}
	\@ifundefined{Uprho}{\newcommand{\Uprho}{\mathrm{R}}}{}
	\@ifundefined{Uptau}{\newcommand{\Uptau}{\mathrm{T}}}{}
	\@ifundefined{Upzeta}{\newcommand{\Upzeta}{\mathrm{Z}}}{}
	\@ifundefined{upomicron}{\newcommand{\upomicron}{\mathrm{o}}}{}

	% If available, overwrite standard Greek macros with their upright versions
	\@ifundefined{Upalpha}{}{\renewcommand{\Alpha}{\Upalpha}}
	\@ifundefined{Upbeta}{}{\renewcommand{\Beta}{\Upbeta}}
	\@ifundefined{Upchi}{}{\renewcommand{\Chi}{\Upchi}}
	\@ifundefined{Updelta}{}{\renewcommand{\Delta}{\Updelta}}
	\@ifundefined{Upepsilon}{}{\renewcommand{\Epsilon}{\Upepsilon}}
	\@ifundefined{Upeta}{}{\renewcommand{\Eta}{\Upeta}}
	\@ifundefined{Upgamma}{}{\renewcommand{\Gamma}{\Upgamma}}
	\@ifundefined{Upiota}{}{\renewcommand{\Iota}{\Upiota}}
	\@ifundefined{Upkappa}{}{\renewcommand{\Kappa}{\Upkappa}}
	\@ifundefined{Uplambda}{}{\renewcommand{\Lambda}{\Uplambda}}
	\@ifundefined{Upmu}{}{\renewcommand{\Mu}{\Upmu}}
	\@ifundefined{Upnu}{}{\renewcommand{\Nu}{\Upnu}}
	\@ifundefined{Upomega}{}{\renewcommand{\Omega}{\Upomega}}
	\@ifundefined{Upomicron}{}{\renewcommand{\Omicron}{\Upomicron}}
	\@ifundefined{Upphi}{}{\renewcommand{\Phi}{\Upphi}}
	\@ifundefined{Uppi}{}{\renewcommand{\Pi}{\Uppi}}
	\@ifundefined{Uppsi}{}{\renewcommand{\Psi}{\Uppsi}}
	\@ifundefined{Uprho}{}{\renewcommand{\Rho}{\Uprho}}
	\@ifundefined{Upsigma}{}{\renewcommand{\Sigma}{\Upsigma}}
	\@ifundefined{Uptau}{}{\renewcommand{\Tau}{\Uptau}}
	\@ifundefined{Uptheta}{}{\renewcommand{\Theta}{\Uptheta}}
	\@ifundefined{Upupsilon}{}{\renewcommand{\Upsilon}{\Upupsilon}}
	\@ifundefined{Upxi}{}{\renewcommand{\Xi}{\Upxi}}
	\@ifundefined{Upzeta}{}{\renewcommand{\Zeta}{\Upzeta}}
\fi

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End of package
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\endinput