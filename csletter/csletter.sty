% csletter.sty
% Customizable Letter Style Package
% Version 1.1, 2026-02-15
% Author: Agni Datta
% License: LPPL v1.3c
%
% Provides a clean, configurable interface for professional correspondence
% using the standard letter class with optional font selection, colors,
% headers, footers, and signature support.

\NeedsTeXFormat{LaTeX2e}[2020/10/01]
\ProvidesPackage{csletter}[2026/02/15 v1.1 Customizable letter style]

% Core dependencies
\RequirePackage[english]{babel}						% Language support
\RequirePackage{etoolbox}       					% Conditional logic
\RequirePackage{fancyhdr}       					% Header/footer customization
\RequirePackage{geometry}       					% Margin control
\RequirePackage{graphicx}       					% Logo and signature images
\RequirePackage{iftex}          					% Engine detection
\RequirePackage{kvoptions}      					% Key-value option parsing
\RequirePackage[x11names,dvipsnames]{xcolor}        % Color support

% Option setup
\SetupKeyvalOptions{family=csl,prefix=csl@}

% Color options
\DeclareStringOption[black]{textcolor}
\DeclareStringOption[blue]{accentcolor}
\DeclareStringOption[gray]{footercolor}
\DeclareStringOption[gray]{headercolor}

% Margin options (cm)
\DeclareStringOption[2.5]{topmargin}
\DeclareStringOption[2.5]{bottommargin}
\DeclareStringOption[2.5]{leftmargin}
\DeclareStringOption[2.5]{rightmargin}

% Component toggles
\DeclareBoolOption{header}
\DeclareBoolOption{footer}
\DeclareBoolOption{date}
\DeclareBoolOption{logo}
\DeclareBoolOption{signature}

% Component paths
\DeclareStringOption[logo.png]{logofile}
\DeclareStringOption[signature.png]{signaturefile}

% Layout options
\DeclareStringOption[left]{headerpos}
\DeclareStringOption[center]{footerpos}
\DeclareStringOption[single]{linespacing}

% Process options
\ProcessKeyvalOptions*

% Font configuration (engine-dependent)
\ifPDFTeX
	% pdfLaTeX fallback: use standard LaTeX fonts
	\RequirePackage[T1]{fontenc}
	\RequirePackage{textcomp}
	\RequirePackage{ebgaramond}     		% Garamond-like serif
	\RequirePackage[scaled=.95]{ysabeau}  	% Sans serif
	\RequirePackage[scaled=.9]{noto-mono}  	% Monospace
\else
	% XeLaTeX/LuaLaTeX: modern OpenType fonts
	\RequirePackage{fontspec}
	\RequirePackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}

	\setmainfont{GaramondLibre}[
		Extension=.otf,
		UprightFont=*-Regular,
		ItalicFont=*-Italic,
		BoldFont=*-Bold,
		BoldItalicFont=*-BoldItalic,
		SmallCapsFont=EBGaramond-Medium.otf,
		SmallCapsFeatures={Letters=SmallCaps},
	]

	\setmathfont{Garamond-Math.otf}[
		AutoFakeBold,
		StylisticSet={2,6,7,9},
	]

	\setsansfont{Ysabeau}[Scale=MatchLowercase]
	\setmonofont{Noto Sans Mono}[Scale=MatchLowercase]

	\let\mathbfcal\relax
	\let\mathbfscr\relax
	\RequirePackage[cal=cm,bb=stix,scr=dutchcal]{mathalpha}
\fi

% Color definitions
\definecolor{csltext}{named}{\csl@textcolor}
\definecolor{cslaccent}{named}{\csl@accentcolor}
\definecolor{cslheader}{named}{\csl@headercolor}
\definecolor{cslfooter}{named}{\csl@footercolor}

\color{csltext}

% Geometry setup
\geometry{
	top=\csl@topmargin cm,
	bottom=\csl@bottommargin cm,
	left=\csl@leftmargin cm,
	right=\csl@rightmargin cm,
	headheight=1.25em,
	heightrounded,
	a4paper
}

% Line spacing (fixed implementation)
\AtBeginDocument{%
	\ifdefstring{\csl@linespacing}{onehalf}{%
		\renewcommand{\baselinestretch}{1.5}%
		\selectfont
	}{%
		\ifdefstring{\csl@linespacing}{double}{%
			\renewcommand{\baselinestretch}{2.0}%
			\selectfont
		}{%
			\renewcommand{\baselinestretch}{1.0}%
			\selectfont
		}%
	}%
}

% Paragraph formatting
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.8em}

% Header configuration
\ifcsl@header
	\pagestyle{fancy}
	\fancyhf{}
	\renewcommand{\headrulewidth}{0.4pt}
	\ifdefstring{\csl@headerpos}{left}{%
		\fancyhead[L]{\color{cslheader}\slshape\fromname}%
	}{%
		\ifdefstring{\csl@headerpos}{right}{%
			\fancyhead[R]{\color{cslheader}\slshape\fromname}%
		}{%
			\fancyhead[C]{\color{cslheader}\slshape\fromname}%
		}%
	}
\fi

% Footer configuration
\ifcsl@footer
	\ifcsl@header\else\pagestyle{fancy}\fi
	\renewcommand{\footrulewidth}{0.4pt}
	\ifdefstring{\csl@footerpos}{left}{%
		\fancyfoot[L]{\color{cslfooter}\thepage}%
	}{%
		\ifdefstring{\csl@footerpos}{right}{%
			\fancyfoot[R]{\color{cslfooter}\thepage}%
		}{%
			\fancyfoot[C]{\color{cslfooter}\thepage}%
		}%
	}
\fi

% Logo command
\newcommand{\csllogo}{%
	\ifcsl@logo
		\ifdefempty{\csl@logofile}{}{%
			\includegraphics[height=2cm]{\csl@logofile}%
			\vspace{1em}%
		}%
	\fi
}

% Signature command
\newcommand{\cslsignature}{%
	\ifcsl@signature
		\ifdefempty{\csl@signaturefile}{}{%
			\par\vspace{1em}%
			\includegraphics[height=3em]{\csl@signaturefile}%
		}%
	\fi
}

% Hyperref setup (loaded last)
\RequirePackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=cslaccent,
	urlcolor=cslaccent,
	citecolor=cslaccent,
	pdfborder={0 0 0}
}

\endinput